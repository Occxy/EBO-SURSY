<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Projet EBO-SURSY</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
    
    <!-- <style>
		.input-group-addon{color:#ff0000; background-color: #ffffff;}
	</style> -->
        
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="css/fontastic.css">
    <!-- Google fonts - Poppins -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
    <!-- Ladda-->
    <link rel="stylesheet" href="vendor/ladda/ladda-themeless.min.css">
    
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.premium.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">    
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
        
    <script src="vendor/jquery/jquery.min.js" onload="window.$ = window.jQuery = module.exports;"></script>
	<script>
		delete window.module;
	</script>
    
    <!-- DataTables CSS-->
    <link rel="stylesheet" href="css/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="css/responsive.bootstrap4.min.css">
        
    <link rel="stylesheet" href="css/icone.css">
    
    <link rel="stylesheet" href="css/offline_online.css">    
    
    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <!-- <script src="js/charts-home.js"></script> -->
    <!-- Notifications-->
    <script src="vendor/messenger-hubspot/build/js/messenger.min.js"></script>
    <script src="vendor/messenger-hubspot/build/js/messenger-theme-flat.js"></script>
    <!-- <script src="js/home-premium.js"></script> -->
    
    <!-- Bootstrap DatePicker-->
    <script src="vendor/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="vendor/bootstrap-datepicker/locales/bootstrap-datepicker.fr.min.js" charset="UTF-8"></script>
    
    <!-- Data Tables-->
    <script src="vendor/datatables.net/js/jquery.dataTables.js"></script>
    <script src="vendor/datatables.net-bs4/js/dataTables.bootstrap4.js"></script>
    <script src="vendor/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="vendor/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="js/tables-datatable.js"></script>
    
    <!-- Forms init-->
    <!-- <script src="js/forms-advanced.js"></script>-->
    
    <!-- Main File-->
    <script src="js/front.js"></script>
    
    <!-- Loading buttons-->
    <script src="vendor/ladda/spin.min.js"></script>
    <script src="vendor/ladda/ladda.min.js"></script>
    <script src="js/components-ladda.js"></script>
    
    <script src="js/pouchdb.authentication.js"></script> 
    <script src="js/pouchdb-6.4.2.min.js"></script> 
    <script src="js/pouchdb.find.js"></script> 
    
    <script src="js/function.js"></script>
    <script src="js/menu.js"></script>
    
    <script src="js/loadjs.js"></script>
    
    <script src="js/uuid.js"></script>
    
    <script src="js/load-page.js"></script> 
    
    <script src="js/addReference.js"></script> 
    
  </head>
  <body onload="loaded_modify_mission('donnees_mission_astre')">
  
    <script>
		logged_only();
		var clickedBtn = null;
		var debug;
		if (localStorage.getItem('debug') === null) {
			debug = '';
		} else {
			debug = localStorage.getItem('debug');
		};
		var html = 'donnees_mission';
		//loadjs('js/menu_rights.js');
	</script> 
  
    <!-- <script type="text/javascript">
    	showAlertFlash();
    </script> -->	
    
    <div class="page">
      <!-- Main Navbar-->
      <header class="header">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <!-- Navbar Header-->
              <div class="navbar-header">
                <!-- Navbar Brand --><a href="main.html" class="navbar-brand d-none d-sm-inline-block">
                  <div class="brand-text d-none d-lg-inline-block"><span>Projet</span><strong>EBO-SURSY</strong></div>
                  <div class="brand-text d-none d-sm-inline-block d-lg-none"><strong>ES</strong></div></a>
                <!-- Toggle Button--><a id="toggle-btn" href="#" class="menu-btn active"><span></span><span></span><span></span></a>
              </div>
              <!-- Navbar Menu -->
              <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                
                <li class="nav-item d-flex align-items-center">
                  <div class="led-box">
	    		    <div id="led"></div>
	    		    <p id="p_led"></p>
	    		  </div>
	            </li>
	                            
                <!-- Logout    -->
                <li class="nav-item"><a href="logout.html" class="nav-link logout">Se déconnecter<i class="fa fa-sign-out"></i></a></li>
              </ul>
            </div>
          </div>
        </nav>
      </header>
      <div class="page-content d-flex align-items-stretch"> 
        <!-- Side Navbar -->
        <nav class="side-navbar">
          <!-- Sidebar Header-->
          <div class="sidebar-header d-flex align-items-center">
            <img src="logos/Logo_1lign-eboSURSY_coul.jpg" class="img-fluid">
          </div>
          <!-- Sidebar Navidation Menus--><span class="heading">MENU</span>
          <ul class="list-unstyled">
                    
                    <li id="li_dashboard" name="10"> <a href="main.html"> <i class="a-logo-tableau-de-bord"></i></a></li>
                                        
                    <li id="li_transvihmiDropdown" name="1"> <a id="a_transvihmiDropdown" name="1" href="#ul_transvihmiDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-ird"></i> </a>
                      <ul id="ul_transvihmiDropdown" name="1" class="collapse list-unstyled">
                        
                        <li id="li_site_transvihmi" name="1" style="text-align: right"><a href="site_transvihmi.html">Site</a></li>                            
		                                        
                        <li id="li_batTransvihmiDropdown" name="1"><a id="a_batTransvihmiDropdown" name="1" href="#ul_batTransvihmiDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_batTransvihmiDropdown" name="1" class="collapse list-unstyled">
		                    
		                    <li id="li_suivi_longitudinal_donnees_missions_transvihmi" name="1"style="text-align: right"><a href="suivi_longitudinal_donnees_missions_transvihmi.html">Suivi longitudinal - données missions</a></li>
		                    <li id="li_suivi_longitudinal_donnees_journalieres_transvihmi" name="1"style="text-align: right"><a href="suivi_longitudinal_donnees_journalieres_transvihmi.html">Suivi longitudinal - données journalières</a></li>                            
                        		                    
		                    <li id="li_batTransvihmiCaptureesDropdown" name="1"><a id="a_batTransvihmiCaptureesDropdown" name="1" href="#ul_batTransvihmiCaptureesDropdown" aria-expanded="false" data-toggle="collapse"><i class="icon-capturee"></i>Capturées</a>
		                      <ul id="ul_batTransvihmiCaptureesDropdown" name="1" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_transvihmi" name="1"><a href="bat_capturees_transvihmi.html">données</a></li>                            
		                        <li id="li_bat_map_capturees_transvihmi" name="1"><a href="bat_map_capturees_transvihmi.html">carte</a></li>
		                        <li id="li_importation_bat_capturees_transvihmi" name="1"><a href="importation_chauves_souris_capturees_transvihmi.html">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_batTransvihmiNonInvasivesDropdown" name="1"><a id="a_batTransvihmiNonInvasivesDropdown" name="1" href="#ul_batTransvihmiNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse"></i>Non invasives</a>
		                      <ul id="ul_batTransvihmiNonInvasivesDropdown" name="1" class="collapse list-unstyled">
		                        <li id="li_bat_non_invasives_transvihmi" name="1"><a href="bat_non_invasives_transvihmi.html">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_transvihmi" name="1"><a href="bat_map_non_invasives_transvihmi.html">carte</a></li>
    	                        <li id="li_importation_bat_non_invasives_transvihmi" name="1"><a href="importation_chauves_souris_non_invasives_transvihmi.html">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	    <li id="li_viande_de_brousse_TransvihmiDropdown" name="1"><a id="a_viande_de_brousse_TransvihmiDropdown" name="1" href="#ul_viande_de_brousse_TransvihmiDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Picto_ANTILOPE"></i>Viande de brousse</a>
                      	  <ul id="ul_viande_de_brousse_TransvihmiDropdown" name="1" class="collapse list-unstyled">
                        	<li id="li_viande_de_broussetransvihmi" name="1"><a href="importation_viande_de_brousse_transvihmi.html">données</a>                           
                        	<li id="li_viande_de_brousse_map_transvihmi" name="1"><a href="viande_de_brousse_map_transvihmi.html">carte</a></li>
                        	<li id="li_importation_viande_de_brousse_transvihmi" name="1"><a href="importation_viande_de_brousse_transvihmi.html">importation/exportation</a></li>
                      	  </ul>
                    	</li>
                      </ul>
                    </li>
                    
                    <li id="li_mivegecDropdown" name="2"> <a id="a_mivegecDropdown" name="2" href="#ul_mivegecDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-mivegec"></i> </a>
                      <ul id="ul_mivegecDropdown" name="2" class="collapse list-unstyled">
                        
                        <li id="li_site_mivegec" name="2" style="text-align: right"><a href="site_mivegec.html">Site</a></li>                            
		                
                        <li id="li_bat_mivegecDropdown" name="2"><a id="a_bat_mivegecDropdown" name="2" href="#ul_bat_mivegecDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_bat_mivegecDropdown" name="2" class="collapse list-unstyled">
		                    
		                    <li id="li_suivi_longitudinal_donnees_missions_mivegec" name="2"style="text-align: right"><a href="suivi_longitudinal_donnees_missions_mivegec.html">Suivi longitudinal - données missions</a></li>
		                    <li id="li_suivi_longitudinal_donnees_journalieres_mivegec" name="2"style="text-align: right"><a href="suivi_longitudinal_donnees_journalieres_mivegec.html">Suivi longitudinal - données journalières</a></li>                            
                        		                    
		                    <li id="li_bat_mivegecCaptureesDropdown" name="2"><a id="a_bat_mivegecCaptureesDropdown" name="2" href="#ul_bat_mivegecCaptureesDropdown" aria-expanded="false" data-toggle="collapse"><i class="icon-capturee"></i>Capturées</a>
		                      <ul id="ul_bat_mivegecCaptureesDropdown" name="2" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_mivegec" name="2"><a href="bat_capturees_mivegec.html">données</a></li>                            
		                        <li id="li_bat_map_capturees_mivegec" name="2"><a href="bat_map_capturees_mivegec.html">carte</a></li>
		                        <li id="li_importation_bat_capturees_mivegec" name="2"><a href="importation_chauves_souris_capturees_mivegec.html">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_bat_mivegecNonInvasivesDropdown" name="2"><a id="a_bat_mivegecNonInvasivesDropdown" name="2" href="#ul_bat_mivegecNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse"></i>Non invasives</a>
		                      <ul id="ul_bat_mivegecNonInvasivesDropdown" name="2" class="collapse list-unstyled">
		                        <li id="li_bat_non_invasives_mivegec" name="2"><a href="bat_non_invasives_mivegec.html">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_mivegec" name="2"><a href="bat_map_non_invasives_mivegec.html">carte</a></li>
    	                        <li id="li_importation_bat_non_invasives_mivegec" name="2"><a href="importation_chauves_souris_non_invasives_mivegec.html">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	     <li id="li_viande_de_brousse_MivegecDropdown" name="2"><a id="a_viande_de_brousse_MivegecDropdown" href="#ul_viande_de_brousse_MivegecDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Picto_ANTILOPE"></i>Viande de brousse</a>
                      	  <ul id="ul_viande_de_brousse_MivegecDropdown" class="collapse list-unstyled">
                        	<li id="li_viande_de_broussemivegec" name="2"><a href="viande_de_brousse_mivegec.html">données</a></li>                            
                        	<li id="li_viande_de_brousse_map_mivegec" name="2"><a href="viande_de_brousse_map_mivegec.html">carte</a></li>
                        	<li id="li_importation_viande_de_brousse_mivegec" name="2"><a href="importation_viande_de_brousse_mivegec.html">importation/exportation</a></li>
                      	  </ul>
                    	</li>                    	
                      </ul>
                    </li>
                    
                    <li id="li_astreDropdown" name="6" class="active"> <a id="a_astreDropdown" href="#ul_astreDropdown" aria-expanded="true" data-toggle="collapse"> <i class="a-logo-cirad"></i> </a>
                      <ul id="ul_astreDropdown" name="6" class="collapse list-unstyled show">
                        
                        <li id="li_site_astre" name="6" style="text-align: right"><a href="site_astre.html">Site</a></li>                            
		               
                        <li id="li_batAstreDropdown" class="active" name="6"><a id="a_batAstreDropdown" href="#ul_batAstreDropdown" aria-expanded="true" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_batAstreDropdown" name="6" class="collapse list-unstyled show">
		                   
		                    <li id="li_suivi_longitudinal_donnees_missions_astre" class="active" name="6"style="text-align: right"><a href="suivi_longitudinal_donnees_missions_astre.html">Suivi longitudinal - données missions</a></li>
		                    <li id="li_suivi_longitudinal_donnees_journalieres_astre" name="6"style="text-align: right"><a href="suivi_longitudinal_donnees_journalieres_astre.html">Suivi longitudinal - données journalières</a></li>                            
                        		                   
		                    <li id="li_batAstreCaptureesDropdown" name="6"><a id="a_batAstreCaptureesDropdown" href="#ul_batAstreCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
		                      <ul id="ul_batAstreCaptureesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_astre" name="6"><a href="bat_capturees_astre.html">données</a></li>                            
		                        <li id="li_bat_map_capturees_astre" name="6"><a href="bat_map_capturees_astre.html">carte</a></li>
		                        <li id="li_importation_bat_capturees_astre" name="6"><a href="importation_chauves_souris_capturees_astre.html">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_batAstreNoninvasivesDropdown" name="6"><a id="a_batAstreNonInvasivesDropdown" name="6" href="#ul_batAstreNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
		                      <ul id="ul_batAstreNonInvasivesDropdown" name="6" class="collapse list-unstyled">
		                        <li id="li_bat_map_non_invasives_astre" name="6"><a href="bat_non_invasives_astre.html">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_astre" name="6"><a href="bat_map_non_invasives_astre.html">carte</a></li>
    	                        <li id="li_bat_map_non_invasives_astre" name="6"><a href="importation_chauves_souris_non_invasives_astre.html">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	  </ul>
                    </li>
                    
                    <li id="li_CIBUDropdown" name="3"> <a id="a_CIBUDropdown" name="3" href="#ul_CIBUDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-institut-pasteur"></i> </a>
                      <ul id="ul_CIBUDropdown" name ="3" class="collapse list-unstyled">
                        <li id="li_individualCIBUDropdown" name="3"><a id="a_individualCIBUDropdown" name="3" href="#ul_individualCIBUDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-rodent"></i>Individus</a>
                          <ul id="ul_individualCIBUDropdown" name="3" class="collapse list-unstyled">
		                    <li id="li_individualCIBUSpecies1Dropdown" name="3"><a id="a_individualCIBUSpecies1Dropdown" name="3" href="#ul_individualCIBUSpecies1Dropdown" aria-expanded="false" data-toggle="collapse">(Espèces?)</a>
		                      <ul id="ul_individualCIBUSpecies1Dropdown" name="3" class="collapse list-unstyled">
		                        <li id="li_individual_species1_CIBU" name="3"><a href="liste_cibu.html?table=individus_cibu">données</a></li>                            
		                        <li id="li_individual_map_species1_cibu" name ="3"><a href="#">carte</a></li>
		                        <li id="li_importation_individual_cibu" name="3"><a href="#">importation/exportation</a></li>                            
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	  </ul>
                    </li>
                    
                    <li id="li_EpvoDropdown" name="4"> <a id="a_EpvoDropdown" href="#ul_EpvoDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-epvo"></i> </a>
                      <ul id="ul_EpvoDropdown" class="collapse list-unstyled">
                        <li id="li_batEpvoDropdown" name="4"><a id="a_batEpvoDropdown" href="#ul_batEpvoDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_batEpvoDropdown" class="collapse list-unstyled">
		                    <li id="li_batEpvoCaptureesDropdown" name="4"><a id="a_batEpvoCaptureesDropdown" href="#ul_batEpvoCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
		                      <ul id="ul_batEpvoCaptureesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_epvo" name="4"><a href="#">données</a></li>                            
		                        <li id="li_bat_map_capturees_epvo" name="4"><a href="#">carte</a></li>
		                        <li id="li_importation_bat_epvo" name="4"><a href="#">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_batEpvoNoninvasivesDropdown" name="4"><a id="a_batEpvoNoninvasivesDropdown" href="#ul_batEpvoNoninvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
		                      <ul id="ul_batEpvoNoninvasivesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_non_invasives_epvo" name="4"><a href="#">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_epvo" name="4"><a href="#">carte</a></li>
    	                        <li id="li_importation_bat_epvo" name="4"><a href="#">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	  </ul>
                    </li>
                    
                    <li id="li_IPGDropdown" name="5"> <a id="a_IPGDropdown" href="#ul_IPGDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-IPG"></i> </a>
                      <ul id="ul_IPGDropdown" class="collapse list-unstyled">
                        <li id="li_batIPGDropdown" name="5"><a id="a_batIPGDropdown" href="#ul_batIPGDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_batIPGDropdown" class="collapse list-unstyled">
		                    <li id="li_batIPGCaptureesDropdown" name="5"><a id="a_batIPGCaptureesDropdown" href="#ul_batIPGCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
		                      <ul id="ul_batIPGCaptureesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_ipg" name="5"><a href="#">données</a></li>                            
		                        <li id="li_bat_map_capturees_ipg" name="5"><a href="#">carte</a></li>
		                        <li id="li_importation_bat_ipg" name="5"><a href="#">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_batIPGNoninvasivesDropdown" name="5"><a id="a_batIPGNoninvasivesDropdown" href="#ul_batIPGNoninvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
		                      <ul id="ul_batIPGNoninvasivesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_non_invasives_ipg" name="5"><a href="#">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_ipg" name="5"><a href="#">carte</a></li>
    	                        <li id="li_importation_bat_ipg" name="5"><a href="#">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	  </ul>
                    </li>
          </ul>
        </nav>
        <div class="content-inner">
          <!-- Page Header-->
          <header class="page-header">
            <div class="container-fluid">
              <h2 class="no-margin-bottom">Base de données mission</h2>
            </div>
          </header>
          
          <section>          
            <div class="container-fluid">              
              <div class="row">                
                <div class="col-lg-12">                  
                  <div class="card">        
                   <div class="card-header">
                     <h4>Suivi longitudinal - données mission</h4>
                    </div>
                    <div class="card-body">                                            
                      <form id="documentForm" name="documentForm" class="needs-validation" method="post" novalidate>
				        
				        <div class="card bg-light">
				          <div class="card-header card-header-transparent d-flex align-items-center">
                            <h3 class="h4">Identification</h3>
                          </div>
                          <div class="card-body">
                            <div class="row">
                              <div class="col-lg-4">
		            			<div class="form-group">
		                          <label for="Date_debut">Date de début</label>                                
		                          <div class="input-group">
		    						<input type="text" class="form-control input-datepicker" id="Date_debut"  name="Date_debut" placeholder="Date de début" required>
		    						<div class="input-group-addon open-datepicker btn btn-primary" id="spanDate1">
		                              <span class="fa fa-calendar"></span>
		    						</div>
		    					    <div class="invalid-feedback">
			                          S'il vous plaît fournir une date de début valide !
			                        </div>
		                          </div>
		    				    </div> 
		    				  </div>
		    				  <div class="col-lg-4">
		            			<div class="form-group">
		                          <label for="Date_fin">Date de fin</label>                                
		                          <div class="input-group">
		    						<input type="text" class="form-control input-datepicker" id="Date_fin"  name="Date_fin" placeholder="Date de fin" required>
		    						<div class="input-group-addon open-datepicker btn btn-primary" id="spanDate2">
		                              <span class="fa fa-calendar"></span>
		    						</div>
		    					    <div class="invalid-feedback">
			                          S'il vous plaît fournir une date de fin valide !
			                        </div>
		                          </div>
		    				    </div> 
		    				  </div>
                            </div>
                            <div class="row">
                              <div class="col-lg-6">                    	      
	      			    	    <div class="form-group">
	      			    	      <label for="ID_CS_debut">ID chauves-souris début</label>
					              <div class="input-group">
					                <input type="text" class="form-control" id="ID_CS_debut" placeholder="ID chauves-souris début" required>
	                                <div class="invalid-feedback">
		                      	      S'il vous plaît fournir un identifiant de chauve-souris valide !	      				  	      				    
	    					        </div>
	    					      </div>
	    					    </div>
							  </div>
						      <div class="col-lg-6">	
							    <div class="form-group">	  
							      <label for="ID_CS_fin">ID chauves-souris fin</label>
				          	      <input type="text" class="form-control" id="ID_CS_fin" placeholder="ID chauves-souris fin" >
                        	      <div class="invalid-feedback">
		                      	      S'il vous plaît fournir un identifiant de chauve-souris valide !	      				  	      				    
	    					      </div>
                        	    </div>											    
                              </div>
                            </div>        
                            <div class="row">
                              <div class="col-lg-6">                    	      
	      			    	    <div class="form-group">
	      			    	      <label for="ID_non_invasif_debut">ID non-invasif début</label>
					              <div class="input-group">
					                <input type="text" class="form-control" id="ID_non_invasif_debut" placeholder="ID non-invasif début" required>
	                                <div class="invalid-feedback">
		                      	      S'il vous plaît fournir un identifiant de chauve-souris valide !	      				  	      				    
	    					        </div>
	    					      </div>
	    					    </div>
							  </div>
						      <div class="col-lg-6">	
							    <div class="form-group">	  
							      <label for="ID_non_invasif_fin">ID non-invasif fin</label>
				          	      <input type="text" class="form-control" id="ID_non_invasif_fin" placeholder="ID non-invasif fin" required>
                        	      <div class="invalid-feedback">
		                      	      S'il vous plaît fournir un identifiant de chauve-souris valide !	      				  	      				    
	    					      </div>
                        	    </div>											    
                              </div>
                            </div>                                                                                
                          </div>
                        </div>
                        
                        <div class="card bg-light">
				          <div class="card-header card-header-transparent d-flex align-items-center">
                            <h3 class="h4">Données du site</h3>
                          </div>
                          <div class="card-body">
		      				
		      				<div class="row">
		      				  <div class="col-lg-4">
	            				<div class="form-group">
				                  <label for="N_site">N site</label>
			                      <div class="input-group">	                        
			                        <select id="N_site" class="form-control" onchange="select_N_site(this)">
	                                  <option></option>
	                          	    </select>
	                              </div>
			                    </div> 
	    					  </div>
	    					</div>	
		      				
		      				<div id="child_site" style="display: block;">		      				
			      				<div class="row">
			      				  <div class="col-lg-6">
		       					    <div class="form-group">
				                      <label for="Equipe">Equipe</label>
			                          <input type="text" class="form-control" id="Equipe" placeholder="Equipe" >
			                        </div>  	
			                      </div>         
			                      <div class="col-lg-6">           
			                        <div class="form-group">
			                          <label for="Pays">Pays</label>
			                          <div class="input-group">	                        
			                            <select id="Pays" class="form-control" required>
		                                  <option></option>
		                          	    </select>
		                                <label id="nouveauPays" class="input-group-addon btn btn-primary" for="Pays" data-toggle="modal" data-target="#nouvelleReference">
		       					          <span class="fa fa-plus"></span>
		    					        </label>
			                            <div class="invalid-feedback">
			        			          S'il vous plaît fournir un pays valide !
			      				        </div>
			      				      </div>
			      			        </div>
			      			      </div>
			      			    </div>	 
			      			       			      				      			    
			      			    <div class="row">
			      				  <div class="col-lg-6">
			      			        <div class="form-group">
			                          <label for="Region_capture">Région (ex. nom de la ville, nom du parc...)</label>
			                          <input type="text" class="form-control" id="Region_capture" placeholder="Région (ex. nom de la ville, nom du parc...)">
			                        </div>
			      			      </div>
			      			      <div class="col-lg-6">
			      			        <div class="form-group">
			                          <label for="Site_capture">Site précis de capture (ex. village, lieu-dit)</label>
			                          <input type="text" class="form-control" id="Site_capture" placeholder="Site précis de capture (ex. village, lieu-dit)">
			                        </div>
			      				  </div>
			      			    </div>	 
			      			         		
			      			    <div class="row">
			      			      <div class="col-lg-6">	    
			      			        <div class="form-group">
			                          <label for="Environnement">Environnement (ex. forêt)</label>
			                          <div class="input-group">	                        
			                            <select id="Environnement" class="form-control" required>
		                                  <option></option>
		                          	    </select>
		                                <label id="nouvelEnvironnement" class="input-group-addon btn btn-primary" for="Environnement" data-toggle="modal" data-target="#nouvelleReference">
		       					          <span class="fa fa-plus"></span>
		    					        </label>
			                            <div class="invalid-feedback">
			        			          S'il vous plaît fournir un environnement valide !
			      				        </div>
			      				      </div>
			      				    </div>
			      			      </div>
			      			      <div class="col-lg-6">      
		                            <div class="form-group">
			                          <label for="Proximite_village_km">Proximité du village en km</label>
			                          <input type="text" class="form-control" id="Proximite_village_km" placeholder="Proximité du village en km" >
			                        </div>	      				  
			      				  </div>
			      			    </div>     			    
			      			    
			      			    <div class="row">
		                    	  <div class="col-lg-4">
			      			    	<div class="form-group">
			      			    	  <label for="Lat_degre_dec">Latitude coord. (deg. déc.)</label>
									  <input type="text" class="form-control" id="Lat_degre_dec" placeholder="Latitude coordonnées" >
									</div>
								  </div>
								  <div class="col-lg-2">	
									<div class="form-group">	  
									  <label for="Latitude">Latitude</label>
		                          	  <select id="Latitude" class="form-control" required >
		                            	<option></option>
		                            	<option>N</option>
		                            	<option>S</option>
		                            	<option>Manquant</option>
		                          	  </select>
		                          	  <div class="invalid-feedback">
									    Latitude !
									  </div>
		                          	</div>	
		                          </div>											    
		                          <div class="col-lg-4">      			        
								    <div class="form-group">
									  <label for="Long_degre_dec">Longitude coord. (deg. déc.)</label>
									  <input type="text" class="form-control" id="Long_degre_dec" placeholder="Longitude coordonnées" >
									</div>	
								  </div>
								  <div class="col-lg-2">
								    <div class="form-group">
		                              <label for="Longitude">Longitude</label>
		                              <select id="Longitude" class="form-control" required >
		                                <option></option>
		                                <option>E</option>
		                                <option>W</option>
		                                <option>Manquant</option>
		                              </select>
		                              <div class="invalid-feedback">
									    Longitude !
									  </div>
		                            </div>
		                          </div>
		                        </div>
		                      </div>
			      			</div>
                        </div>
                        
                        <div class="card bg-light">
				          <div class="card-header card-header-transparent d-flex align-items-center">
                            <h3 class="h4">Caractérisation de site</h3>
                          </div>
                          <div class="card-body">
                          	<div class="row">                         	
                          	  <div class="col-lg-6">	    
			      		  	    <div class="form-group">
			                      <label for="Type">Type</label>
			                      <div class="input-group">	                        
			                        <select id="Type" class="form-control" required>
		                              <option></option>
		                              <option>Roost</option>
		                              <option>Nourrissage</option>
		                              <option>Roost/nourrissage</option>
		                              <option>Leck</option>
		                            </select>
			                        <div class="invalid-feedback">
			        	  	  	      S'il vous plaît fournir un type valide !
			      		  	  	    </div>
			      		  	  	  </div>
			      		  	    </div>    
			      		  	  </div> 
			      		  	  <div class="col-lg-6">	    
			      		  	    <div class="form-group">
			                      <label for="Type_Roost">Type de roost</label>
			                      <div class="input-group">	                        
			                        <select id="Type_Roost" class="form-control">
		                              <option></option>
		                              <option>Arbre</option>
		                              <option>Grotte</option>
		                              <option>Maison</option>
		                              <option>Autre</option>
		                            </select>
			      		  	  	  </div>
			      		  	    </div>    
			      		  	  
                          	  </div> 
                          	</div>                           
                          	
                          	<div class="row">
		                      <div class="col-lg-6">
			      			  	<div class="form-group">
			      			   	  <label for="Proximite_eau">Proximité d'un point d'eau (m)</label>
								  <input type="text" class="form-control" id="Proximite_eau" placeholder="Proximité d'un point d'eau (m)" >
								</div>
							  </div>
                          	  <div class="col-lg-6">
			      			   	<div class="form-group">
			      			   	  <label for="Hauteur_canope">Hauteur canopée (m)</label>
								  <input type="text" class="form-control" id="Hauteur_canope" placeholder="Hauteur canopée (m)" >
								</div>
							  </div>
                          	</div>
                          	
                          	<div class="row">  		
		      			      <div class="col-lg-12">	      
	    	      			    <div class="form-group">
		      			          <label for="Description_site">Description du site</label>
		                    	  <textarea class="form-control col-xs-12" id="Description_site" placeholder="Description du site" rows="3"></textarea>
		                        </div>
		      			      </div>
		                    </div> 
                          						      
						    <div class="row">
		                      <div class="col-lg-6">
			      			    <div class="form-group">
			      			      <label for="ID_genet_espece">Echantillon génétique d'espèce végétale ID</label>
								  <input type="text" class="form-control" id="ID_genet_espece" placeholder="Echantillon génétique d'espèce végétale ID" >
								</div>
							  </div>
							</div>
                          	
                          		      			      	      			      
		      			  </div>		      			      	      			      	      			      
		      			</div>
		      			
		      			<div class="card bg-light">
				          <div class="card-header card-header-transparent d-flex align-items-center">
                            <h3 class="h4">Caractérisation du site</h3>
                          </div>
                          <div class="card-body">
                          
                            <div class="content table-responsive table-full-width">
                        	  
                        	  <table id="example" class="table table-striped table-sm compact nowrap"> 
                          
		                        <thead>
						          <tr>
						            <th>Famille</th>
						            <th>Genre</th>
						            <th>Espece</th>
						            <th>Phénologie</th>
						            <th>Statut</th>
						            <th></th>
						          </tr>
						        </thead>
                          
                        	  </table>
                        	  
                        	  <div class="col-lg-2">	      
	    	      			    <div class="form-group">
								  <button id="addPhenologie" class="btn btn-danger btn-sm" style="width:100%; height: 100%">
                    				<i class="fa fa-plus"></i>
	               				  </button>
								</div>
						      </div>
                            </div>
		      			                                                                                         
                          </div>
                        </div>
                        
                        
                        <div class="card bg-light">
				          <div class="card-header card-header-transparent d-flex align-items-center">
                            <h3 class="h4">Interactions autres animaux et homme</h3>
                          </div>
                          <div class="card-body">
                        
	                        <div class="row">
		                      <div class="col-lg-6">
			      			  	<div class="form-group">
			      			   	  <label for="Espece_animale_sauvage">Espèces animales sauvages observées</label>
								  <input type="text" class="form-control" id="Espece_animale_sauvage" placeholder="Espèces animales sauvages observées" >
								</div>
							  </div>
                          	  <div class="col-lg-6">
			      			   	<div class="form-group">
			      			   	  <label for="Espece_animale_domestique">Espèces animales domestiques observées</label>
								  <input type="text" class="form-control" id="Espece_animale_domestique" placeholder="Espèces animales domestiques observées" >
								</div>
							  </div>
                          	</div>
                          	
                          	<div class="row">                         	
                          	  <div class="col-lg-6">	    
			      		  	    <div class="form-group">
			                      <label for="Interaction">Interaction CS/faune dom ou sauv</label>
			                      <div class="input-group">	                        
			                        <select id="Interaction" class="form-control" required>
		                              <option></option>
		                              <option>Oui</option>
		                              <option>Non</option>
		                            </select>
			                        <div class="invalid-feedback">
			        	  	  	      Indiquez s'il y a une interaction !
			      		  	  	    </div>
			      		  	  	  </div>
			      		  	    </div>    
			      		  	  </div>
			      		  	</div> 
			      		  	
			      		  	<div class="row">  		
		      			      <div class="col-lg-12">	      
	    	      			    <div class="form-group">
		      			          <label for="Description_interaction_animaux">Description de l'interaction</label>
		                    	  <textarea class="form-control col-xs-12" id="Description_interaction_animaux" placeholder="Description de l'interaction" rows="3"></textarea>
		                        </div>
		      			      </div>
		                    </div>        
		                    
		                    <div class="row">                         	
                          	  <div class="col-lg-3">
                          	    <div class="form-group">
                          	      <label>Activité humaine observée</label>
		                        </div>  
		                      </div>
		                      <div class="col-lg-6">
		                        <div class="form-group">
                          	      <div id="test"></div>
                          	      <script type="text/javascript">
	                          	    	i = 0;
		                          	    
	                          	    	if (localStorage.getItem('web') === 'oui') {
			              					var remote_couchdb = localStorage.getItem('remote_couchdb');
			              					var DB = new PouchDB(remote_couchdb + 'activite_humaine' + debug);
			              				} else {
			              					var DB = new PouchDB('activite_humaine' + debug);
			              				};
		                          		
			              				DB.allDocs({  		
		                          			include_docs: true,
		                          			attachments: true
		                          		}).then(function (result) {
		                          			// handle result
		                          			if (typeof(JSON.stringify(result)) != "undefined"){  
		                          		    	var activite_humaineTablesData = JSON.parse(JSON.stringify(result));
		                          		    	
		                          		    	
		                          		    	activite_humaineTablesData.rows.forEach(function(row){   
		                          		
		                          		    		var line = document.createElement("div");
		    		                          		line.innerHTML = '<label id="labelActivite_humaine' + i + '" class="checkbox-inline">' +
		                		                    					'<input id="Activite_humaine' + i + '" name="Activite_humaine" type="checkbox" value="' + row.doc.Activite_humaine + '"> ' +
		                		                    					row.doc.Activite_humaine +
		                		                    				 '</label>';
		                		                    document.getElementById("test").appendChild(line);
		         		    		                console.log('num checkbox : ' + i);
		                		                    i++;
		                		              	});		 
		                          		    }
		                          		}).catch(function (err) {
		                          			console.log(err);
		                          		});
		                          </script>
                          	    </div>
		                      </div>	
		                      <div class="col-lg-3">	      
	    	      		  	    <label id="nouvelleActiviteHumaine" class="input-group-addon btn btn-primary" for="Environnement" data-toggle="modal" data-target="#nouvelleReference" style="text-align: left">
		       					    <span class="fa fa-plus"></span>
		    					</label>
						      </div>	
		      			    </div>
		      			    
		      			    <div class="row">
		      			      <div class="col-lg-12">	      
	    	      			    <div class="form-group">
		      			          <label for="Description_interaction_homme">Description de l'interaction CS/homme</label>
		                          <textarea class="form-control col-xs-12" id="Description_interaction_homme" placeholder="Description de l'interaction CS/homme" rows="3"></textarea>
		                        </div>
		      			      </div>
		                    </div>      
		                    
		                    <div class="row">                         	
                              <div class="col-lg-4">	    
			      		        <div class="form-group">
			                      <label for="Camera_trap">Camera-trap</label>
			                      <div class="input-group">	                        
			                        <select id="Camera_trap" class="form-control" required>
		                              <option></option>
		                              <option>Oui</option>
		                              <option>Non</option>
		                            </select>
			                        <div class="invalid-feedback">
			        	     	      Camera-trap ?
			      		  	  	    </div>
			      		  	  	  </div>
			      		  	    </div>  
			      		  	  </div>  
			      		  	  <div class="col-lg-4">
			      			    <div class="form-group">
			      			      <label for="Heure_debut_camera">Heure début</label>
								  <input type="time" class="form-control" id="Heure_debut_camera" placeholder="Heure début" >
							    </div>
							  </div>
                          	  <div class="col-lg-4">
			      			    <div class="form-group">
			      			      <label for="Heure_fin_camera">Heure fin</label>
								  <input type="time" class="form-control" id="Heure_fin_camera" placeholder="Heure fin" >
								</div>
							  </div>
							</div>    
		      			    
                          </div>
                          
                        </div>
	      			      
	      			    <button id="save" name="submit" type="submit" class="btn btn-primary btn-fill pull-right ladda-button" data-style="expand-right">                        	
	            			<span class="ladda-label">Sauver données mission</span>
	            			<span class="ladda-spinner"></span>
						</button>  
	      			      
				      </form>
                                               
                    </div> 
                  </div>
                </div>
              </div>  
            </div>
          </section>            
          
          <!-- Page Footer-->
          <footer class="main-footer">
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-6">
                  <p>Projet EBO-SURSY  2017-2021</p>
                </div>
                <div class="col-sm-6 text-right">
                  <p>Conçu par Bruno Rosset - Cirad</p>
                </div>
              </div>
            </div>
          </footer>
        </div>
      </div>
    </div>
    
	<div id="nouvelleReference" tabindex="-1" role="dialog" aria-labelledby="nouvelleReference" aria-hidden="true" class="modal fade text-left">
      <div role="document" class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 id="referenceModalLabel" class="modal-title">ModalLabel</h4>
            <button type="button" data-dismiss="modal" aria-label="Close" class="close"><span aria-hidden="true">×</span></button>
          </div>
          <div class="modal-body">
            <form id="form-group-Reference">
              <div class="form-group">
                <label id="referenceLabel">Label</label>
                <input id="referenceInput" type="text" class="form-control">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button id="btnAnnuler" type="button" data-dismiss="modal" class="btn btn-secondary">Annuler</button>
            <!-- <button type="submit" class="btn btn-primary" id="btnAjouter">Ajouter</button> -->
            <button id="btnAjouter" name="submit" type="submit" class="btn btn-primary btn-fill pull-right ladda-button" data-style="expand-right">                        	
	          <span class="ladda-label">Ajouter</span>
	          <span class="ladda-spinner"></span>
			</button>  
          </div>
        </div>
      </div>
    </div>
	
    <script type="text/javascript">
    	$('.input-datepicker').datepicker({
        	language: 'fr',
        	autoclose: true
      	});
    </script>    
    
    <script type="text/javascript">
   		$('#spanDate1').click(function(){
	   		event.stopPropagation(); 
	   	    dp = $('#Date_debut').datepicker({
	   	    	language: 'fr',
	   	    	autoclose: true
	   	    });
	   		dp.show();
	   		$('#Date_debut').focus();
		});
   		
   		$('#spanDate2').click(function(){
	   		event.stopPropagation(); 
	   	    dp = $('#Date_fin').datepicker({
	   	    	language: 'fr',
	   	    	autoclose: true
	   	    });
	   		dp.show();
	   		$('#Date_fin').focus();
		});
    </script> 

    
    <script type="text/javascript">
    	function select_famille(select, select2, select3) {
     		
     		var valeur = select.options[select.selectedIndex].value;
		  	var Genre = select2;
		  	
		  	var Espece = select3;
			while (Espece.options.length) {
				Espece.remove(0);
		    };
		    
		    var nameEspece = "#nouvelle" + Espece.name;
		   
		    $(nameEspece).addClass('btn-outline-dark');
			$(nameEspece).addClass('input-group-addon-disabled');
			$(nameEspece).removeClass('btn-primary');
			Espece.disabled = true;		  	
		  	
			var nameGenre = "#nouveau" + Genre.name;
			
		  	if ((valeur == "") || (valeur == "INDETERMINEE") || (valeur == "Manquant")) {
				while (Genre.options.length) {
			  		Genre.remove(0);
			    };
			    $(nameGenre).addClass('btn-outline-dark');
				$(nameGenre).addClass('input-group-addon-disabled');
				$(nameGenre).removeClass('btn-primary');
				Genre.disabled = true;				
			} else {
				$(nameGenre).removeClass('btn-outline-dark');
				$(nameGenre).removeClass('input-group-addon-disabled');
				$(nameGenre).addClass('btn-primary');
			  	Genre.disabled = false;		    
			  	
			  	var especeTablesData = JSON.parse(localStorage.getItem('especeTablesData'));
	    		especeTablesData.rows[0].doc.Famille.forEach(function(row){    			
	    			
	    			if (row.Nom == valeur) {
	    			  	while (Genre.options.length) {
	    			  		Genre.remove(0);
	    			    };
	    			    Genre.options[Genre.options.length] = new Option("", "");

	    			    if (!("Genre" in row) == 0) {
	    			    	row.Genre.forEach(function(row1){
	    			    		Genre.options[Genre.options.length] = new Option(row1.Nom, row1.Nom);
	    			    	});
	    			    };
	    			    
	    			    Genre.options[Genre.options.length] = new Option("Manquant", "Manquant");
	    			} 
	    		});
			}
		}
		
		function select_genre(select, select2, select3) {
		
			var Espece = select3;
			var valeurGenre = select2.options[select2.selectedIndex].value;
			
			var nameEspece = "#nouvelle" + Espece.name;
		    
			if ((valeurGenre == "") || (valeurGenre == "Manquant")){
				while (Espece.options.length) {
					Espece.remove(0);
			    };
			    $(nameEspece).addClass('btn-outline-dark');
				$(nameEspece).addClass('input-group-addon-disabled');
				$(nameEspece).removeClass('btn-primary');
			    Espece.disabled = true;	  
			} else {
				$(nameEspece).removeClass('btn-outline-dark');
				$(nameEspece).removeClass('input-group-addon-disabled');
				$(nameEspece).addClass('btn-primary');
				Espece.disabled = false;	
				
				var valeurFamille = select.value;
			
				var especeTablesData = JSON.parse(localStorage.getItem('especeTablesData'));
	    		especeTablesData.rows[0].doc.Famille.forEach(function(row){    			
	    			
	    			if (row.Nom == valeurFamille) {
						if (!("Genre" in row) == 0) {
		    			    row.Genre.forEach(function(row1){
		    			  		if (row1.Nom == valeurGenre) {
			    			  		while (Espece.options.length) {
				    			  		Espece.remove(0);
				    			    };
				    			    Espece.options[Espece.options.length] = new Option("", "");
				    			    
				    			    if (!("Espece" in row1) == 0) {
				    			  		row1.Espece.forEach(function(row2){
				    			  			Espece.options[Espece.options.length] = new Option(row2.Nom, row2.Nom);     	    			
				    			  		});   
				    			    };
				    			  	
				    			  	Espece.options[Espece.options.length] = new Option("Manquant", "Manquant");
		    			  		}
		    			  	});
	    				};
	    			  	
	    				if (!("Genre" in row) == 0) {
	    			    	row.Genre.forEach(function(row1){
	    			  			if (row1.Nom == valeurGenre) {
		    			  			while (Espece.options.length) {
			    			  			Espece.remove(0);
			    			    	};
			    			    	Espece.options[Espece.options.length] = new Option("", "");
			    			    
			    			    	if (!("Espece" in row1) == 0) {
			    			  			row1.Espece.forEach(function(row2){
			    			  				Espece.options[Espece.options.length] = new Option(row2.Nom, row2.Nom);     	    			
			    			  			});   
			    			    	};
			    			  	
			    			  		Espece.options[Espece.options.length] = new Option("Manquant", "Manquant");
	    			  			}
	    			  		});
	    				}
	    			}
	    		});
			}
		}
		
	</script>
    
    <script type="text/javascript">
   		$('#nouveauPays').click(function(){   			
   			$('#referenceModalLabel').html('Nouveau Pays');
   			$('#referenceLabel').html('Pays :');
   			$('#referenceInput').prop('disabled', false);
   			$('#btnAjouter').data('data-id', 'pays');
   			clickedBtn = this;
   		});
   		
   		$('#nouvelEnvironnement').click(function(){
   			$('#referenceModalLabel').html('Nouvel Environnement');
   			$('#referenceLabel').html('Environnement :');
   			$('#referenceInput').prop('disabled', false);
   			$('#btnAjouter').data('data-id', 'environnement');   			
   			clickedBtn = this;   			
		});   		
   		   		
   		$("#btnAjouter").click(function(e){
	    	e.preventDefault();
	    	if(clickedBtn){	    		
	    		var l = Ladda.create(document.querySelector('.ladda-button'));
				l.start();				
				
				if ($(this).data('data-id') == 'pays') {
					var select = document.getElementById('Pays');	    		
					addReference(html, 'pays', 'Pays', select, null, null);	
   				} else if ($(this).data('data-id') == 'environnement') {
					var select = document.getElementById('Environnement');	    		
					addReference(html, 'environnement', 'Environnement', select, null, null);	
   				};
   				
   				var referenceInput = document.getElementById('referenceInput');
   				referenceInput.value = "";				
				l.stop();				
				clickedBtn = null;
	    		$('#nouvelleReference').modal('hide');
	        	// close the modal dialog.
	      	}
	    });
   		
   		$("#btnAnnuler").click(function(e){
	    	e.preventDefault();
	    	$('#nouvelleReference').modal('hide');
   		});
   		
   		$(function () {
   		    $('#nouvelleReference').on('hidden.bs.modal', function () {
   		    	removeModalDiv();
	   		});
   		});
   		
   		function removeModalDiv() {
   			try {
   				$('#referenceInput').prop('disabled', false);
   				var referenceInput = document.getElementById('referenceInput');
   				referenceInput.value = "";
	    		var genreForm = document.getElementById('form-group-Reference');
			    var genreLabel = document.getElementById('genreLabel');
			    var genreInput = document.getElementById('genreInput');
			    var genreDiv = document.getElementById('genreDiv');
			    genreDiv.removeChild(genreLabel);
			    genreDiv.removeChild(genreInput);
			    genreForm.removeChild(genreDiv);
		    }
	    	catch(error) {
	    	};	
   		};   		
   		
   		function addNom(NomX) {
		    this.Nom = NomX;
		    	    
		    this.NomX = function() {
		        return this.Nom;
		    };		    
		};
   		
    </script> 
    
    <script type="text/javascript">	
	    function select_N_site(select) {			
			var valeurN_site = select.options[select.selectedIndex].text;	
			
			if (valeurN_site == "") {
				
				var Equipe = document.getElementById("Equipe");
				Equipe.value = '';
				Equipe.disabled = false;
				
				var Pays = document.getElementById("Pays");			
				try {
					Pays.value = '';	
					Pays.disabled = false;
				}
				catch(err) {
				};
				
				var Region_capture = document.getElementById("Region_capture");
				Region_capture.value = '';
				Region_capture.disabled = false;
				
				var Site_capture = document.getElementById("Site_capture");
				Site_capture.value = '';
				Site_capture.disabled = false;
										
				var Environnement = document.getElementById("Environnement");
				Environnement.value = '';
				Environnement.disabled = false;
				
				var Lat_degre_dec = document.getElementById("Lat_degre_dec");
				Lat_degre_dec.value = '';
				Lat_degre_dec.disabled = false;
				
				var Latitude = document.getElementById("Latitude");
				Latitude.value = '';
				Latitude.disabled = false;
				
				var Lat_degre_dec = document.getElementById("Lat_degre_dec");
				Lat_degre_dec.value = '';
				Lat_degre_dec.disabled = false;
				
				var Longitude = document.getElementById("Longitude");
				Longitude.value = '';
				Longitude.disabled = false;
				
				var Long_degre_dec = document.getElementById("Long_degre_dec");
				Long_degre_dec.value = '';
				Long_degre_dec.disabled = false;
				
				var Proximite_village_km = document.getElementById("Proximite_village_km");
				Proximite_village_km.value = '';
				Proximite_village_km.disabled = false;
				
			} else {
				
				//var id = select.options[select.selectedIndex].value;
				
				if (localStorage.getItem('web') === 'oui') {
					var remote_couchdb = localStorage.getItem('remote_couchdb');
					var DB = new PouchDB(remote_couchdb + 'site_astre' + debug);
				} else {
					var DB = new PouchDB('site_astre' + debug);
				};	
				
				DB.find({
					selector: {N_site: valeurN_site},
					fields: ['_id', 'N_site', 'Equipe', 'Pays', 'Region_capture', 'Site_capture', 'Environnement', 
						     'Latitude', 'Lat_degre_dec', 'Longitude', 'Long_degre_dec', 'Proximite_village_km']
				}).then(function (result) {
					
					if (localStorage.getItem('web') === 'oui') {
						var remote_couchdb = localStorage.getItem('remote_couchdb');
						var DB2 = new PouchDB(remote_couchdb + 'site_astre' + debug);
					} else {
						var DB2 = new PouchDB('site_astre' + debug);
					};
					
					console.log(JSON.stringify(result));
					var res =  JSON.parse(JSON.stringify(result));
					id = res.docs[0]._id;
		    		
					DB2.get(id).then(function (doc) {
						
						var Equipe = document.getElementById("Equipe");
						Equipe.value = doc.Equipe;
						Equipe.disabled = true;
						
						var Pays = document.getElementById("Pays");			
						try {
							Pays.value = doc.Pays;	
							Pays.disabled = true;
						}
						catch(err) {
						};
						
						var Region_capture = document.getElementById("Region_capture");
						Region_capture.value = doc.Region_capture;
						Region_capture.disabled = true;
						
						var Site_capture = document.getElementById("Site_capture");
						Site_capture.value = doc.Site_capture;
						Site_capture.disabled = true;
												
						var Environnement = document.getElementById("Environnement");
						Environnement.value = doc.Environnement;
						Environnement.disabled = true;
						
						var Lat_degre_dec = document.getElementById("Lat_degre_dec");
						Lat_degre_dec.value = doc.Lat_degre_dec;
						Lat_degre_dec.disabled = true;
						
						var Latitude = document.getElementById("Latitude");
						Latitude.value = doc.Latitude;
						Latitude.disabled = true;
						
						var Lat_degre_dec = document.getElementById("Lat_degre_dec");
						Lat_degre_dec.value = doc.Lat_degre_dec;
						Lat_degre_dec.disabled = true;
						
						var Longitude = document.getElementById("Longitude");
						Longitude.value = doc.Longitude;
						Longitude.disabled = true;
						
						var Long_degre_dec = document.getElementById("Long_degre_dec");
						Long_degre_dec.value = doc.Long_degre_dec;
						Long_degre_dec.disabled = true;
						
						var Proximite_village_km = document.getElementById("Proximite_village_km");
						Proximite_village_km.value = doc.Proximite_village_km;
						Proximite_village_km.disabled = true;
						
					})
				});
				
				//var DB = new PouchDB('site_astre' + debug);
				
			}
		}
	</script>
     
    <script type="text/javascript">
    
    	// Example starter JavaScript for disabling form submissions if there are invalid fields
  		(function() {
  		  'use strict';
  		  window.addEventListener('load', function() {
  		    // Fetch all the forms we want to apply custom Bootstrap validation styles to
  		    var forms = document.getElementsByClassName('needs-validation');
  		    // Loop over them and prevent submission
  		    var validation = Array.prototype.filter.call(forms, function(form) {
  		      form.addEventListener('submit', function(event) {
  		    	if (form.checkValidity() === false) {
  		          event.preventDefault();
  		          event.stopPropagation();
  		        } else {
  		          event.preventDefault();
  		          modifyMission();
  		        } 		        
  		        form.classList.add('was-validated');
  		      }, false);
  		    });
  		  }, false);
  		})();
 		
  		function modifyMission() {  
  			
  			var l = Ladda.create( document.querySelector( '.ladda-button' ) );

			// Start loading
			l.start();
			
			var id = localStorage.getItem('ID_donnees_mission_astre');
			
			var Date_debut = document.getElementById('Date_debut').value;
			var Date_fin = document.getElementById('Date_fin').value;
			var ID_CS_debut = document.getElementById('ID_CS_debut').value;
			var ID_CS_fin = document.getElementById('ID_CS_fin').value;
			var ID_non_invasif_debut = document.getElementById('ID_non_invasif_debut').value;
			var ID_non_invasif_fin = document.getElementById('ID_non_invasif_fin').value;
			var N_site = document.getElementById('N_site').value;
			
			var Equipe = document.getElementById('Equipe').value;
			var Pays = document.getElementById('Pays').value;
			var Region_capture = document.getElementById('Region_capture').value;
			var Site_capture = document.getElementById('Site_capture').value;
			var Environnement = document.getElementById('Environnement').value;
			var Lat_degre_dec = document.getElementById('Lat_degre_dec').value;
			var Latitude = document.getElementById('Latitude').value;
			var Long_degre_dec = document.getElementById('Long_degre_dec').value;
			var Longitude = document.getElementById('Longitude').value;
			var Proximite_village_km = document.getElementById('Proximite_village_km').value;
							
			var Type = document.getElementById('Type').value;	
			var Type_Roost = document.getElementById('Type_Roost').value;
			var ID_genet_espece = document.getElementById('ID_genet_espece').value;	
			var Proximite_eau = document.getElementById('Proximite_eau').value;	
			var Hauteur_canope = document.getElementById('Hauteur_canope').value;	
			var Description_site = document.getElementById('Description_site').value;	
			var Espece_animale_sauvage = document.getElementById('Espece_animale_sauvage').value;	
			var Espece_animale_domestique = document.getElementById('Espece_animale_domestique').value;	
			var Interaction = document.getElementById('Interaction').value;	
			var Description_interaction_animaux = document.getElementById('Description_interaction_animaux').value;	
			
			
			
			var Activite_humaine = '';
			var Activite_humaine1 = document.getElementById('Activite_humaine1');
	        if (Activite_humaine1.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Chasse';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Chasse';
	        	};
	        };
	        var Activite_humaine2 = document.getElementById('Activite_humaine2');
	        if (Activite_humaine2.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Jeu';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Jeu';
	        	};
	        };
	        var Activite_humaine3 = document.getElementById('Activite_humaine3');
	        if (Activite_humaine3.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Consommation';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Consommation';
	        	};
	        };
	        var Activite_humaine4 = document.getElementById('Activite_humaine4');
	        if (Activite_humaine4.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Culture';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Culture';
	        	};
	        };
	        var Activite_humaine4 = document.getElementById('Activite_humaine5');
	        if (Activite_humaine4.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Abre à palabre';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Abre à palabre';
	        	};
	        };
	        var Activite_humaine4 = document.getElementById('Activite_humaine6');
	        if (Activite_humaine4.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Rituel';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Rituel';
	        	};
	        };
	        var Activite_humaine5 = document.getElementById('Activite_humaine7');
	        if (Activite_humaine5.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Consommation fruits';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Consommation fruits';
	        	};
	        };
	        var Activite_humaine6 = document.getElementById('Activite_humaine8');
	        if (Activite_humaine6.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Utilisation guano';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Utilisation guano';
	        	};
	        };
	        var Activite_humaine7 = document.getElementById('Activite_humaine9');
	        if (Activite_humaine7.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Abri';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Abri';
	        	};
	        };
	        var Activite_humaine10 = document.getElementById('Activite_humaine10');
	        if (Activite_humaine10.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Autre';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Autre';
	        	};
	        };
	        var Activite_humaine10 = document.getElementById('Activite_humaine11');
	        if (Activite_humaine10.checked) {
	        	if (Activite_humaine == '') {
	        		Activite_humaine = 'Aucun';
		        } else {
	        		Activite_humaine = Activite_humaine + ', Aucun';
	        	};
	        };
			
			
			var Description_interaction_homme = document.getElementById('Description_interaction_homme').value;	
			var Camera_trap = document.getElementById('Camera_trap').value;	
			var Heure_debut_camera = document.getElementById('Heure_debut_camera').value;	
			var Heure_fin_camera = document.getElementById('Heure_fin_camera').value;
			
			var row =[];
						
			var table = document.getElementById('example');
	        var rowCount = table.rows.length;
	        
	        try {
		        if (rowCount > 1) {
			        for (i=1; i<rowCount; i++){
			            var selects = table.rows.item(i).getElementsByTagName("select");
			            //console.log(selects[0].value + ' - ' + selects[1].value + ' - ' + selects[2].value + ' - ' + selects[3].value + ' - ' + selects[4].value);
			            row[i-1] = new addPhenologie(selects[0].value, selects[1].value, selects[2].value, selects[3].value, selects[4].value);
					}; 
		        };
		        var Phenologie = JSON.stringify(row);
				Phenologie = JSON.parse(Phenologie);
			}catch(err) {
				var Phenologie = JSON.stringify(row);
				Phenologie = JSON.parse(Phenologie);
			};
			
			var debug;
			if (localStorage.getItem('debug') === null) {
				debug = '';
			} else {
				debug = localStorage.getItem('debug');
			};
			
			if (localStorage.getItem('web') === 'oui') {
				var remote_couchdb = localStorage.getItem('remote_couchdb');
				var DB = new PouchDB(remote_couchdb + 'donnees_mission_astre' + debug);
			} else {
				var DB = new PouchDB('donnees_mission_astre' + debug);
			};	
			
			DB.find({
				selector: {_id: id},
				fields: ['_id', 'Date', 'Heure_debut', 'Heure_fin', 'Equipe', 'Pays', 'Region_collecte', 'Site_collecte', 'Environnement', 'Lieu_collecte', 'Lat_degre_dec', 'Latitude', 'Long_degre_dec', 'Longitude', 'Type_site', 'Proximite_village_km', 'Type_chauves_souris', 'Famille_1', 'Genre_1', 'Espece_1', 'Famille_2', 'Genre_2', 'Espece_2', 'Famille_3',' Genre_3', 'Espece_3', 'Remarques', 'Echantillons']
			}).then(function (result) {
		
				if (localStorage.getItem('web') === 'oui') {
					var remote_couchdb = localStorage.getItem('remote_couchdb');
					var DB2 = new PouchDB(remote_couchdb + 'donnees_mission_astre' + debug);
				} else {
					var DB2 = new PouchDB('donnees_mission_astre' + debug);
				};	
				
				DB2.get(id).then(function (doc) {
					
					doc.Date_debut = Date_debut;
					doc.Date_fin = Date_fin;
					doc.ID_CS_debut = ID_CS_debut;
					doc.ID_CS_fin = ID_CS_fin;
					doc.ID_non_invasif_debut = ID_non_invasif_debut;
					doc.ID_non_invasif_fin = ID_non_invasif_fin;
					doc.N_site = N_site;
					doc.Equipe = Equipe;
					doc.Pays = Pays;
					doc.Region_capture = Region_capture;
					doc.Site_capture = Site_capture;
					doc.Environnement = Environnement;
					doc.Lat_degre_dec = Lat_degre_dec;
					doc.Latitude = Latitude;
					doc.Long_degre_dec = Long_degre_dec;
					doc.Longitude = Longitude;
					doc.Proximite_village_km = Longitude;
				
					doc.Type = Type; 	
					doc.Type_Roost = Type_Roost; 
					doc.ID_genet_espece = ID_genet_espece; 	
					doc.Proximite_eau = Proximite_eau; 	
					doc.Hauteur_canope = Hauteur_canope;	
					doc.Description_site = Description_site;
					doc.Espece_animale_sauvage = Espece_animale_sauvage;	
					doc.Espece_animale_domestique = Espece_animale_domestique; 	
					doc.Interaction = Interaction;	
					doc.Description_interaction_animaux = Description_interaction_animaux;	
					doc.Activite_humaine = String(Activite_humaine);	
					doc.Description_interaction_homme = Description_interaction_homme;	
					doc.Camera_trap = Camera_trap;	
					doc.Heure_debut_camera = Heure_debut_camera;	
					doc.Heure_fin_camera = Heure_fin_camera;
					doc.Phenologie = Phenologie;
				
					return DB2.put(doc);
				}).then(function () {
					return DB2.get(id);
				}).then(function (doc) {	
			
					if ((navigator.onLine) && (localStorage.getItem('web') !== 'oui')) {
						var localDB3 = new PouchDB('donnees_mission_astre' + debug);	
						var remote_couchdb = localStorage.getItem('remote_couchdb');
						var remoteDB = new PouchDB(remote_couchdb + 'donnees_mission_astre' + debug, {skip_setup: true});
					
						localDB3.sync(remoteDB).on('complete', (info) => { 
							window.location = 'suivi_longitudinal_donnees_missions_astre.html';
						}).on('error', function (err) {
							// error while replicating
							alert('alert sync new donnees mission astre: ' + JSON.stringify(err));
							window.location = 'login.html';
						});
					} else {
						window.location = 'suivi_longitudinal_donnees_missions_astre.html';
					}
					l.stop();
				});
			}).catch(function (err) {
				alert(JSON.stringify(err));
				console.log(err);
			});	
  		};
  		
	</script>
	
	<script type="text/javascript">	
	
		$('#addPhenologie').click(function(e){
		   	e.preventDefault();
		   	var table = $('#example').DataTable();
		   	var rowCount= table.rows().data().length;
		   	addRow(table, rowCount + 1);
		});
		
		$(document).on('click', ".deletebtn", function (e) {
	    	e.preventDefault();
	    	var table = $('#example').DataTable();
	    	table.row($(this).parents('tr')).remove().draw();
	    });	
	
	</script>
	
	<script type="text/javascript">	
	
		$(document).ready(function() {			
			var table = $('#example').DataTable({
				searching: false,
				columns: [
					{ data: null, render: 'Famille', width: '20%'},					
					{ data: null, render: 'Genre', width: '20%'},
					{ data: null, render: 'Espece', width: '20%'},
			        { data: null, render: 'Pheno_espece', width: '18%'},
					{ data: null, render: 'Statut_espece', width: '17%'},
			        { data: null, render: 'Action', width: '5%'}
			    ],
			    language: {
	                url: 'plug-ins/i18n/French.lang.json'
			    },
			    ordering: false,
			    lengthChange: false,
			    info: false
			});		
		
			var id = localStorage.getItem('ID_donnees_mission_astre');
		
			var DB = new PouchDB('donnees_mission_astre' + debug);
		  	DB.allDocs({
		  		keys: [id],
		  		include_docs: true,
				attachments: true
			}).then(function (result) {
				// handle result
				if (typeof(JSON.stringify(result)) != "undefined"){  
		    		localStorage['datadonnees_mission_astreTablesData'] = JSON.stringify(result);
		    		console.log(JSON.stringify(result));
		    				    						    
		    		var datadonnees_mission_astreTablesData = JSON.parse(localStorage.getItem('datadonnees_mission_astreTablesData'));
		    				    		
		    		var i = 1;
		    		datadonnees_mission_astreTablesData.rows[0].doc.Phenologie.forEach(function(row){   
		    			
		    			table.row.add(new Phenologie(
		    					'<div class="form-group">' +
		    					'<select id="Famille' + i.toString() + '" class="form-control" onchange="select_famille(this, Genre' + i.toString() + ', Espece' + i.toString() + ')" required>' +
		    						'<option></option>' +               
		    					'</select>' +
		    					'<div class="invalid-feedback">' +
		    						'Famille invalide !' +
		    					'</div>' +
		    				'</div>',
		    				'<div class="form-group">' +
		    					'<div class="input-group">' +
		    						'<select id="Genre' + i.toString() + '" class="form-control" onchange="select_genre(Famille' + i.toString() + ', this, Espece' + i.toString() + ')" required>' +
		    							'<option></option>' +           
		    						'</select>' +
		    						'<div class="invalid-feedback">' +
		    							'Genre invalide !'  +
		    						'</div>' + 
		    					'</div>' +
		    				'</div>',
		    				'<div class="form-group">' +
		    					'<div class="input-group">' +
		    						'<select id="Espece' + i.toString() + '" class="form-control" required>' +
		    							'<option></option>' +           
		    						'</select>' +
		    						'<div class="invalid-feedback">' +
		    							'Espece invalide !'  +
		    						'</div>' + 
		    					'</div>' +
		    				'</div>',
		    				'<div class="form-group">' +
		    					'<div class="input-group">' +
		    						'<select id="Pheno_espece' + i.toString() + '" class="form-control" required>' +
		    							'<option></option>' +
		    							'<option>Floraison</option>' +
		    							'<option>Fructif</option>' +
		    							'<option>Aucun</option>' +
		    						'</select>' +
		    						'<div class="invalid-feedback">' +
		    							'Phénologie invalide !'  +
		    						'</div>' + 
		    					'</div>' +
		    				'</div>',
		    				'<div class="form-group">' +
		    					'<div class="input-group">' +
		    						'<select id="Statut_espece' + i.toString() + '" class="form-control" required>' +
		    							'<option></option>' +
		    							'<option>Cultivée</option>' +
		    							'<option>Sauvage</option>' +
		    							'<option>IN</option>' +           
		    						'</select>' +
		    						'<div class="invalid-feedback">' +
		    							'Statut invalide !'  +
		    						'</div>' + 
		    					'</div>' +
		    				'</div>',
		    				'<div class="form-group">' +
		    					'<button id="deletePhenologie" class="btn btn-danger btn-sm deletebtn">' +
		    						'<span class="fa fa-minus"></span>' +
		    					'</button>' +
		    				'</div>'
		    			));
		    			
		    			i = i + 1;
					});
		    		table.draw();
		    		
		    		/*for (var i=1; i<table.data().length+1; i++) {
		    			FamilleList(i);
		    		};*/
		    		
		    		//alert(datadonnees_mission_astreTablesData.rows[0].doc.Phenologie[0].Famille);
		    		//alert(datadonnees_mission_astreTablesData.rows[0].doc.Phenologie[1].Famille);
		    		
		    		i = 0;
		    		j = 1;
		    		datadonnees_mission_astreTablesData.rows[0].doc.Phenologie.forEach(function(row){ 		    			
		    			FamilleList(j, row.Famille);
		    			select_change(document.getElementById('Famille' + j),
		    				   document.getElementById('Genre' + j),
		    				   document.getElementById('Espece' + j),
		    				   row.Famille,
		    				   row.Genre,
		    				   row.Espece);
		    			//
		    			/*table.cell(i,0).nodes().to$().find('select').val(row.Famille);
		    			table.cell(i,1).nodes().to$().find('select').val(row.Genre);
		    			table.cell(i,2).nodes().to$().find('select').val(row.Espece);*/
		    					    			
		    			table.cell(i,3).nodes().to$().find('select').val(row.Pheno_espece);
		    			table.cell(i,4).nodes().to$().find('select').val(row.Statut_espece);
		    			
		    			i = i + 1;	    	
		    			j = j + 1;
		    		});
		    		
				}
			}).catch(function (err) {
				console.log(err);
			}); 	
						
		});
		
		
		
		function FamilleList(i, nom) {
			var Famille = document.getElementById('Famille' + i);
			var DB = new PouchDB('espece' + debug);
			DB.allDocs({  		
				include_docs: true,
				attachments: true
			}).then(function (result) {
				// handle result
				if (typeof(JSON.stringify(result)) != "undefined"){  
			   		//localStorage['especeTablesData'] = JSON.stringify(result);
		    		//var especeTablesData = JSON.parse(localStorage.getItem('especeTablesData'));
		    		
		    		var especeTablesData = JSON.parse(JSON.stringify(result));
		    		
			   		especeTablesData.rows[0].doc.Famille.forEach(function(row){   
			   			Famille.options[Famille.options.length] = new Option(row.Nom, row.Nom); 
			   		});	
			   		
			   		Famille.options[Famille.options.length] = new Option("Manquant", "Manquant");
			   		
			   		/*if (add) {
			    		try {
			    			select_change(Famille_terrain, Genre_terrain, Espece_terrain, doc.Famille_terrain, doc.Genre_terrain, doc.Espece_terrain);
			    			select_change(Famille_labo, Genre_labo, Espece_labo, doc.Famille_labo, doc.Genre_labo, doc.Espece_labo);
			    			select_change(Famille_consensus, Genre_consensus, Espece_consensus, doc.Famille_consensus, doc.Genre_consensus, doc.Espece_consensus);
			    		}
			    		catch(err) {
			    		};
			    	};*/
			    	
			   		Famille.value = nom;
			    	
				}
			}).catch(function (err) {
				console.log(err);
			});
		}
		
	</script>	
		
	<script type="text/javascript">	
		function addRow(table, id) {
			table.row.add(new Phenologie(
				'<div class="form-group">' +
					'<select id="Famille' + id + '" class="form-control" onchange="select_famille(this, Genre' + id + ', Espece' + id + ')" required>' +
						'<option></option>' +               
					'</select>' +
					'<div class="invalid-feedback">' +
						'Famille invalide !' +
					'</div>' +
				'</div>',
				'<div class="form-group">' +
					'<div class="input-group">' +
						'<select id="Genre' + id + '" class="form-control" onchange="select_genre(Famille' + id + ', this, Espece' + id + ')" required>' +
							'<option></option>' +           
						'</select>' +
						'<div class="invalid-feedback">' +
							'Genre invalide !'  +
						'</div>' + 
					'</div>' +
				'</div>',
				'<div class="form-group">' +
					'<div class="input-group">' +
						'<select id="Espece' + id + '" class="form-control" required>' +
							'<option></option>' +           
						'</select>' +
						'<div class="invalid-feedback">' +
							'Espece invalide !'  +
						'</div>' + 
					'</div>' +
				'</div>',
				'<div class="form-group">' +
					'<div class="input-group">' +
						'<select id="Pheno_espece' + id + '" class="form-control" required>' +
							'<option></option>' +
							'<option>Floraison</option>' +
							'<option>Fructif</option>' +
							'<option>Aucun</option>' +
						'</select>' +
						'<div class="invalid-feedback">' +
							'Phénologie invalide !'  +
						'</div>' + 
					'</div>' +
				'</div>',
				'<div class="form-group">' +
					'<div class="input-group">' +
						'<select id="Statut_espece' + id + '" class="form-control" required>' +
							'<option></option>' +
							'<option>Cultivée</option>' +
							'<option>Sauvage</option>' +
							'<option>IN</option>' +           
						'</select>' +
						'<div class="invalid-feedback">' +
							'Statut invalide !'  +
						'</div>' + 
					'</div>' +
				'</div>',
				'<div class="form-group">' +
					'<button id="deletePhenologie" class="btn btn-danger btn-sm deletebtn">' +
						'<span class="fa fa-minus"></span>' +
					'</button>' +
				'</div>'
			));

			//move added row to desired index (here the row we clicked on)
			var index = 0,
				rowCount = table.data().length-1,
				insertedRow = table.row(rowCount).data(),
				tempRow,
				select_Famille,
				select_Genre,
				select_Espece,
				select_Pheno_espece,
				select_Statut_espece;
			
			for (var i=rowCount;i>index;i--) {
				tempRow = table.row(i-1).data();
				
				select_Famille = table.cell(i-1,0).nodes().to$().find('select').val();
				/*table.cell(i-1,0).nodes().to$().find('select > option').each(function(){
					alert($(this).val());
				});*/
				select_Genre = table.cell(i-1,1).nodes().to$().find('select').val();
				select_Espece = table.cell(i-1,2).nodes().to$().find('select').val();
				select_Pheno_espece = table.cell(i-1,3).nodes().to$().find('select').val();
				select_Statut_espece = table.cell(i-1,4).nodes().to$().find('select').val();
				
				table.row(i).data(tempRow);
				
				table.cell(i-1,0).nodes().to$().find('select > option').each(function(){
					if ($(this).val() !== '') {
						table.cell(i,0).nodes().to$().find('select').append('<option value="' + $(this).val() + '">' + $(this).val() + '</option>');
					};
				});
				table.cell(i,0).nodes().to$().find('select').val(select_Famille);
								
				table.cell(i-1,1).nodes().to$().find('select > option').each(function(){
					if ($(this).val() !== '') {
						table.cell(i,1).nodes().to$().find('select').append('<option value="' + $(this).val() + '">' + $(this).val() + '</option>');
					};
				});
				table.cell(i,1).nodes().to$().find('select').val(select_Genre);
		    			
				table.cell(i-1,2).nodes().to$().find('select > option').each(function(){
					if ($(this).val() !== '') {
						table.cell(i,2).nodes().to$().find('select').append('<option value="' + $(this).val() + '">' + $(this).val() + '</option>');
					};
				});
				table.cell(i,2).nodes().to$().find('select').val(select_Espece);
		    	
				table.cell(i,3).nodes().to$().find('select').val(select_Pheno_espece);
				table.cell(i,4).nodes().to$().find('select').val(select_Statut_espece);
					
				table.row(i-1).data(insertedRow);
				
			};

			    	
			//refresh the current page
			table.page(0).draw(false);
			document.getElementById('Famille' + id).focus();
			
			FamilleList(table.data().length);
			
			for (var i=rowCount+1;i>0;i--) {
				//alert('Famille' + i);
				var Famille = document.getElementById('Famille' + i);
				var Genre = document.getElementById('Genre' + i);
				var Espece = document.getElementById('Espece' + i);
				
				if ((Famille.value == '') || (Genre.value == '')) {
					select_famille(Famille, Genre, Espece)
					//Famille.onchange();
				} else if (Espece.value == '') {
					//Genre.onchange();
					select_genre(Famille, Genre, Espece)
				};
				
			};
			
			function FamilleList(i) {
				var Famille = document.getElementById('Famille' + i);
				var DB = new PouchDB('espece' + debug);
				DB.allDocs({  		
					include_docs: true,
					attachments: true
				}).then(function (result) {
					// handle result
					if (typeof(JSON.stringify(result)) != "undefined"){  
				   		//localStorage['especeTablesData'] = JSON.stringify(result);
			    		//var especeTablesData = JSON.parse(localStorage.getItem('especeTablesData'));
			    		
			    		var especeTablesData = JSON.parse(JSON.stringify(result));
			    		
				   		especeTablesData.rows[0].doc.Famille.forEach(function(row){   
				   			Famille.options[Famille.options.length] = new Option(row.Nom, row.Nom); 
				   		});	
				   		
				   		Famille.options[Famille.options.length] = new Option("Manquant", "Manquant");
				   		
				   		/*if (add) {
				    		try {
				    			select_change(Famille_terrain, Genre_terrain, Espece_terrain, doc.Famille_terrain, doc.Genre_terrain, doc.Espece_terrain);
				    			select_change(Famille_labo, Genre_labo, Espece_labo, doc.Famille_labo, doc.Genre_labo, doc.Espece_labo);
				    			select_change(Famille_consensus, Genre_consensus, Espece_consensus, doc.Famille_consensus, doc.Genre_consensus, doc.Espece_consensus);
				    		}
				    		catch(err) {
				    		};
				    	};*/
				    	
					}
				}).catch(function (err) {
					console.log(err);
				});
			}
			
			
			
		};
	
		function Phenologie(Famille, Genre, Espece, Pheno_espece, Statut_espece, Action) {
		    this._Famille = Famille;
		    this._Genre = Genre;					
		    this._Espece = Espece;
		    this._Pheno_espece = Pheno_espece;
		    this._Statut_espece = Statut_espece;
		    this._Action = Action;
		    		    
		    this.Famille = function() {
		    	return this._Famille;
		    };
		    
		    this.Genre = function() {
		        return this._Genre;
		    };
		    
		    this.Espece  = function () {
		    	return this._Espece;
		    };
		 
		    this.Pheno_espece = function () {
		        return this._Pheno_espece;
		    };	
		    
		    this.Statut_espece = function () {
		        return this._Statut_espece;
		    };
		    
		    this.Action = function () {
		        return this._Action;
		    };
		};
		
		function addPhenologie(FamilleX, GenreX, EspeceX, Pheno_especeX, Statut_especeX) {
		    this.Famille = FamilleX;
		    this.Genre = GenreX;
		    this.Espece = EspeceX;
		    this.Pheno_espece = Pheno_especeX;
		    this.Statut_espece = Statut_especeX;
		    	    
		    this.FamilleX = function() {
		        return this.Famille;
		    };
		    
		    this.GenreX = function() {
		        return this.Genre;
		    };
		    
		    this.EspeceX = function() {
		        return this.Espece;
		    };
		    
		    this.Pheno_especeX = function() {
		        return this.Pheno_espece;
		    };
		    
		    this.Statut_especeX = function() {
		        return this.Statut_espece;
		    };
		    
		};
		
	</script>	
	
  </body>
</html>
	 