<!DOCTYPE html>
<html>
  <head>
  
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Projet EBO-SURSY</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
        
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="css/fontastic.css">
    <!-- Google fonts - Poppins -->	
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
    
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.premium.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">    
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <link rel="stylesheet" href="css/icone.css">
    
    <link rel="stylesheet" href="css/offline_online.css">
    
    <script src="vendor/jquery/jquery.min.js"></script>
    
    <script src="vendor/jquery/jquery.min.js" onload="window.$ = window.jQuery = module.exports;"></script>
	<script>
		delete window.module;
	</script>	
	<!-- Javascript files-->
    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>    
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <!-- Notifications-->
    <script src="vendor/messenger-hubspot/build/js/messenger.min.js"></script>
    <script src="vendor/messenger-hubspot/build/js/messenger-theme-flat.js"></script>
    <!-- <script src="js/home-premium.js"> </script> -->
    
    <!-- Bootstrap DatePicker-->
    <script src="vendor/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="vendor/bootstrap-datepicker/locales/bootstrap-datepicker.fr.min.js" charset="UTF-8"></script>
   
    <!-- Main File-->
    <script src="js/front.js"></script> 
        
    <script src="js/pouchdb.authentication.js"></script> 
    <!-- <script src="js/pouchdb-7.0.0.js"></script> --> 
    <script src="js/pouchdb-6.4.2.min.js"></script> 
    <script src="js/pouchdb.find.js"></script>
    
    <script src="js/function.js"></script>
    <script src="js/menu.js"></script>
    
    <script src="js/loadjs.js"></script>
    
    <script src="js/uuid.js"></script>
    
    <script src="js/load-page-exportation.js"></script>
    
    <script src="node_modules/alasql/dist/alasql.js"></script>
    
    <!-- Bootstrap Select-->
    <script src="vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
    <!-- Bootstrap Touchspin-->
    <script src="vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
    <!-- MultiSelect-->
    <script src="vendor/multiselect/js/jquery.multi-select.js"> </script>
    <!-- Forms init-->
    <script src="js/forms-advanced.js"></script>
    
    <script src="js/FileSaver.js"></script>
    
    <script src="js/clock.js"></script>
    
  </head>
  <!-- <body onload="chargement_de_la_table_site()">   -->
  <body>
    <script>
		logged_only();
		
		let searchParams = new URLSearchParams(window.location.search);
		nom_table = searchParams.get('table');
		type_table = searchParams.get('type'); 
		
		localStorage['export_table'] = nom_table;
	</script> 
    
    <div class="page">
      <!-- Main Navbar-->
      <header class="header">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <!-- Navbar Header-->
              <div class="navbar-header">
                <!-- Navbar Brand --><a href="main.html" class="navbar-brand d-none d-sm-inline-block">
                  <div class="brand-text d-none d-lg-inline-block"><span>Projet</span><strong>EBO-SURSY</strong></div>
                  <div class="brand-text d-none d-sm-inline-block d-lg-none"><strong>ES</strong></div></a>
                <!-- Toggle Button--><a id="toggle-btn" href="#" class="menu-btn active"><span></span><span></span><span></span></a>
              </div>
              <!-- Navbar Menu -->
              <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                
                <li class="nav-item d-flex align-items-center">
                  <div class="led-box">
	    		    <div id="led"></div>
	    		    <p id="p_led"></p>
	    		  </div>
	            </li>
	            
                <!-- Logout    -->
                <li class="nav-item"><a href="logout.html" class="nav-link logout">Se déconnecter<i class="fa fa-sign-out"></i></a></li>
              </ul>
            </div>
            <div id="child" style="display: none; color: #fff; background: #2f333e;">
    		  <label id="progress_label">Synchronisation des données...</label>
			  <div class="progress">
  				<div class="progress-bar progress-bar-striped" id="myBar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			  </div>
			</div>
          </div>
        </nav>
      </header>
      <div class="page-content d-flex align-items-stretch"> 
        <!-- Side Navbar -->
        <nav class="side-navbar">
          <!-- Sidebar Header-->
          <div class="sidebar-header d-flex align-items-center">
            <img src="logos/Logo_1lign-eboSURSY_coul.jpg" class="img-fluid">
          </div>
          <!-- Sidebar Navidation Menus--><span class="heading">MENU</span>
          <ul class="list-unstyled">
                    
                    <li id="li_dashboard" name="10"> <a href="main.html"> <i class="a-logo-tableau-de-bord"></i></a></li>
                                                                
                    <li id="li_transvihmiDropdown" name="1"> <a id="a_transvihmiDropdown" name="1" href="#ul_transvihmiDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-ird"></i> </a>
                      <ul id="ul_transvihmiDropdown" name="1" class="collapse list-unstyled">
                        
                        <li id="li_transvihmi_guineeDropdown" name="1" pays="guinee"> <a id="a_transvihmi_guineeDropdown" name="1" href="#ul_transvihmi_guineeDropdown" aria-expanded="false" data-toggle="collapse">Guinée</i> </a>
                       	  <ul id="ul_transvihmi_guineeDropdown" name="1" pays="guinee" class="collapse list-unstyled">
                                              
	                        <li id="li_site_transvihmi_guinee" name="1" style="text-align: right"><a href="liste_sites.html?table=_transvihmi_guinee">Site</a></li>                            
			                                        
	                        <li id="li_bat_transvihmi_guineeDropdown" name="1"><a id="a_bat_transvihmi_guineeDropdown" name="1" href="#ul_bat_transvihmi_guineeDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
	                          <ul id="ul_bat_transvihmi_guineeDropdown" name="1" class="collapse list-unstyled">
			                    			                    
			                    <li id="li_suivi_longitudinal_donnees_missions_transvihmi_guineeDropdown" name="1"><a id="a_suivi_longitudinal_donnees_missions_transvihmi_guineeDropdown" name="1" href="#ul_suivi_longitudinal_donnees_missions_transvihmi_guineeDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données missions</a>
			                      <ul id="ul_suivi_longitudinal_donnees_missions_transvihmi_guineeDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_missions_transvihmi_guinee" name="1"style="text-align: right"><a href="liste_donnees_missions.html?table=_transvihmi_guinee">données missions</a></li>
			                    	<li id="li_importation_suivi_longitudinal_donnees_missions_transvihmi_guinee" name="1"><a href="import_export.html?table=_transvihmi_guinee&type=donnees_mission">importation/exportation</a></li>                            
	                              </ul>
			                    </li>			                    			                    
			                    	 
	                        	<li id="li_suivi_longitudinal_donnees_journalieres_transvihmi_guineeDropdown" name="1"><a id="a_suivi_longitudinal_donnees_journalieres_transvihmi_guineeDropdown" name="1" href="#ul_suivi_longitudinal_donnees_journalieres_transvihmi_guineeDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données journalières</a>
			                      <ul id="ul_suivi_longitudinal_donnees_journalieres_transvihmi_guineeDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_journalieres_transvihmi_guinee" name="1"style="text-align: right"><a href="liste_donnees_journalieres.html?table=_transvihmi_guinee">données journalières</a></li>                            
	                        		<li id="li_importation_suivi_longitudinal_donnees_journalieres_transvihmi_guinee" name="1"><a href="import_export.html?table=_transvihmi_guinee&type=donnees_journalieres">importation/exportation</a></li>                            
	                              </ul>
			                    </li>	 
	                        		                    
			                    <li id="li_bat_transvihmi_guineeCaptureesDropdown" name="1"><a id="a_bat_transvihmi_guineeCaptureesDropdown" name="1" href="#ul_bat_transvihmi_guineeCaptureesDropdown" aria-expanded="false" data-toggle="collapse"><i class="icon-capturee"></i>Capturées</a>
			                      <ul id="ul_bat_transvihmi_guineeCaptureesDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_bat_capturees_transvihmi_guinee" name="1"><a href="liste_chauves_souris_capturees.html?table=_transvihmi_guinee">données</a></li>                            
			                        <li id="li_bat_map_capturees_transvihmi_guinee" name="1"><a href="cartographie.html?table=_transvihmi_guinee&type=chauves_souris_capturees">carte</a></li>
			                        <li id="li_importation_bat_capturees_transvihmi_guinee" name="1"><a href="import_export.html?table=_transvihmi_guinee&type=chauves_souris_capturees">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    <li id="li_bat_transvihmi_guineeNonInvasivesDropdown" name="1"><a id="a_bat_transvihmi_guineeNonInvasivesDropdown" name="1" href="#ul_bat_transvihmi_guineeNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse"></i>Non invasives</a>
			                      <ul id="ul_bat_transvihmi_guineeNonInvasivesDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_bat_non_invasives_transvihmi_guinee" name="1"><a href="liste_chauves_souris_non_invasives.html?table=_transvihmi_guinee">données</a></li>                          
		                            <li id="li_bat_map_non_invasives_transvihmi_guinee" name="1"><a href="cartographie.html?table=_transvihmi_guinee&type=chauves_souris_non_invasives">carte</a></li>
	    	                        <li id="li_importation_bat_non_invasives_transvihmi_guinee" name="1"><a href="import_export.html?table=_transvihmi_guinee&type=chauves_souris_non_invasives">importation/exportation</a></li>
	                              </ul>
			                    </li>
		                      </ul>
	                	    </li>
	                	    <li id="li_viande_de_brousse_transvihmi_guineeDropdown" name="1"><a id="a_viande_de_brousse_transvihmi_guineeDropdown" name="1" href="#ul_viande_de_brousse_transvihmi_guineeDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Picto_ANTILOPE"></i>Viande de brousse</a>
	                      	  <ul id="ul_viande_de_brousse_transvihmi_guineeDropdown" name="1" class="collapse list-unstyled">
	                        	<li id="li_viande_de_brousse_transvihmi_guinee" name="1"><a href="liste_viande_de_brousse.html?table=_transvihmi_guinee">données</a></li>                            
	                        	<li id="li_viande_de_brousse_map_transvihmi_guinee" name="1"><a href="cartographie.html?table=_transvihmi_guinee&type=viande_de_brousse">carte</a></li>
	                        	<li id="li_importation_viande_de_brousse_transvihmi_guinee" name="1"><a href="import_export.html?table=_transvihmi_guinee&type=viande_de_brousse">importation/exportation</a></li>
	                      	  </ul>
	                    	</li>
	                      </ul>
	                    </li>
	                    
	                    <li id="li_transvihmi_camerounDropdown" name="1" pays="cameroun"> <a id="a_transvihmi_camerounDropdown" name="1" href="#ul_transvihmi_camerounDropdown" aria-expanded="false" data-toggle="collapse">Cameroun</a>
                       	  <ul id="ul_transvihmi_camerounDropdown" name="1" pays="cameroun" class="collapse list-unstyled">
                                              
	                        <li id="li_site_transvihmi_cameroun" name="1" style="text-align: right"><a href="liste_sites.html?table=_transvihmi_cameroun">Site</a></li>                            
			                                        
	                        <li id="li_bat_transvihmi_camerounDropdown" name="1"><a id="a_bat_transvihmi_camerounDropdown" name="1" href="#ul_bat_transvihmi_camerounDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
	                          <ul id="ul_bat_transvihmi_camerounDropdown" name="1" class="collapse list-unstyled">
			                    
			                    <li id="li_suivi_longitudinal_donnees_missions_transvihmi_camerounDropdown" name="1"><a id="a_suivi_longitudinal_donnees_missions_transvihmi_camerounDropdown" name="1" href="#ul_suivi_longitudinal_donnees_missions_transvihmi_camerounDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données missions</a>
			                      <ul id="ul_suivi_longitudinal_donnees_missions_transvihmi_camerounDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_missions_transvihmi_cameroun" name="1"style="text-align: right"><a href="liste_donnees_missions.html?table=_transvihmi_cameroun">données missions</a></li>
			                    	<li id="li_importation_suivi_longitudinal_donnees_missions_transvihmi_cameroun" name="1"><a href="import_export.html?table=_transvihmi_cameroun&type=donnees_mission">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    
	                        	<li id="li_suivi_longitudinal_donnees_journalieres_transvihmi_camerounDropdown" name="1"><a id="a_suivi_longitudinal_donnees_journalieres_transvihmi_camerounDropdown" name="1" href="#ul_suivi_longitudinal_donnees_journalieres_transvihmi_camerounDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données journalières</a>
			                      <ul id="ul_suivi_longitudinal_donnees_journalieres_transvihmi_camerounDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_journalieres_transvihmi_cameroun" name="1"style="text-align: right"><a href="liste_donnees_journalieres.html?table=_transvihmi_cameroun">données journalières</a></li>                            
	                        		<li id="li_importation_suivi_longitudinal_donnees_journalieres_transvihmi_cameroun" name="1"><a href="import_export.html?table=_transvihmi_cameroun&type=donnees_journalieres">importation/exportation</a></li>                            
	                              </ul>
			                    </li>	
	                        		                    
			                    <li id="li_bat_transvihmi_camerounCaptureesDropdown" name="1"><a id="a_bat_transvihmi_camerounCaptureesDropdown" name="1" href="#ul_bat_transvihmi_camerounCaptureesDropdown" aria-expanded="false" data-toggle="collapse"><i class="icon-capturee"></i>Capturées</a>
			                      <ul id="ul_bat_transvihmi_camerounCaptureesDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_bat_capturees_transvihmi_cameroun" name="1"><a href="liste_chauves_souris_capturees.html?table=_transvihmi_cameroun">données</a></li>                            
			                        <li id="li_map_bat_capturees_transvihmi_cameroun" name="1"><a href="cartographie.html?table=_transvihmi_cameroun&type=chauves_souris_capturees">carte</a></li>
			                        <li id="li_importation_bat_capturees_transvihmi_cameroun" name="1"><a href="import_export.html?table=_transvihmi_cameroun&type=chauves_souris_capturees">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    <li id="li_bat_transvihmi_camerounNonInvasivesDropdown" name="1"><a id="a_bat_transvihmi_camerounNonInvasivesDropdown" name="1" href="#ul_bat_transvihmi_camerounNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
			                      <ul id="ul_bat_transvihmi_camerounNonInvasivesDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_bat_non_invasives_transvihmi_cameroun" name="1"><a href="liste_chauves_souris_non_invasives.html?table=_transvihmi_cameroun">données</a></li>                          
		                            <li id="li_bat_map_non_invasives_transvihmi_cameroun" name="1"><a href="cartographie.html?table=_transvihmi_cameroun&type=chauves_souris_non_invasives">carte</a></li>
	    	                        <li id="li_importation_bat_non_invasives_transvihmi_cameroun" name="1"><a href="import_export.html?table=_transvihmi_cameroun&type=chauves_souris_non_invasives&type=chauves_souris_non_invasives">importation/exportation</a></li>
	                              </ul>
			                    </li>
		                      </ul>
	                	    </li>
	                	    <li id="li_viande_de_brousse_transvihmi_camerounDropdown" name="1"><a id="a_viande_de_brousse_transvihmi_camerounDropdown" name="1" href="#ul_viande_de_brousse_transvihmi_camerounDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Picto_ANTILOPE"></i>Viande de brousse</a>
	                      	  <ul id="ul_viande_de_brousse_transvihmi_camerounDropdown" name="1" class="collapse list-unstyled">
	                        	<li id="li_viande_de_brousse_transvihmi_cameroun" name="1"><a href="liste_viande_de_brousse.html?table=_transvihmi_cameroun">données</a></li>                            
	                        	<li id="li_viande_de_brousse_map_transvihmi_cameroun" name="1"><a href="cartographie.html?table=_transvihmi_cameroun&type=viande_de_brousse">carte</a></li>
	                        	<li id="li_importation_viande_de_brousse_transvihmi_cameroun" name="1"><a href="import_export.html?table=_transvihmi_cameroun&type=viande_de_brousse">importation/exportation</a></li>
	                      	  </ul>
	                    	</li>
	                      </ul>
	                    </li>
	                    
	                    <li id="li_transvihmi_rdcDropdown" name="1" pays="rdc"> <a id="a_transvihmi_rdcDropdown" name="1" href="#ul_transvihmi_rdcDropdown" aria-expanded="false" data-toggle="collapse">RDC</a>
                       	  <ul id="ul_transvihmi_rdcDropdown" name="1" pays="rdc" class="collapse list-unstyled">
                                              
	                        <li id="li_site_transvihmi_rdc" name="1" style="text-align: right"><a href="liste_sites.html?table=_transvihmi_rdc">Site</a></li>                            
			                                        
	                        <li id="li_bat_transvihmi_rdcDropdown" name="1"><a id="a_bat_transvihmi_rdcDropdown" name="1" href="#ul_bat_transvihmi_rdcDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
	                          <ul id="ul_bat_transvihmi_rdcDropdown" name="1" class="collapse list-unstyled">
			                    
			                    <li id="li_suivi_longitudinal_donnees_missions_transvihmi_rdcDropdown" name="1"><a id="a_suivi_longitudinal_donnees_missions_transvihmi_rdcDropdown" name="1" href="#ul_suivi_longitudinal_donnees_missions_transvihmi_rdcDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données missions</a>
			                      <ul id="ul_suivi_longitudinal_donnees_missions_transvihmi_rdcDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_missions_transvihmi_rdc" name="1"style="text-align: right"><a href="liste_donnees_missions.html?table=_transvihmi_rdc">données missions</a></li>
			                    	<li id="li_importation_suivi_longitudinal_donnees_missions_transvihmi_rdc" name="1"><a href="import_export.html?table=_transvihmi_rdc&type=donnees_mission">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    
			                    <li id="li_suivi_longitudinal_donnees_journalieres_transvihmi_rdcDropdown" name="1"><a id="a_suivi_longitudinal_donnees_journalieres_transvihmi_rdcDropdown" name="1" href="#ul_suivi_longitudinal_donnees_journalieres_transvihmi_rdcDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données journalières</a>
			                      <ul id="ul_suivi_longitudinal_donnees_journalieres_transvihmi_rdcDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_journalieres_transvihmi_rdc" name="1"style="text-align: right"><a href="liste_donnees_journalieres.html?table=_transvihmi_rdc">données journalières</a></li>                            
	                        		<li id="li_importation_suivi_longitudinal_donnees_journalieres_transvihmi_rdc" name="1"><a href="import_export.html?table=_transvihmi_rdc&type=donnees_journalieres">importation/exportation</a></li>                            
	                              </ul>
			                    </li>	 
	                        		                    
			                    <li id="li_bat_transvihmi_rdcCaptureesDropdown" name="1"><a id="a_bat_transvihmi_rdcCaptureesDropdown" name="1" href="#ul_bat_transvihmi_rdcCaptureesDropdown" aria-expanded="false" data-toggle="collapse"><i class="icon-capturee"></i>Capturées</a>
			                      <ul id="ul_bat_transvihmi_rdcCaptureesDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_bat_capturees_transvihmi_rdc" name="1"><a href="liste_chauves_souris_capturees.html?table=_transvihmi_rdc">données</a></li>                            
			                        <li id="li_bat_map_capturees_transvihmi_rdc" name="1"><a href="cartographie.html?table=_transvihmi_rdc&type=chauves_souris_capturees">carte</a></li>
			                        <li id="li_importation_bat_capturees_transvihmi_rdc" name="1"><a href="import_export.html?table=_transvihmi_rdc&type=chauves_souris_capturees">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    <li id="li_bat_transvihmi_rdcNonInvasivesDropdown" name="1"><a id="a_bat_transvihmi_rdcNonInvasivesDropdown" name="1" href="#ul_bat_transvihmi_rdcNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
			                      <ul id="ul_bat_transvihmi_rdcNonInvasivesDropdown" name="1" class="collapse list-unstyled">
			                        <li id="li_bat_non_invasives_transvihmi_rdc" name="1"><a href="liste_chauves_souris_non_invasives.html?table=_transvihmi_rdc">données</a></li>                          
		                            <li id="li_bat_map_non_invasives_transvihmi_rdc" name="1"><a href="cartographie.html?table=_transvihmi_rdc&type=chauves_souris_non_invasives">carte</a></li>
	    	                        <li id="li_importation_bat_non_invasives_transvihmi_rdc" name="1"><a href="import_export.html?table=_transvihmi_rdc&type=chauves_souris_non_invasives">importation/exportation</a></li>
	                              </ul>
			                    </li>
		                      </ul>
	                	    </li>
	                	    <li id="li_viande_de_brousse_transvihmi_rdcDropdown" name="1"><a id="a_viande_de_brousse_transvihmi_rdcDropdown" name="1" href="#ul_viande_de_brousse_transvihmi_rdcDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Picto_ANTILOPE"></i>Viande de brousse</a>
	                      	  <ul id="ul_viande_de_brousse_transvihmi_rdcDropdown" name="1" class="collapse list-unstyled">
	                        	<li id="li_viande_de_brousse_transvihmi_rdc" name="1"><a href="liste_viande_de_brousse.html?table=_transvihmi_rdc">données</a></li>                            
	                        	<li id="li_viande_de_brousse_map_transvihmi_rdc" name="1"><a href="cartographie.html?table=_transvihmi_rdc&type=viande_de_brousse">carte</a></li>
	                        	<li id="li_importation_viande_de_brousse_transvihmi_rdc" name="1"><a href="import_export.html?table=_transvihmi_rdc&type=viande_de_brousse">importation/exportation</a></li>
	                      	  </ul>
	                    	</li>
	                      </ul>
	                    </li>
	                    
	                  </ul>
	                </li>
	                    
                    <li id="li_mivegecDropdown" name="2"> <a id="a_mivegecDropdown" name="2" href="#ul_mivegecDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-mivegec"></i> </a>
                      <ul id="ul_mivegecDropdown" name="2" class="collapse list-unstyled">
                    
                    	<li id="li_mivegec_congoDropdown" name="2" pays="congo"> <a id="a_mivegec_congoDropdown" name="2" href="#ul_mivegec_congoDropdown" aria-expanded="false" data-toggle="collapse">Congo</a>
                      	  <ul id="ul_mivegec_congoDropdown" name="2" pays="congo" class="collapse list-unstyled">
                            <li id="li_animals_mivegec_congo" name="2"><a href="liste_animals.html?table=_mivegec_congo">données</a></li>                            
		                    <li id="li_animals_map_mivegec_congo" name="2"><a href="cartographie.html?table=_mivegec_congo&type=chauves_souris_capturees">carte</a></li>
		                    <li id="li_importation_animals_mivegec_congo" name="2"><a href="import_export.html?table=_mivegec_congo&type=animals">importation/exportation</a></li>                            
                          </ul>
		                </li>    
		                
		                <li id="li_mivegec_gabonDropdown" name="2" pays="gabon"> <a id="a_mivegec_gabonDropdown" name="2" href="#ul_mivegec_gabonDropdown" aria-expanded="false" data-toggle="collapse">Gabon</a>
                      	  <ul id="ul_mivegec_gabonDropdown" name="2" pays="gabon" class="collapse list-unstyled">
                            <li id="li_animals_mivegec_gabon" name="2"><a href="liste_animals.html?table=_mivegec_gabon">données</a></li>                            
		                    <li id="li_animals_map_mivegec_gabon" name="2"><a href="cartographie.html?table=_mivegec_gabon&type=chauves_souris_capturees">carte</a></li>
		                    <li id="li_importation_animals_mivegec_gabon" name="2"><a href="import_export.html?table=_mivegec_gabon&type=animals">importation/exportation</a></li>                            
                          </ul>
		                </li>                   	
                      
                      </ul>
                    </li>
                                        
                    <li id="li_astreDropdown" name="6"> <a id="a_astreDropdown" name="6" href="#ul_astreDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-cirad"></i> </a>
                      <ul id="ul_astreDropdown" name="6" class="collapse list-unstyled">
                        
                        <li id="li_astre_guineeDropdown" name="6" pays="guinee"> <a id="a_astre_guineeDropdown" name="6" href="#ul_astre_guineeDropdown" aria-expanded="false" data-toggle="collapse">Guinée</a>
                          <ul id="ul_astre_guineeDropdown" name="6" pays="guinee" class="collapse list-unstyled">
                                              
	                        <li id="li_site_astre_guinee" name="6" style="text-align: right"><a href="liste_sites.html?table=_astre_guinee">Site</a></li>                            
			                
	                        <li id="li_bat_astre_guineeDropdown" name="6"><a id="a_bat_astre_guineeDropdown" name="6" href="#ul_bat_astre_guineeDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
	                          <ul id="ul_bat_astre_guineeDropdown" name="6" class="collapse list-unstyled">
			                    
			                    <li id="li_suivi_longitudinal_donnees_missions_astre_guineeDropdown" name="6"><a id="a_suivi_longitudinal_donnees_missions_astre_guineeDropdown" name="1" href="#ul_suivi_longitudinal_donnees_missions_astre_guineeDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données missions</a>
			                      <ul id="ul_suivi_longitudinal_donnees_missions_astre_guineeDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_missions_astre_guinee" name="6"style="text-align: right"><a href="liste_donnees_missions.html?table=_astre_guinee">données missions</a></li>
			                    	<li id="li_importation_suivi_longitudinal_donnees_missions_astre_guinee" name="6"><a href="import_export.html?table=_astre_guinee&type=donnees_mission">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    
			                    <li id="li_suivi_longitudinal_donnees_journalieres_astre_guineeDropdown" name="6"><a id="a_suivi_longitudinal_donnees_journalieres_astre_guineeDropdown" name="1" href="#ul_suivi_longitudinal_donnees_journalieres_astre_guineeDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données journalières</a>
			                      <ul id="ul_suivi_longitudinal_donnees_journalieres_astre_guineeDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_journalieres_astre_guinee" name="6"style="text-align: right"><a href="liste_donnees_journalieres.html?table=_astre_guinee">données journalières</a></li>                            
	                        		<li id="li_importation_suivi_longitudinal_donnees_journalieres_astre_guinee" name="6"><a href="import_export.html?table=_astre_guinee&type=donnees_journalieres">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
	                        		                    
			                    <li id="li_bat_astre_guineeCaptureesDropdown" name="6"><a id="a_bat_astre_guineeCaptureesDropdown" name="6" href="#ul_bat_astre_guineeCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
			                      <ul id="ul_bat_astre_guineeCaptureesDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_bat_capturees_astre_guinee" name="6"><a href="liste_chauves_souris_capturees.html?table=_astre_guinee">données</a></li>                            
			                        <li id="li_bat_map_capturees_astre_guinee" name="6"><a href="cartographie.html?table=_astre_guinee&type=chauves_souris_capturees">carte</a></li>
			                        <li id="li_importation_bat_capturees_astre_guinee" name="6"><a href="import_export.html?table=_astre_guinee&type=chauves_souris_capturees">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    <li id="li_bat_astre_guineeNonInvasivesDropdown" name="6"><a id="a_bat_astre_guineeNonInvasivesDropdown" name="6" href="#ul_bat_astre_guineeNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
			                      <ul id="ul_bat_astre_guineeNonInvasivesDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_bat_non_invasives_astre_guinee" name="6"><a href="liste_chauves_souris_non_invasives.html?table=_astre_guinee">données</a></li> 
		                            <li id="li_bat_map_non_invasives_astre_guinee" name="6"><a href="cartographie.html?table=_astre_guinee&type=chauves_souris_non_invasives">carte</a></li>
	    	                        <li id="li_importation_bat_non_invasives_astre_guinee" name="6"><a href="import_export.html?table=_astre_guinee&type=chauves_souris_non_invasives">importation/exportation</a></li>
	                              </ul>
	                            </li>
	                          </ul>
	                        </li>                          
                          </ul>
                   	    </li>
                   	    
                   	    <li id="li_astre_congoDropdown" name="6" pays="congo"> <a id="a_astre_congoDropdown" name="6" href="#ul_astre_congoDropdown" aria-expanded="false" data-toggle="collapse">République du Congo</a>
                          <ul id="ul_astre_congoDropdown" name="6" pays="congo" class="collapse list-unstyled">
                                              
	                        <li id="li_site_astre_congo" name="6" style="text-align: right"><a href="liste_sites.html?table=_astre_congo">Site</a></li>                            
			                
	                        <li id="li_bat_astre_congoDropdown" name="6"><a id="a_bat_astre_congoDropdown" name="6" href="#ul_bat_astre_congoDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
	                          <ul id="ul_bat_astre_congoDropdown" name="6" class="collapse list-unstyled">
			                    
			                    <li id="li_suivi_longitudinal_donnees_missions_astre_congoDropdown" name="6"><a id="a_suivi_longitudinal_donnees_missions_astre_congoDropdown" name="1" href="#ul_suivi_longitudinal_donnees_missions_astre_congoDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données missions</a>
			                      <ul id="ul_suivi_longitudinal_donnees_missions_astre_congoDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_missions_astre_congo" name="6"style="text-align: right"><a href="liste_donnees_missions.html?table=_astre_congo">données missions</a></li>
			                    	<li id="li_importation_suivi_longitudinal_donnees_missions_astre_congo" name="6"><a href="import_export.html?table=_astre_congo&type=donnees_mission">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    
			                    <li id="li_suivi_longitudinal_donnees_journalieres_astre_congoDropdown" name="6"><a id="a_suivi_longitudinal_donnees_journalieres_astre_congoDropdown" name="1" href="#ul_suivi_longitudinal_donnees_journalieres_astre_congoDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données journalières</a>
			                      <ul id="ul_suivi_longitudinal_donnees_journalieres_astre_congoDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_journalieres_astre_congo" name="6"style="text-align: right"><a href="liste_donnees_journalieres.html?table=_astre_congo">données journalières</a></li>                            
	                        		<li id="li_importation_suivi_longitudinal_donnees_journalieres_astre_congo" name="6"><a href="import_export.html?table=_astre_congo&type=donnees_journalieres">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    	                    
			                    <li id="li_bat_astre_congoCaptureesDropdown" name="6"><a id="a_bat_astre_congoCaptureesDropdown" name="6" href="#ul_bat_astre_congoCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
			                      <ul id="ul_bat_astre_congoCaptureesDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_bat_capturees_astre_congo" name="6"><a href="liste_chauves_souris_capturees.html?table=_astre_congo">données</a></li>                            
			                        <li id="li_bat_map_capturees_astre_congo" name="6"><a href="cartographie.html?table=_astre_congo&type=chauves_souris_capturees">carte</a></li>
			                        <li id="li_importation_bat_capturees_astre_congo" name="6"><a href="import_export.html?table=_astre_congo&type=chauves_souris_capturees">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    <li id="li_bat_astre_congoNonInvasivesDropdown" name="6"><a id="a_bat_astre_congoNonInvasivesDropdown" name="6" href="#ul_bat_astre_congoNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
			                      <ul id="ul_bat_astre_congoNonInvasivesDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_bat_non_invasives_astre_congo" name="6"><a href="liste_chauves_souris_non_invasives.html?table=_astre_congo">données</a></li> 
		                            <li id="li_bat_map_non_invasives_astre_congo" name="6"><a href="cartographie.html?table=_astre_congo&type=chauves_souris_non_invasives">carte</a></li>
	    	                        <li id="li_importation_bat_non_invasives_astre_congo" name="6"><a href="import_export.html?table=_astre_congo&type=chauves_souris_non_invasives">importation/exportation</a></li>
	                              </ul>
	                            </li>
	                          </ul>
	                        </li>                          
                          </ul>
                   	    </li>
                   	    
                   	    <li id="li_astre_gabonDropdown" name="6" pays="gabon"> <a id="a_astre_gabonDropdown" name="6" href="#ul_astre_gabonDropdown" aria-expanded="false" data-toggle="collapse">Gabon</a>
                          <ul id="ul_astre_gabonDropdown" name="6" pays="gabon" class="collapse list-unstyled">
                                              
	                        <li id="li_site_astre_gabon" name="6" style="text-align: right"><a href="liste_sites.html?table=_astre_gabon">Site</a></li>                            
			                
	                        <li id="li_bat_astre_gabonDropdown" name="6"><a id="a_bat_astre_gabonDropdown" name="6" href="#ul_bat_astre_gabonDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
	                          <ul id="ul_bat_astre_gabonDropdown" name="6" class="collapse list-unstyled">
			                    
			                    <li id="li_suivi_longitudinal_donnees_missions_astre_gabonDropdown" name="6"><a id="a_suivi_longitudinal_donnees_missions_astre_gabonDropdown" name="1" href="#ul_suivi_longitudinal_donnees_missions_astre_gabonDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données missions</a>
			                      <ul id="ul_suivi_longitudinal_donnees_missions_astre_gabonDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_missions_astre_gabon" name="6"style="text-align: right"><a href="liste_donnees_missions.html?table=_astre_gabon">données missions</a></li>
			                    	<li id="li_importation_suivi_longitudinal_donnees_missions_astre_gabon" name="6"><a href="import_export.html?table=_astre_gabon&type=donnees_mission">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    
			                    <li id="li_suivi_longitudinal_donnees_journalieres_astre_gabonDropdown" name="6"><a id="a_suivi_longitudinal_donnees_journalieres_astre_gabonDropdown" name="1" href="#ul_suivi_longitudinal_donnees_journalieres_astre_gabonDropdown" aria-expanded="false" data-toggle="collapse">Suivi longitudinal - données journalières</a>
			                      <ul id="ul_suivi_longitudinal_donnees_journalieres_astre_gabonDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_suivi_longitudinal_donnees_journalieres_astre_gabon" name="6"style="text-align: right"><a href="liste_donnees_journalieres.html?table=_astre_gabon">données journalières</a></li>                            
	                        		<li id="li_importation_suivi_longitudinal_donnees_journalieres_astre_gabon" name="6"><a href="import_export.html?table=_astre_gabon&type=donnees_journalieres">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
	                        		                    
			                    <li id="li_bat_astre_gabonCaptureesDropdown" name="6"><a id="a_bat_astre_gabonCaptureesDropdown" name="6" href="#ul_bat_astre_gabonCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
			                      <ul id="ul_bat_astre_gabonCaptureesDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_bat_capturees_astre_gabon" name="6"><a href="liste_chauves_souris_capturees.html?table=_astre_gabon">données</a></li>                            
			                        <li id="li_bat_map_capturees_astre_gabon" name="6"><a href="cartographie.html?table=_astre_gabon&type=chauves_souris_capturees">carte</a></li>
			                        <li id="li_importation_bat_capturees_astre_gabon" name="6"><a href="import_export.html?table=_astre_gabon&type=chauves_souris_capturees">importation/exportation</a></li>                            
	                              </ul>
			                    </li>
			                    <li id="li_bat_astre_gabonNonInvasivesDropdown" name="6"><a id="a_bat_astre_gabonNonInvasivesDropdown" name="6" href="#ul_bat_astre_gabonNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
			                      <ul id="ul_bat_astre_gabonNonInvasivesDropdown" name="6" class="collapse list-unstyled">
			                        <li id="li_bat_non_invasives_astre_gabon" name="6"><a href="liste_chauves_souris_non_invasives.html?table=_astre_gabon">données</a></li> 
		                            <li id="li_bat_map_non_invasives_astre_gabon" name="6"><a href="cartographie.html?table=_astre_gabon&type=chauves_souris_non_invasives">carte</a></li>
	    	                        <li id="li_importation_bat_non_invasives_astre_gabon" name="6"><a href="import_export.html?table=_astre_gabon&type=chauves_souris_non_invasives">importation/exportation</a></li>
	                              </ul>
	                            </li>
	                          </ul>
	                        </li>                          
                          </ul>
                   	    </li>
                   	    
                      </ul>
                    </li>                   

					<li id="li_CIBUDropdown" name="3"> <a id="a_CIBUDropdown" name="3" href="#ul_CIBUDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-institut-pasteur"></i> </a>
                      <ul id="ul_CIBUDropdown" name ="3" class="collapse list-unstyled">
                        <li id="li_individuCIBUDropdown" name="3"><a id="a_individuCIBUDropdown" name="3" href="#ul_individuCIBUDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-rodent"></i>Individus</a>
                          <ul id="ul_individuCIBUDropdown" name="3" class="collapse list-unstyled">
                            <li id="li_individu_CIBU" name="3"><a href="liste_individus_cibu.html?table=individus_cibu">données</a></li>                            
	                        <li id="li_individu_map_cibu" name ="3"><a href="#">carte</a></li>
	                        <li id="li_importation_individu_cibu" name="3"><a href="#">importation/exportation</a></li>                            
                          </ul>
		                </li>
		                <li id="li_prelevementCIBUDropdown" name="3"><a id="a_prelevementCIBUDropdown" name="3" href="#ul_prelevementCIBUDropdown" aria-expanded="false" data-toggle="collapse">Prélèvement</a>
		                  <ul id="ul_prelevementCIBUDropdown" name ="3" class="collapse list-unstyled">
		                    <li id="li_prelevement_CIBU" name="3"><a href="liste_prelevements_cibu.html?table=prelevements_cibu">données</a></li>                            
		                    <li id="li_importation_prelevement_cibu" name="3"><a href="#">importation/exportation</a></li>                            
                          </ul>
		                </li>
	                  </ul>
                    </li>

                    <li id="li_EpvoDropdown" name="4"> <a id="a_EpvoDropdown" href="#ul_EpvoDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-epvo"></i> </a>
                      <ul id="ul_EpvoDropdown" class="collapse list-unstyled">
                        <li id="li_batEpvoDropdown" name="4"><a id="a_batEpvoDropdown" href="#ul_batEpvoDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_batEpvoDropdown" class="collapse list-unstyled">
		                    <li id="li_batEpvoCaptureesDropdown" name="4"><a id="a_batEpvoCaptureesDropdown" href="#ul_batEpvoCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
		                      <ul id="ul_batEpvoCaptureesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_epvo" name="4"><a href="#">données</a></li>                            
		                        <li id="li_bat_map_capturees_epvo" name="4"><a href="#">carte</a></li>
		                        <li id="li_importation_bat_epvo" name="4"><a href="#">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_batEpvoNonInvasivesDropdown" name="4"><a id="a_batEpvoNonInvasivesDropdown" href="#ul_batEpvoNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
		                      <ul id="ul_batEpvoNonInvasivesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_non_invasives_epvo" name="4"><a href="#">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_epvo" name="4"><a href="#">carte</a></li>
    	                        <li id="li_importation_bat_epvo" name="4"><a href="#">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	  </ul>
                    </li>
                    
                    <li id="li_IPGDropdown" name="5"> <a id="a_IPGDropdown" href="#ul_IPGDropdown" aria-expanded="false" data-toggle="collapse"> <i class="a-logo-IPG"></i> </a>
                      <ul id="ul_IPGDropdown" class="collapse list-unstyled">
                        <li id="li_batIPGDropdown" name="5"><a id="a_batIPGDropdown" href="#ul_batIPGDropdown" aria-expanded="false" data-toggle="collapse" style="text-decoration:underline"> <i class="icon-Chauve-souris_Black2"></i>Chauve-souris</a>
                          <ul id="ul_batIPGDropdown" class="collapse list-unstyled">
		                    <li id="li_batIPGCaptureesDropdown" name="5"><a id="a_batIPGCaptureesDropdown" href="#ul_batIPGCaptureesDropdown" aria-expanded="false" data-toggle="collapse">Capturées</a>
		                      <ul id="ul_batIPGCaptureesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_capturees_ipg" name="5"><a href="#">données</a></li>                            
		                        <li id="li_bat_map_capturees_ipg" name="5"><a href="#">carte</a></li>
		                        <li id="li_importation_bat_ipg" name="5"><a href="#">importation/exportation</a></li>                            
                              </ul>
		                    </li>
		                    <li id="li_batIPGNonInvasivesDropdown" name="5"><a id="a_batIPGNonInvasivesDropdown" href="#ul_batIPGNonInvasivesDropdown" aria-expanded="false" data-toggle="collapse">Non invasives</a>
		                      <ul id="ul_batIPGNonInvasivesDropdown" class="collapse list-unstyled">
		                        <li id="li_bat_non_invasives_ipg" name="5"><a href="#">données</a></li>                          
	                            <li id="li_bat_map_non_invasives_ipg" name="5"><a href="#">carte</a></li>
    	                        <li id="li_importation_bat_ipg" name="5"><a href="#">importation/exportation</a></li>
                              </ul>
		                    </li>
	                      </ul>
                	    </li>
                	  </ul>
                    </li>
                    
                    <li id="li_help"> 
                    	<a href="aide.html"><i class='a-aide'></i></a>
                    </li>
                                    
          </ul>
        </nav>
        <div class="content-inner">
          <!-- Page Header-->
          <header class="page-header">
            <div class="container-fluid">
              <h2 class="no-margin-bottom">Base de données EBO-SURSY</h2>
            </div>
          </header>
          
          <section>          
            <div class="container-fluid">              
  			  <div class="card">
                <div class="card-header" id="table">
                  <!-- <h4>Liste des champs des chauves-souris capturées</h4> -->
                  <script type="text/javascript">
			      	var line = document.createElement("div");
			      	var table;
	               	if (type_table == 'chauves_souris_capturees') {
	               		table = 'chauves-souris capturées'
	     			} else if (type_table == 'chauves_souris_non_invasives') {
	     				table = 'chauves-souris non invasives'
	     			} else if (type_table == 'viande_de_brousse') {
	     				table = 'viandes de brousses'
	     			} else if (type_table == 'donnees_journalieres') {
	     				table = 'données journalières'
	     			} else if (type_table == 'donnees_mission') {
	     				table = 'données missions'
	     			} else if (type_table == 'animals') {
	     				table = 'animaux'
	     			}
			       	line.innerHTML = 
			        	'<h4>Liste des champs des ' +
			        	table +
			            '</h4>';			               		
				   	document.getElementById("table").appendChild(line);
				  </script>
                </div>
              <div class="card-body">
  			    <form>
                  <div class="form-group">
                    <label class="form-control-label">Sélectionner les champs à exporter</label>
                    <select id="multiselect1" multiple="multiple" name="multiselect1[]">
                     
                    </select>
                  </div>
                </form>
              </div>
              
              <div class="card-body text-left">
                <div class="row">
                  <!-- <div class="col-lg-4">
                      <a id="add_selection_criteria" href="selection_criteres_chauves_souris_capturees_astre.html" class="btn btn-primary btn-fill">Critères de selection</a></h4>
			  	  </div> -->
			  	  
			  	  <div class="col-lg-4">
			  	    <div class="form-group">
	                  <button id="add_selection_criteria" name="add_selection_criteria" type="submit" class="btn btn-primary btn-fill ladda-button" >                        	
			            <span class="ladda-label">Critères de sélection</span>
			            <span class="ladda-spinner"></span>
				  	  </button>  
				  	</div> 
                  </div>
                  
			  	  <div class="col-lg-4">
			  	    <div class="form-group">
	                  <button id="export_selected_fields" name="export_selected_fields" type="submit" class="btn btn-primary btn-fill ladda-button" >                        	
			            <span class="ladda-label">Exporter la sélection</span>
			            <span class="ladda-spinner"></span>
				  	  </button>  
				  	</div> 
                  </div>
			  	  
			  	  <div class="col-lg-4">
			  	    <div class="form-group">
	                  <button id="export_all_fields" name="export_all_fields" type="submit" class="btn btn-primary btn-fill ladda-button" >                        	
			            <span class="ladda-label">Exporter tous les champs</span>
			            <span class="ladda-spinner"></span>
				  	  </button>  
				  	</div> 
				  </div>
                </div>
              </div>
              
            </div>
          </section>          
          
          <!-- Page Footer-->
          <footer class="main-footer">
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-4">
                  <p>Projet EBO-SURSY  2017-2021</p>
                </div>
                <div class="col-sm-4">
                  <p>Conçu par Bruno Rosset - Cirad</p>
                </div>
                <div class="col-sm-4 text-right"> 
                  <p><a href="javascript:ouvre_popup('CGU.html')"><U>CGU</U></a></p>
                </div>
              </div>
            </div>
            <script type="text/javascript">
				function ouvre_popup(page) {
				 window.open(page,"nom_popup","menubar=no, status=no, scrollbars=no, menubar=no, width=640, height=480");
				}
			</script>
          </footer>
        </div>
      </div>
    </div>
    
    <script type="text/javascript">
	    
    	var debug;
		if (localStorage.getItem('debug') === null) {
			debug = '';
		} else {
			debug = localStorage.getItem('debug');
		};
		
		if (localStorage.getItem('web') === 'oui') {
			var remote_couchdb = localStorage.getItem('remote_couchdb');
			var DB = new PouchDB(remote_couchdb + type_table + nom_table + debug);
		} else {
			var DB = new PouchDB(type_table + nom_table + debug);
		};
    	
        var count, rowcount, rowcount1;;
        
        var CSV='';
        
        var array_selected_fields = [];
           	
        if (type_table == 'chauves_souris_capturees') {
    		var fields = 
    			['N_identification_CS', 'N_identification_mere', 'Numero_mission', 'N_site', 'Date',
    			 'Equipe', 'Pays', 'Region_capture', 'Site_capture', 'Lieu_capture',
    		     'Environnement', 'Latitude', 'Lat_degre_dec', 'Longitude', 'Long_degre_dec',
    		     'Proximite_village_km', 'Methode_capture', 'NumFilet',	'LongueurFilet',
    		     'HauteurFilet', 'Lat_degre_decFilet', 'LatitudeFilet', 'Long_degre_decFilet',
    		     'LongitudeFilet',	'Lat_degre_dec_Lieu_capture', 'Latitude_Lieu_capture',
    		     'Long_degre_dec_Lieu_capture', 'Longitude_Lieu_capture', /*'Arret_Capture',
    		     'Causes_Arret_Capture',*/ 'Type_chauve_souris',
    		     'Espece_identifiee', 'Famille_terrain', 'Genre_terrain', 'Espece_terrain',
    		     'Famille_labo', 'Genre_labo', 'Espece_labo', 'Famille_consensus', 'Genre_consensus', 
    		     'Espece_consensus', 'Sexe', 'Age', 'Gestante', 'Lactation', 'Suitee', 'Sexe_enfant',
    		     'Poids_enfant', 'Identifiant_enfant', 'Vivante', 'Cause_deces', 'Poids_gr',
    		     'L_avant_bras_mm', 'L_totale_corps_mm', 'Taille_yeux', 'L_queue_mm',
    		     'L_metacarpe_3ieme_doigt_mm', 'Couleur_pelage_dorsal',
    		     'Couleur_pelage_ventral', 'Remarques_anomalies', 'Sang_DBS_nb_cercles', 
    		     'Sang_tube_EDTA', 'Feces_RNAl', 'Urine', 'Urine_DUS_nombre_cercles',
    		     'Feces_urine_RNAl', 'Ecouvillon_gorge_RNAl', 'Ecouvillon_rectal_RNAl',
    		     'Ectoparasites_ethanol', 'Poils_ethanol', 'Wing_punch_ethanol',
    		     'Feces_culture_glycerol', 'Feces_ethanol', 'Sperme', 'Lait', 'Autres_echantillons_remarques',
    		     'Specimen_entier', 'Specimen_preserve_dans', 'Prelevement_organe',
    		     'Foie_formol', 'Foie_RNAl', 'Rate_formol', 'Rate_RNAl', 'Reins_formol',
    		     'Reins_RNAl', 'Intestins_formol', 'Intestins_RNAl', 'Poumons_formol',
    		     'Poumons_RNAl', 'Coeur_formol', 'Coeur_RNAl', 'Ggl_lymph_formol',
    		     'Ggl_lymph_RNAl', 'Testicules_formol', 'Testicules_RNAl', 'Peau_formol',
    		     'Peau_RNAl', 'Muscles_formol', 'Muscles_RNAl', 'Cerveau_formol',
    		     'Cerveau_RNAl', 'Autre', 'Autre_formol', 'Autre_RNAl', 'Remarques_echantillons', 'Username',
    		     'Filet_temps', 'Arret_Capture'];
    		
    		var fields_CSV_head = 'N_identification_CS;N_identification_mere;Numero_mission;N_site;Date;' +
						 'Equipe;Pays;Region_capture;Site_capture;Lieu_capture;' +
					     'Environnement;Latitude;Lat_degre_dec;Longitude;Long_degre_dec;' +
					     'Proximite_village_km;Methode_capture;NumFilet;LongueurFilet;' +
    		     		 'HauteurFilet;Lat_degre_decFilet;LatitudeFilet;Long_degre_decFilet;' +
    		     		 'LongitudeFilet;Lat_degre_dec_Lieu_capture;Latitude_Lieu_capture;' +
    		     		 'Long_degre_dec_Lieu_capture;Longitude_Lieu_capture;' /*Arret_Capture;'*/ +
    		     		 /*'Causes_Arret_Capture;'*/'Type_chauve_souris;' +
					     'Espece_identifiee;Famille_terrain;Genre_terrain;Espece_terrain;' +
					     'Famille_labo;Genre_labo;Espece_labo;Famille_consensus;Genre_consensus;' + 
					     'Espece_consensus;Sexe;Age;Gestante;Lactation;Suitee;Sexe_enfant;' +
					     'Poids_enfant;Identifiant_enfant;Vivante;Cause_deces;Poids_gr;' +
					     'L_avant_bras_mm;L_totale_corps_mm;Taille_yeux;L_queue_mm;' +
					     'L_metacarpe_3ieme_doigt_mm;Couleur_pelage_dorsal;' +
					     'Couleur_pelage_ventral;Remarques_anomalies;Sang_DBS_nb_cercles;' + 
					     'Sang_tube_EDTA;Feces_RNAl;Urine;Urine_DUS_nombre_cercles;' +
					     'Feces_urine_RNAl;Ecouvillon_gorge_RNAl;Ecouvillon_rectal_RNAl;' +
					     'Ectoparasites_ethanol;Poils_ethanol;Wing_punch_ethanol;' +
					     'Feces_culture_glycerol;Feces_ethanol;Sperme;Lait;Autres_echantillons_remarques;' +
					     'Specimen_entier;Specimen_preserve_dans;Prelevement_organe;' +
					     'Foie_formol;Foie_RNAl;Rate_formol;Rate_RNAl;Reins_formol;' +
					     'Reins_RNAl;Intestins_formol;Intestins_RNAl;Poumons_formol;' +
					     'Poumons_RNAl;Coeur_formol;Coeur_RNAl;Ggl_lymph_formol;' +
					     'Ggl_lymph_RNAl;Testicules_formol;Testicules_RNAl;Peau_formol;' +
					     'Peau_RNAl;Muscles_formol;Muscles_RNAl;Cerveau_formol;' +
					     'Cerveau_RNAl;Autre;Autre_formol;Autre_RNAl;Remarques_echantillons;Username;' +
					     'Filet_temps;Arret_Capture;\r\n';	
    		
    	} else if (type_table == 'chauves_souris_non_invasives') {
    		var fields = 
    			['Date', 'Heure_debut', 'Heure_fin', 'N_site', 'Equipe', 'Pays', 'Region_collecte', 'Site_collecte', 'Environnement', 
    			 'Lieu_collecte', 'Lat_degre_dec', 'Latitude', 'Long_degre_dec', 'Longitude', 'Type_site', 'Proximite_village_km',
    			 'Type_chauves_souris', 'Famille_1', 'Genre_1', 'Espece_1', 'Famille_2', 'Genre_2', 'Espece_2', 'Famille_3', 
    			 'Genre_3', 'Espece_3', 'Remarques', 'N_identification_echantillon', 'Type_echantillon', 'Nbre_feces_par_tube',
    			 'Urine_methode', 'Urine_papier_buvard_nbre_cercles', 'Username'];
    		
    		var fields_CSV_head = 'Date;Heure_debut;Heure_fin;N_site;Equipe;Pays;Region_collecte;Site_collecte;Environnement;' + 
        			 	'Lieu_collecte;Lat_degre_dec;Latitude;Long_degre_dec;Longitude;Type_site;Proximite_village_km;' +
        			 	'Type_chauves_souris;Famille_1;Genre_1;Espece_1;Famille_2;Genre_2;Espece_2;Famille_3;' +
        			 	'Genre_3;Espece_3;Remarques;N_identification_echantillon;Type_echantillon;Nbre_feces_par_tube;' +
        			 	'Urine_methode;Urine_papier_buvard_nbre_cercles;Username;\r\n';	
    	} else if (type_table == 'viande_de_brousse') {
    		var fields = 
    			['N_identification_echantillon', 'N_site', 'Date', 'Pays', 'Enqueteur', 'Region_collecte', 'Site_collecte', 'Environnement', 
				 'Lieu_collecte', 'Lat_degre_dec', 'Latitude', 'Long_degre_dec', 'Longitude', 'Proximite_village_km', 'Preleve_chez', 'Tue_par_chasseur', 
				 'Methode_chasse', 'Nbre_pieges', 'Distance_village', 'Duree_de_chasse', 'Destination', 'Lieu_vente', 'Prix_vente', 
				 'Type_animal', 'Espece_nom_local', 'Famille', 'Genre', 'Espece', 'Sexe', 'Age', 'Mort_depuis', 'Etat_carcasse_animal', 
				 'Decoupage_carcasse', 'L_total_corps', 'Poids', 'Observations_carcasse', 'Collecte_sang_DBS', 'Qualite_echantillon', 
				 'Endroit_prelevement', 'Remarques_echantillon', 'Username'];
    		
    		var fields_CSV_head = 'N_identification_echantillon;N_site;Date;Pays;Enqueteur;Region_collecte;Site_collecte;Environnement;' +
    							  'Lieu_collecte;Lat_degre_dec;Latitude;Long_degre_dec;Longitude;Proximite_village_km;Preleve_chez;Tue_par_chasseur;' +
    							  'Methode_chasse;Nbre_pieges;Distance_village;Duree_de_chasse;Destination;Lieu_vente;Prix_vente;' +
    							  'Type_animal;Espece_nom_local;Famille;Genre;Espece;Sexe;Age;Mort_depuis;Etat_carcasse_animal;' +
    							  'Decoupage_carcasse;L_total_corps;Poids;Observations_carcasse;Collecte_sang_DBS;Qualite_echantillon;' +
    							  'Endroit_prelevement;Remarques_echantillon;Username;\r\n';	
    	} else if (type_table == 'donnees_journalieres') {
    		var fields = 
    			['Date', 'Equipe', 'ID_CS_preleve_debut', 'ID_CS_preleve_fin', 'N_site',
    			 'Pays', 'Region_capture', 'Site_capture', 'Environnement',	'Proximite_village_km',
    			 'Lat_degre_dec', 'Latitude', 'Long_degre_dec', 'Longitude', 'Roost_diurne', 'Presence_diurne', 
    			 'Famille_diurne1', 'Genre_diurne1', 'Espece_diurne1',
    			 'Famille_diurne2', 'Genre_diurne2', 'Espece_diurne2',
    			 'Famille_diurne3', 'Genre_diurne3', 'Espece_diurne3',
    			 'Famille_diurne4', 'Genre_diurne4', 'Espece_diurne4',
    			 'Famille_diurne5', 'Genre_diurne5', 'Espece_diurne5',
    			 'Famille_diurne6', 'Genre_diurne6', 'Espece_diurne6',
    			 'Famille_diurne7', 'Genre_diurne7', 'Espece_diurne7',
    			 'Methode_comptage_diurne', 'Resultat_comptage_diurne_1', 'Resultat_comptage_diurne_2',
    			 'Utilisation_site_nocturne', 'Aliment_consomme', 'Presence_nocturne',
    			 'Famille_nocturne1', 'Genre_nocturne1',	'Espece_nocturne1',
    			 'Famille_nocturne2', 'Genre_nocturne2',	'Espece_nocturne2',
    			 'Famille_nocturne3', 'Genre_nocturne3',	'Espece_nocturne3',
    			 'Famille_nocturne4', 'Genre_nocturne4',	'Espece_nocturne4',
    			 'Famille_nocturne5', 'Genre_nocturne5',	'Espece_nocturne5',
    			 'Famille_nocturne6', 'Genre_nocturne6',	'Espece_nocturne6',
    			 'Famille_nocturne7', 'Genre_nocturne7',	'Espece_nocturne7',
    			 'Methode_comptage_nocturne', 'Resultat_comptage_nocturne_1', 'Resultat_comptage_nocturne_2',
    			 'Vocalisations', 'Parade_sexuelle',
    			 'Famille_vocalisations', 'Genre_vocalisations', 'Espece_vocalisations',
    			 'Copulations', 
    			 'Famille_copulations', 'Genre_copulations', 'Espece_copulations',
    			 'Suitee', 
    			 'Famille_suitee', 'Genre_suitee', 'Espece_suitee', 
    			 'Agressions',
    			 'Famille_agressions', 'Genre_agressions', 'Espece_agressions',
    			 'Filet_canopee_nb_7', 'Filet_canopee_m2_7',
    			 'NumFilet7_1', 'LongueurFilet7_1', 'HauteurFilet7_1',
    			 'NumFilet7_2', 'LongueurFilet7_2', 'HauteurFilet7_2',
    			 'NumFilet7_3', 'LongueurFilet7_3', 'HauteurFilet7_3',
    			 'NumFilet7_4', 'LongueurFilet7_4', 'HauteurFilet7_4',
    			 'NumFilet7_5', 'LongueurFilet7_5', 'HauteurFilet7_5',
    			 'NumFilet7_6', 'LongueurFilet7_6', 'HauteurFilet7_6',
    			 'NumFilet7_7', 'LongueurFilet7_7', 'HauteurFilet7_7',
    			 'Filet_canopee_nb_20', 'Filet_canopee_m2_20',
    			 'NumFilet20_1', 'LongueurFilet20_1', 'HauteurFilet20_1',
    			 'NumFilet20_2', 'LongueurFilet20_2', 'HauteurFilet20_2',
    			 'NumFilet20_3', 'LongueurFilet20_3', 'HauteurFilet20_3',
    			 'NumFilet20_4', 'LongueurFilet20_4', 'HauteurFilet20_4',
    			 'NumFilet20_5', 'LongueurFilet20_5', 'HauteurFilet20_5',
    			 'NumFilet20_6', 'LongueurFilet20_6', 'HauteurFilet20_6',
    			 'NumFilet20_7', 'LongueurFilet20_7', 'HauteurFilet20_7',
    			 'Filet_sol_nb', 'Filet_sol_m2',
    			 'NumFiletSol_1', 'LongueurFiletSol_1', 'HauteurFiletSol_1',
    			 'NumFiletSol_2', 'LongueurFiletSol_2', 'HauteurFiletSol_2',
    			 'NumFiletSol_3', 'LongueurFiletSol_3', 'HauteurFiletSol_3',
    			 'NumFiletSol_4', 'LongueurFiletSol_4', 'HauteurFiletSol_4',
    			 'NumFiletSol_5', 'LongueurFiletSol_5', 'HauteurFiletSol_5',
    			 'NumFiletSol_6', 'LongueurFiletSol_6', 'HauteurFiletSol_6',
    			 'NumFiletSol_7', 'LongueurFiletSol_7', 'HauteurFiletSol_7',
    			 'Filet_debut', 'Filet_fin', 'Filet_temps', 'Filet_capture_nb', 'Harp_debut',
    			 'Harp_fin', 'Harp_temps', 'Harpe_nb', 'Saison', 'Climat', 'Autre_climat',
    			 'Precipitation', 'Vent', 'Lune', 'Temperature_logger', 'Humidite_logger', 
    			 'Username'];
    		
    		var fields_CSV_head = 'Date;Equipe;ID_CS_preleve_debut;ID_CS_preleve_fin;N_site;' +
					    		  'Pays;Region_capture;Site_capture;Environnement;Proximite_village_km;' +
					    		  'Lat_degre_dec;Latitude;Long_degre_dec;Longitude;Roost_diurne;Presence_diurne;' + 
					    		  'Famille_diurne1;Genre_diurne1;Espece_diurne1;' +
					    		  'Famille_diurne2;Genre_diurne2;Espece_diurne2;' +
					    		  'Famille_diurne3;Genre_diurne3;Espece_diurne3;' +
					    		  'Famille_diurne4;Genre_diurne4;Espece_diurne4;' +
					    		  'Famille_diurne5;Genre_diurne5;Espece_diurne5;' +
					    		  'Famille_diurne6;Genre_diurne6;Espece_diurne6;' +
					    		  'Famille_diurne7;Genre_diurne7;Espece_diurne7;' +
					    		  'Methode_comptage_diurne;Resultat_comptage_diurne_1;Resultat_comptage_diurne_2;' +
					    		  'Utilisation_site_nocturne;Aliment_consomme;Presence_nocturne;' +
					    		  'Famille_nocturne1;Genre_nocturne1;Espece_nocturne1;' +
					    		  'Famille_nocturne2;Genre_nocturne2;Espece_nocturne2;' +
					    		  'Famille_nocturne3;Genre_nocturne3;Espece_nocturne3;' +
					    		  'Famille_nocturne4;Genre_nocturne4;Espece_nocturne4;' +
					    		  'Famille_nocturne5;Genre_nocturne5;Espece_nocturne5;' +
					    		  'Famille_nocturne6;Genre_nocturne6;Espece_nocturne6;' +
					    		  'Famille_nocturne7;Genre_nocturne7;Espece_nocturne7;' +
					    		  'Methode_comptage_nocturne;Resultat_comptage_nocturne_1;Resultat_comptage_nocturne_2;' +
					    		  'Vocalisations;Parade_sexuelle;' +
					    		  'Famille_vocalisations;Genre_vocalisations;Espece_vocalisations;' +
					    		  'Copulations;' +
					    		  'Famille_copulations;Genre_copulations;Espece_copulations;' +
					    		  'Suitee;' +
					    		  'Famille_suitee;Genre_suitee;Espece_suitee;' +
					    		  'Agressions;' +
					    		  'Famille_agressions;Genre_agressions;Espece_agressions;' +
					    		  'Filet_canopee_nb_7;Filet_canopee_m2_7;' + 
					    		  'NumFilet7_1;LongueurFilet7_1;HauteurFilet7_1;' +
					    		  'NumFilet7_2;LongueurFilet7_2;HauteurFilet7_2;' +
					    		  'NumFilet7_3;LongueurFilet7_3;HauteurFilet7_3;' +
					    		  'NumFilet7_4;LongueurFilet7_4;HauteurFilet7_4;' +
					    		  'NumFilet7_5;LongueurFilet7_5;HauteurFilet7_5;' +
					    		  'NumFilet7_6;LongueurFilet7_6;HauteurFilet7_6;' +
					    		  'NumFilet7_7;LongueurFilet7_7;HauteurFilet7_7;' +
					    		  'Filet_canopee_nb_20;Filet_canopee_m2_20;' + 
					    		  'NumFilet20_1;LongueurFilet20_1;HauteurFilet20_1;' +
					    		  'NumFilet20_2;LongueurFilet20_2;HauteurFilet20_2;' +
					    		  'NumFilet20_3;LongueurFilet20_3;HauteurFilet20_3;' +
					    		  'NumFilet20_4;LongueurFilet20_4;HauteurFilet20_4;' +
					    		  'NumFilet20_5;LongueurFilet20_5;HauteurFilet20_5;' +
					    		  'NumFilet20_6;LongueurFilet20_6;HauteurFilet20_6;' +
					    		  'NumFilet20_7;LongueurFilet20_7;HauteurFilet20_7;' +
					    		  'Filet_sol_nb;Filet_sol_m2;' +
					    		  'NumFiletSol_1;LongueurFiletSol_1;HauteurFiletSol_1;' +
					    		  'NumFiletSol_2;LongueurFiletSol_2;HauteurFiletSol_2;' +
					    		  'NumFiletSol_3;LongueurFiletSol_3;HauteurFiletSol_3;' +
					    		  'NumFiletSol_4;LongueurFiletSol_4;HauteurFiletSol_4;' +
					    		  'NumFiletSol_5;LongueurFiletSol_5;HauteurFiletSol_5;' +
					    		  'NumFiletSol_6;LongueurFiletSol_6;HauteurFiletSol_6;' +
					    		  'NumFiletSol_7;LongueurFiletSol_7;HauteurFiletSol_7;' +
					    		  'Filet_debut;Filet_fin;Filet_temps;Filet_capture_nb;Harp_debut;' +
					    		  'Harp_fin;Harp_temps;Harpe_nb;Saison;Climat;Autre_climat;' +
					    		  'Precipitation;Vent;Lune;Temperature_logger;' + 
					    		  'Humidite_logger;Username;\r\n';	
    	} else if (type_table == 'donnees_mission') {
    		var fields = 
    			['Date_debut', 'Date_fin', 'Equipe', 'ID_CS_debut', 'ID_CS_fin', 
    			 'ID_non_invasif_debut', 'ID_non_invasif_fin', 'N_site', 'Pays', 
    			 'Region_capture', 'Site_capture', 'Environnement', 'Proximite_village_km', 
    			 'Lat_degre_dec', 'Latitude', 'Long_degre_dec', 'Longitude', 'Type', 
    			 'Type_Roost', 'Proximite_eau', 'Hauteur_canope', 'Description_site', 'ID_genet_espece', 
    			 'Famille1', 'Genre1', 'Espece1', 'Phenologie1', 'Statut1', 
    			 'Famille2', 'Genre2', 'Espece2', 'Phenologie2', 'Statut2', 
    			 'Famille3', 'Genre3', 'Espece3', 'Phenologie3', 'Statut3', 
    			 'Famille4', 'Genre4', 'Espece4', 'Phenologie4', 'Statut4', 
    			 'Famille5', 'Genre5', 'Espece5', 'Phenologie5', 'Statut5', 
    			 'Famille6', 'Genre6', 'Espece6', 'Phenologie6', 'Statut6', 
    			 'Famille7', 'Genre7', 'Espece7', 'Phenologie7', 'Statut7', 
    			 'Espece_animale_sauvage', 'Espece_animale_domestique', 'Interaction', 
    			 'Description_interaction_animaux', 'Activite_humaine', 'Description_interaction_homme', 
    			 'Camera_trap', 'Heure_debut_camera', 'Heure_fin_camera', 'Username']
    		
    		var fields_CSV_head = 'Date_debut;Date_fin;Equipe;ID_CS_debut;ID_CS_fin;' +
    		                      'ID_non_invasif_debut;ID_non_invasif_fin;N_site;Pays;' +
    		                      'Region_capture;Site_capture;Environnement;' +
    		                      'Proximite_village_km;Lat_degre_dec;Latitude;' +
    		                      'Long_degre_dec;Longitude;Type;Type_Roost;Proximite_eau;' +
    		                      'Hauteur_canope;Description_site;ID_genet_espece;' +
    		                      'Famille1;Genre1;Espece1;Phenologie1;Statut1;' +
    		                      'Famille2;Genre2;Espece2;Phenologie2;Statut2;' +
    		                      'Famille3;Genre3;Espece3;Phenologie3;Statut3;' +
    		                      'Famille4;Genre4;Espece4;Phenologie4;Statut4;' +
    		                      'Famille5;Genre5;Espece5;Phenologie5;Statut5;' +
    		                      'Famille6;Genre6;Espece6;Phenologie6;Statut6;' +
    		                      'Famille7;Genre7;Espece7;Phenologie7;Statut7;' +
    		                      'Espece_animale_sauvage;Espece_animale_domestique;' +
    		                      'Interaction;Description_interaction_animaux;' +
    		                      'Activite_humaine;Description_interaction_homme;' +
    		                      'Camera_trap;Heure_debut_camera;Heure_fin_camera;' +
    		                      'Username;\r\n'

    		
    		
    	} else if (type_table == 'animals') {
    		var fields = 
    			['ID_animal', 'pays', 'mission', 'date', 'village', 'type_chasse_capture',
    			 'Point_GPS_LAT', 'Point_GPS_LONG', 'animal', 'especes', 'sexes', 'age',
    			 'poids', 'etat-physioloque', 'plasma', 'serum', 'blood_spot', 'coeur', 
    			 'cerveau', 'foie_rate', 'glandes_salivaires', 'poumons', 'reins', 
    			 'intestins', 'urine', 'ecouvillon_salivaire', 'ecouvillon_rectal', 
    			 'ecouvillon_nasal', 'ectoparasites', 'placenta', 'liquide_amniotique', 
    			 'testicules', 'lesions_ou_nodules', 'lait', 'foetus', 'observation', 
    			 'guano', 'longueur_bras', 'longueur_avant_bras', 'longueur_corporelle',
    			 'Username']
    		
    		var fields_CSV_head = 'ID_animal;pays;mission;date;village;type_chasse_capture;' +
			 'Point_GPS_LAT;Point_GPS_LONG;animal;especes;sexes;age;' +
			 'poids;etat-physioloque;plasma;serum;blood_spot;coeur;' +
			 'cerveau;foie_rate;glandes_salivaires;poumons;reins;' + 
			 'intestins;urine;ecouvillon_salivaire;ecouvillon_rectal;' + 
			 'ecouvillon_nasal;ectoparasites;placenta;liquide_amniotique;' + 
			 'testicules;lesions_ou_nodules;lait;foetus;observation;' +
			 'guano;longueur_bras;longueur_avant_bras;longueur_corporelle;'+
			 'Username;\r\n'

    		
    		
    	}
        
        //chargement de la table site
        var debug;
		if (localStorage.getItem('debug') === null) {
			debug = '';
		} else {
			debug = localStorage.getItem('debug');
		};
	
		if (localStorage.getItem('web') === 'oui') {
			var remote_couchdb = localStorage.getItem('remote_couchdb');
			var DBSite = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
		} else {
			var DBSite = new PouchDB('site' + nom_table + debug);
		};
		
		var tab = new Array();
		var tabFilet = new Array();
		var tabDonneesJournalieres = new Array();

		DBSite.allDocs({  		
			include_docs: true,
			attachments: true
		}).then(function (result) {
			// handle result
			if (typeof(JSON.stringify(result)) != "undefined"){  
					
				var tableData = JSON.parse(JSON.stringify(result));
					
				tableData.rows.forEach(function(row){   
		   			try {
		   				//tab[i] = new Array();
		   				var obj = new Object();
		   				obj.N_site = row.doc.N_site;
		   				obj.Pays = row.doc.Pays;
		   				obj.Region_capture = row.doc.Region_capture;
		   				obj.Site_capture = row.doc.Site_capture;
		   				obj.Environnement = row.doc.Environnement;
		   				obj.Latitude = row.doc.Latitude;
		   				obj.Lat_degre_dec = row.doc.Lat_degre_dec;
		   				obj.Longitude = row.doc.Longitude;
		   				obj.Long_degre_dec = row.doc.Long_degre_dec;
		   				obj.Proximite_village_km = row.doc.Proximite_village_km;
		   				tab.push(obj);
		   				//i++;	
		   				
		   			} catch(error) {
						console.log(error);
					};
				});	
					
		   	}
		}).then(function () {
			/*var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, COUNT(*) AS NbSite FROM ?  GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec', [tab] );
			
			var site = JSON.stringify(res);
			
			var obj_site = JSON.parse(site);
			
			obj_site.forEach(function(row){
				alert(row.N_site);
			});	*/
			
		}).catch(function (err) {
		   	console.log(err);
		});
		
		if (localStorage.getItem('web') === 'oui') {
			var remote_couchdb = localStorage.getItem('remote_couchdb');
			var DBFilet = new PouchDB(remote_couchdb + 'donnees_journalieres' + nom_table + debug);
		} else {
			var DBFilet = new PouchDB('donnees_journalieres' + nom_table + debug);
		};
		
		var rowcount1 = 0;
		
		DBFilet.allDocs({  		
			include_docs: true,
			attachments: true
		}).then(function (result) {
			// handle result
			if (typeof(JSON.stringify(result)) != "undefined"){  
				
				var tableData = JSON.parse(JSON.stringify(result));
				
				tableData.rows.forEach(function(row){   
	    			try {
	    				
	    				/*tableData.rows[rowcount1].doc.FiletCanopee_7.forEach(function(row1){
	    					try {
	    		   				//tab[i] = new Array();
	    		   				var obj = new Object();
	    		   				obj.NumFilet = row1.NumFilet;
	    		   				obj.LongueurFilet = row1.LongueurFilet;
	    		   				tabFilet7.push(obj);
	    		   				//i++;	
	    		   				
	    		   			} catch(error) {
	    						console.log(error);
	    					};
	    					
	    					//count++
	    				});*/
	    				
	    				if (typeof row.doc.FiletCanopee_7 !== 'undefined') {
			    			row.doc.FiletCanopee_7.forEach(function(row1){ 
			    				var obj = new Object();
	    		   				obj.NumFilet = row1.NumFilet;
	    		   				obj.LongueurFilet = row1.LongueurFilet;
	    		   				obj.HauteurFilet = row1.HauteurFilet;
	    		   				obj.Lat_degre_decFilet = row1.Lat_degre_decFilet;
	    		   				obj.LatitudeFilet = row1.LatitudeFilet;
	    						obj.Long_degre_decFilet = row1.Long_degre_decFilet;
	    						obj.LongitudeFilet = row1.LongitudeFilet;
	    						tabFilet.push(obj);
			    			});
		    			};
		    			if (typeof row.doc.FiletCanopee_20 !== 'undefined') {
			    			row.doc.FiletCanopee_20.forEach(function(row1){ 
			    				var obj = new Object();
	    		   				obj.NumFilet = row1.NumFilet;
	    		   				obj.LongueurFilet = row1.LongueurFilet;
	    		   				obj.HauteurFilet = row1.HauteurFilet;
	    		   				obj.Lat_degre_decFilet = row1.Lat_degre_decFilet;
	    		   				obj.LatitudeFilet = row1.LatitudeFilet;
	    						obj.Long_degre_decFilet = row1.Long_degre_decFilet;
	    						obj.LongitudeFilet = row1.LongitudeFilet;
	    		   				tabFilet.push(obj);
			    			});
		    			};
		    			if (typeof row.doc.FiletSol !== 'undefined') {
			    			row.doc.FiletSol.forEach(function(row1){ 
			    				var obj = new Object();
	    		   				obj.NumFilet = row1.NumFilet;
	    		   				obj.LongueurFilet = row1.LongueurFilet;
	    		   				obj.HauteurFilet = row1.HauteurFilet;
	    		   				obj.Lat_degre_decFilet = row1.Lat_degre_decFilet;
	    		   				obj.LatitudeFilet = row1.LatitudeFilet;
	    						obj.Long_degre_decFilet = row1.Long_degre_decFilet;
	    						obj.LongitudeFilet = row1.LongitudeFilet;
	    		   				tabFilet.push(obj);
			    			});
		    			};
	    				
	    				
	    				
	    			} catch(error) {
						console.log(error);
					};
					rowcount1++;
	    		});	
				
	    	}
		}).then(function () {	
			/*var res = alasql('SELECT NumFilet, LongueurFilet FROM ?  GROUP BY NumFilet, LongueurFilet', [tabFilet] );
			
			var filet = JSON.stringify(res);
			
			var obj_filet = JSON.parse(filet);
			
			obj_filet.forEach(function(row){
				//alert(row.NumFilet);
			
				if (row.NumFilet == 'FSV002') {
					alert(row.LongueurFilet);
				}
			});	*/
		}).catch(function (err) {
			console.log(err);
		});
		
		if (localStorage.getItem('web') === 'oui') {
			var remote_couchdb = localStorage.getItem('remote_couchdb');
			var DBDonneesJournalieres = new PouchDB(remote_couchdb + 'donnees_journalieres' + nom_table + debug);
		} else {
			var DBDonneesJournalieres = new PouchDB('donnees_journalieres' + nom_table + debug);
		};
		
		DBDonneesJournalieres.allDocs({  		
			include_docs: true,
			attachments: true
		}).then(function (result) {
			// handle result
			if (typeof(JSON.stringify(result)) != "undefined"){  
					
				var tableData = JSON.parse(JSON.stringify(result));
					
				tableData.rows.forEach(function(row){   
		   			try {
		   				//tab[i] = new Array();
		   				var obj = new Object();
		   				if (row.doc.ID_CS_preleve_debut.charAt(row.doc.ID_CS_preleve_debut.length - 1) == 'D') {
		   					obj.ID_CS_preleve_debut = Number(extraireNombre(row.doc.ID_CS_preleve_debut)) + .1;
			   				//alert(obj.ID_CS_preleve_debut);
			   				//alert(row.doc.Filet_temps)
		   				} else {
							obj.ID_CS_preleve_debut = Number(extraireNombre(row.doc.ID_CS_preleve_debut));
			   			}
		   				if (row.doc.ID_CS_preleve_fin.charAt(row.doc.ID_CS_preleve_debut.length - 1) == 'D') {
		   					obj.ID_CS_preleve_fin = Number(extraireNombre(row.doc.ID_CS_preleve_fin)) + .1;
			   			} else {
							obj.ID_CS_preleve_fin = Number(extraireNombre(row.doc.ID_CS_preleve_fin));
			   			}
		   				if ((row.doc.Sans_ID_1 != null) && (row.doc.Sans_ID_1 != '')) {
		   					obj.Sans_ID_1 = Number(extraireNombre(row.doc.Sans_ID_1));
		   					//alert(row.doc.Sans_ID_1)
		   				} else {
		   					//alert(obj.ID_CS_preleve_debut)
		   					obj.Sans_ID_1 = '';
		   				}
		   				if ((row.doc.Sans_ID_2 != null) && (row.doc.Sans_ID_2 != '')) {
		   					obj.Sans_ID_2 = Number(extraireNombre(row.doc.Sans_ID_2));
		   					//alert(row.doc.Sans_ID_2)
		   				} else {
		   					obj.Sans_ID_2 = '';
		   				}
		   				if ((row.doc.Sans_ID_3 != null) && (row.doc.Sans_ID_3 != '')) {
		   					obj.Sans_ID_3 = Number(extraireNombre(row.doc.Sans_ID_3));
		   					//alert(row.doc.Sans_ID_3)
		   				} else {
		   					obj.Sans_ID_3 = '';
		   				}
		   				if ((row.doc.Avec_ID_1 != null) && (row.doc.Avec_ID_1 != '')) {
		   					obj.Avec_ID_1 = Number(extraireNombre(row.doc.Avec_ID_1));
		   					//alert(row.doc.Avec_ID_1)
		   				} else {
		   					obj.Avec_ID_1 = '';
		   				}
		   				if ((row.doc.Avec_ID_2 != null) && (row.doc.Avec_ID_2 != '')) {
		   					obj.Avec_ID_2 = Number(extraireNombre(row.doc.Avec_ID_2));
		   					//alert(row.doc.Avec_ID_2)
		   				} else {
		   					obj.Avec_ID_2 = '';
		   				}
		   				if ((row.doc.Avec_ID_3 != null) && (row.doc.Avec_ID_3 != '')) {
		   					obj.Avec_ID_3 = Number(extraireNombre(row.doc.Avec_ID_3));
		   					//alert(row.doc.Avec_ID_3)
		   				} else {
		   					obj.Avec_ID_3 = '';
		   				}
		   				obj.Filet_temps = row.doc.Filet_temps;
		   				obj.Arret_Capture = row.doc.Arret_Capture;
		   				obj.Pairs_impairs = row.doc.Pairs_impairs;
		   				/*obj.Region_capture = row.doc.Region_capture;
		   				obj.Site_capture = row.doc.Site_capture;
		   				obj.Environnement = row.doc.Environnement;
		   				obj.Latitude = row.doc.Latitude;
		   				obj.Lat_degre_dec = row.doc.Lat_degre_dec;
		   				obj.Longitude = row.doc.Longitude;
		   				obj.Long_degre_dec = row.doc.Long_degre_dec;
		   				obj.Proximite_village_km = row.doc.Proximite_village_km;*/
		   				var nombre_CS = obj.ID_CS_preleve_fin - obj.ID_CS_preleve_debut;
		   				//alert(row.doc.ID_CS_preleve_debut + '-' + row.doc.ID_CS_preleve_fin + ' : ' + nombre_CS);
		   				
		   				tabDonneesJournalieres.push(obj);
		   				//i++;	
		   				
		   			} catch(error) {
						console.log(error);
					};
				});	
					
		   	}
		}).then(function () {
			/*var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, COUNT(*) AS NbSite FROM ?  GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec', [tab] );
			
			var site = JSON.stringify(res);
			
			var obj_site = JSON.parse(site);
			
			obj_site.forEach(function(row){
				alert(row.N_site);
			});	*/
			
		}).catch(function (err) {
		   	console.log(err);
		});

    	
    	/*$('#multiselect1').multiSelect({
			afterSelect: function(values){
				alert("ADD: " + values);
			},
			afterDeselect: function(values){
				alert("REMOVE: " + values);
			}
		});*/
		
		$('#add_selection_criteria').click(function(){
			array_selected_fields = [];
			array_selected_fields.length = 0;
			
			$('#multiselect1 :selected').each(function(i, sel){ 
				array_selected_fields.push($(sel).val()); 
			});
						
			localStorage.setItem("fields_selected", JSON.stringify(array_selected_fields));
						
			if (type_table == 'chauves_souris_capturees') {
				window.location = 'selection_criteres_chauves_souris_capturees.html?table=' + nom_table + '&type=chauves_souris_capturees' ;
			} else if (type_table == 'chauves_souris_non_invasives') {
				window.location = 'selection_criteres_chauves_souris_non_invasives.html?table=' + nom_table + '&type=chauves_souris_non_invasives';
			} else if (type_table == 'viande_de_brousse') {
				window.location = 'selection_criteres_viande_de_brousse.html?table=' + nom_table + '&type=viande_de_brousse';
			} else if (type_table == 'donnees_journalieres') {
				window.location = 'selection_donnees_journalieres.html?table=' + nom_table + '&type=donnees_journalieres';
			} else if (type_table == 'donnees_mission') {
				window.location = 'selection_donnees_missions.html?table=' + nom_table + '&type=donnees_mission';
			} else if (type_table == 'animals') {
				window.location = 'selection_criteres_animals.html?table=' + nom_table + '&type=animals';
			}
			
        });
    
    	$('#export_all_fields').click(function(){
    		
    		if (type_table == 'chauves_souris_non_invasives') {
	    		DB.info().then((infos) => {
					//count = infos.doc_count;
					
					count = 0;
					rowcount1 = 0;
					
					
					DB.allDocs({  		
						include_docs: true,
						attachments: true
					}).then(function (result) {
						// handle result
						if (typeof(JSON.stringify(result)) != "undefined"){  
							
							var tableData = JSON.parse(JSON.stringify(result));
							
							tableData.rows.forEach(function(row){   
				    			try {
				    				tableData.rows[rowcount1].doc.Echantillons.forEach(function(row1){
				    					count++
				    				});
				    			} catch(error) {
									console.log(error);
								};
								rowcount1++;
				    		});	
							
				    	}
					}).catch(function (err) {
						console.log(err);
					});
	    		});
    		}
    		
    		rowcount = 0;
 			
			DB.info().then((infos) => {
				
				if ((type_table == 'chauves_souris_capturees') 
					 || (type_table == 'viande_de_brousse')
					 || (type_table == 'donnees_journalieres')
					 || (type_table == 'donnees_mission')
					 || (type_table == 'animals')) {
					count = infos.doc_count;
				}
				
				CSV = fields_CSV_head;
				
				DB.allDocs({  		
					include_docs: true,
					attachments: true
				}).then(function (result) {
					// handle result
					if (typeof(JSON.stringify(result)) != "undefined"){  
			    		var tableData = JSON.parse(JSON.stringify(result));
						
			    		tableData.rows.forEach(function(row){   
			    			if (type_table == 'chauves_souris_capturees') {
			    				addChauves_souris_capturees(row, false);
			    			} else if (type_table == 'chauves_souris_non_invasives') {
			    	    		addChauves_souris_non_invasives(tableData, row);
			    	    	} else if (type_table == 'viande_de_brousse') {
			    	    		addViande_de_brousse(row);
			    	    	} else if (type_table == 'donnees_journalieres') {
			    	    		addDonnees_journalieres(row);
			    	    	} else if (type_table == 'donnees_mission') {
			    	    		addDonnees_missions(row);
			    	    	} else if (type_table == 'animals') {
			    	    		addAnimals(row);
			    	    	}
			    			
			    		});		
			    		
			    		//var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
		    			
			    		
			    		//saveAs(blob, "testfile1.csv");
			    		//saveAs(blob, "ebo-sursy" + clock.now + ".csv");
			    		
			    		
					}
				}).catch(function (err) {
					console.log(err);
				});
				
				
			}).catch((error) => {
			});
 		    
        });
		
		$('#export_selected_fields').click(function(){
			
			array_selected_fields = [];
			array_selected_fields.length = 0;
			
			$('#multiselect1 :selected').each(function(i, sel){ 
				array_selected_fields.push($(sel).val()); 
			});
			
			if (type_table == 'chauves_souris_capturees') {
				addChauves_souris_capturees_selected_heading();
			} else if (type_table == 'chauves_souris_non_invasives') {
	    		addChauves_souris_non_invasives_selected_heading();
	    	} else if (type_table == 'viande_de_brousse') {
	    		addViandes_de_brousse_selected_heading();
	    	} else if (type_table == 'donnees_journalieres') {
	    		addJournalieres_selected_heading();
	    	} else if (type_table == 'donnees_mission') {
	    		addMissions_selected_heading();
	    	} else if (type_table == 'animals') {
	    		addAnimals_selected_heading();
	    	}
			
			
			if (type_table == 'chauves_souris_non_invasives') {
				DB.info().then((infos) => {
					
					count = 0;
					rowcount1 = 0;
					
					DB.allDocs({  		
						include_docs: true,
						attachments: true
					}).then(function (result) {
						// handle result
						if (typeof(JSON.stringify(result)) != "undefined"){  
							
							var tableData = JSON.parse(JSON.stringify(result));
							
							tableData.rows.forEach(function(row){   
				    			try {
				    				tableData.rows[rowcount1].doc.Echantillons.forEach(function(row1){
				    					count++
				    				});
				    			} catch(error) {
									console.log(error);
								};
								rowcount1++;
				    		});	
							
				    	}
					}).catch(function (err) {
						console.log(err);
					});
	    		});
			}
    		
    		rowcount = 0;
 			
			DB.info().then((infos) => {
				
				if ((type_table == 'chauves_souris_capturees') 
					 || (type_table == 'viande_de_brousse')
					 || (type_table == 'donnees_journalieres')
					 || (type_table == 'donnees_mission')
					 || (type_table == 'animals')
					 ) {
					count = infos.doc_count;
				}
				
				//CSV = fields_CSV_head;
				
				DB.allDocs({  		
					include_docs: true,
					attachments: true
				}).then(function (result) {
					// handle result
					if (typeof(JSON.stringify(result)) != "undefined"){  
			    		var tableData = JSON.parse(JSON.stringify(result));
						
			    		tableData.rows.forEach(function(row){   
			    			if (type_table == 'chauves_souris_capturees') {
			    				addChauves_souris_capturees(row, true);
			    			} else if (type_table == 'chauves_souris_non_invasives') {
			    	    		addChauves_souris_non_invasives_selected(tableData, row);
			    	    	} else if (type_table == 'viande_de_brousse') {
			    	    		addViandes_de_brousse_selected(row);
			    	    	} else if (type_table == 'donnees_journalieres') {
			    	    		addJournalieres_selected(row);
			    	    	} else if (type_table == 'donnees_mission') {
			    	    		addMissions_selected(row);
			    	    	} else if (type_table == 'animals') {
			    	    		addAnimals_selected(row);
			    	    	}
			    			
			    			
			    		});		
			    		
			    		//var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
		    			
			    		
			    		//saveAs(blob, "testfile1.csv");
			    		//saveAs(blob, "ebo-sursy" + clock.now + ".csv");
			    		
			    		
					}
				}).catch(function (err) {
					console.log(err);
				});
				
				
			}).catch((error) => {
			});
 		    
			
			
 		    
        });
    	
    	function addChauves_souris_capturees(row, selected) {
    		
    		
    		
    		if (count > 0) {
    			
    			if (row.doc.N_site == null) {
    				console.log(row.doc.N_identification_CS)
    				
    				if (row.doc.Pays != null) {
    					Pays = row.doc.Pays; 
    				} else {
    					Pays = '';
					}
    				if (row.doc.Region_capture != null) {
    					Region_capture = row.doc.Region_capture;
    				} else {
    					Region_capture = '';
					}
    				if (row.doc.Site_capture != null) {
    					Site_capture = row.doc.Site_capture;
    				} else {
    					Site_capture = '';
					}
    				if (row.doc.Environnement != null) {
    					Environnement = row.doc.Environnement;
    				} else {
    					Environnement = '';
					}
    				if (row.doc.Pays != null) {
    					Latitude = row.doc.Latitude;
    				} else {
    					Latitude = '';
					}
    				if (row.doc.Lat_degre_dec != null) {
    					Lat_degre_dec = row.doc.Lat_degre_dec;
    					Lat_degre_dec = Lat_degre_dec.replace('°', '');
						Lat_degre_dec = Lat_degre_dec.replace('.', ','); 
    				} else {
    					Lat_degre_dec = '';
					}
    				if (row.doc.Longitude != null) {
    					Longitude = row.doc.Longitude;
    				} else {
    					Longitude = '';
					}
    				if (row.doc.Long_degre_dec != null) {
    					Long_degre_dec = row.doc.Long_degre_dec;
						Long_degre_dec = Long_degre_dec.replace('°', '');
    					Long_degre_dec = Long_degre_dec.replace('.', ',');
    				} else {
    					Long_degre_dec = '';
					}
    				if (row.doc.Proximite_village_km != null) {
    					Proximite_village_km = row.doc.Proximite_village_km;
    					Proximite_village_km = Proximite_village_km.replace('.', ',');
    				} else {
    					Proximite_village_km = '';
					}
    				
    				
    			}
    			
    			/*var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};*/
    			
    			if (row.doc.N_site != null) {
    				console.log(row.doc.N_identification_CS)
	    			var N_site = row.doc.N_site;
	    			
	    			var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
	    			
	    			var site = JSON.stringify(res);
	    			
	    			var obj_site = JSON.parse(site);
	    			
	    			obj_site.forEach(function(row){
	    				Pays = row.Pays;
	    				Region_capture = row.Region_capture;
	    				Site_capture = row.Site_capture;
	    				Environnement = row.Environnement;
    					Latitude = row.Latitude;
    					Lat_degre_dec = row.Lat_degre_dec;
    					Lat_degre_dec = Lat_degre_dec.replace('°', '');
    					Lat_degre_dec = Lat_degre_dec.replace('.', ',');
    					Longitude = row.Longitude;
    					Long_degre_dec = row.Long_degre_dec;
    					Long_degre_dec = Long_degre_dec.replace('°', '');
    					Long_degre_dec = Long_degre_dec.replace('.', ',');
    					Proximite_village_km = row.Proximite_village_km;
    					Proximite_village_km = Proximite_village_km.replace('.', ',')
    					
    					NbSite = row.NbSite;
	    			});
	    		}
	    			
	    			
					
				LongueurFilet = '';
				HauteurFilet = '';
				Lat_degre_decFilet = '';
				LatitudeFilet = '';
				Long_degre_decFilet = '';
				LongitudeFilet = '';
					
					
				if (row.doc.NumFilet != null) {
					var NumFilet = row.doc.NumFilet;
						
					var res = alasql('SELECT NumFilet, LongueurFilet, HauteurFilet, Lat_degre_decFilet, LatitudeFilet, Long_degre_decFilet, LongitudeFilet FROM ? WHERE NumFilet == "' + NumFilet + '"' + ' GROUP BY NumFilet, LongueurFilet, HauteurFilet, Lat_degre_decFilet, LatitudeFilet, Long_degre_decFilet, LongitudeFilet', [tabFilet] );
						
					var filet = JSON.stringify(res);
						
					var obj_filet = JSON.parse(filet);
						
					obj_filet.forEach(function(row){
						if (row.LongueurFilet != null) {
							LongueurFilet = row.LongueurFilet;
							LongueurFilet = LongueurFilet.replace('.', ',');
						} else {
							LongueurFilet = '';
						}
						if (row.HauteurFilet != null) {
							HauteurFilet = row.HauteurFilet;
							HauteurFilet = HauteurFilet.replace('.', ',');
						} else {
							HauteurFilet = '';
						}
						if (row.Lat_degre_decFilet != null) {
							Lat_degre_decFilet = row.Lat_degre_decFilet;
							Lat_degre_decFilet = Lat_degre_decFilet.replace('.', ',');
						} else {
							Lat_degre_decFilet = '';
						}
						if (row.LatitudeFilet != null) {
							LatitudeFilet = row.LatitudeFilet;
						} else {
							LatitudeFilet = '';
						}
						if (row.Long_degre_decFilet != null) {
							Long_degre_decFilet = row.Long_degre_decFilet;
							Long_degre_decFilet = Long_degre_decFilet.replace('.', ',');
						} else {
							Long_degre_decFilet = '';
						}
						if (row.LongitudeFilet != null) {
							LongitudeFilet = row.LongitudeFilet;
						} else {
							LongitudeFilet = '';
						}
					});
				}
	   			
				var Filet_temps = '';
				var Arret_Capture = '';
				
				var id;
				try {
					if (row.doc.N_identification_CS.charAt(row.doc.N_identification_CS.length - 1) == 'D') {
						id = Number(extraireNombre(row.doc.N_identification_CS)) + .1;
						//alert(id);
						idD = true;
					} else {
	   					id = Number(extraireNombre(row.doc.N_identification_CS));
	   					idD = false;
			   		}
				} catch (err) {
					alert('ERROR');
				}
	   				
				if (idD && ((id - 0.1) % 2) == 0) {
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id + ' AND (Pairs_impairs == "Pairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ') GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				} else if (idD && ((id - 0.1) % 2)!= 0) {
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id  + ' AND (Pairs_impairs == "Impairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ')  GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				} else if ((id % 2) == 0) {
					//alert(id + '-> Pair')
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id + ' AND (Pairs_impairs == "Pairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ')  GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				} else {						//alert(id + '-> Impair')
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id  + ' AND (Pairs_impairs == "Impairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ')  GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				}
					
				try {
					var donneesJournaliere = JSON.stringify(res);
					
					var obj_donneesJournaliere = JSON.parse(donneesJournaliere);
					
					obj_donneesJournaliere.forEach(function(row){
						if ((id.toString().charAt(id.toString().length - 1) == '1') 
							&& (id.toString().charAt(id.toString().length - 2) == '.')) {
							//alert('debut = ' + row.ID_CS_preleve_debut);
							//alert('fin = ' + row.ID_CS_preleve_fin);
						}
							
						if  ((row.Sans_ID_1 == '') && (row.Sans_ID_2 == '') && (row.Sans_ID_3 == '')) {
							try {
								Filet_temps = row.Filet_temps;
							} catch  (err) {
								Filet_temps = '';
							}
							try {
								Arret_Capture = row.Arret_Capture;
							} catch (err) {
								Arret_Capture = 'Non';
							}
						}
						else if ((row.ID_CS_preleve_debut != '') && (row.ID_CS_preleve_fin != '')) {
							if ((row.ID_CS_preleve_debut != null) && (row.ID_CS_preleve_fin != null) 									 && (row.Sans_ID_1 != id)
								&& (row.Sans_ID_2 != id) 
								&& (row.Sans_ID_3 != id) ){
									
								try {
									Filet_temps = row.Filet_temps;
								} catch  (err) {
									Filet_temps = '';
								}
								try {
									Arret_Capture = row.Arret_Capture;
								} catch (err) {
									Arret_Capture = 'Non';
								}
									
							}
						}
			   				
					});
				} catch (err) {
					
				}
				
				if (row.doc.Lat_degre_dec_Lieu_capture != null) {
					Lat_degre_dec_Lieu_capture = row.doc.Lat_degre_dec_Lieu_capture;
					Lat_degre_dec_Lieu_capture = Lat_degre_dec_Lieu_capture.replace('.', ',');
				} else {
					Lat_degre_dec_Lieu_capture = '';
				}
				if (row.doc.Long_degre_dec_Lieu_capture != null) {
					Long_degre_dec_Lieu_capture = row.doc.Long_degre_dec_Lieu_capture;
					Long_degre_dec_Lieu_capture = Long_degre_dec_Lieu_capture.replace('.', ',');
				} else {
					Long_degre_dec_Lieu_capture = '';
				}
				
				Poids_enfant = row.doc.Poids_enfant;
				Poids_enfant = Poids_enfant.replace('.', ',');
				Poids_gr = row.doc.Poids_gr;
				Poids_gr = Poids_gr.replace('.', ',');
				L_avant_bras_mm = row.doc.L_avant_bras_mm;
				L_avant_bras_mm = L_avant_bras_mm.replace('.', ',');
				L_totale_corps_mm = row.doc.L_totale_corps_mm;
				L_totale_corps_mm = L_totale_corps_mm.replace('.', ',');
				L_queue_mm = row.doc.L_queue_mm;
				L_queue_mm = L_queue_mm.replace('.', ',');
				L_metacarpe_3ieme_doigt_mm = row.doc.L_metacarpe_3ieme_doigt_mm;
				L_metacarpe_3ieme_doigt_mm.replace('.', ',');
				Sang_DBS_nb_cercles = row.doc.Sang_DBS_nb_cercles;
				Sang_DBS_nb_cercles.replace('.', ',');
				
				if ((row.doc.Feces_ethanol == null) || (row.doc.Feces_ethanol == 'undefined')) {
					Feces_ethanol = '0'
				} else {
					Feces_ethanol = row.doc.Feces_ethanol;
				}
				if ((row.doc.Lait == null) || (row.doc.Lait == 'undefined') || (row.doc.Lait == '')) {
					Lait = '0'
				} else {
					Lait = row.doc.Lait;
				}
				if ((row.doc.Username == null) || (row.doc.Username == 'undefined')) {
					Username = ''
				} else {
					Username = row.doc.Username;
				}
					
				if (!selected) { 	
	    			CSV = CSV +
	    				row.doc.N_identification_CS + ';' +
	    				row.doc.N_identification_mere + ';' + 
	    				row.doc.Numero_mission + ';' +
	   					row.doc.N_site + ';' +
	   					row.doc.Date + ';' +
	   					row.doc.Equipe + ';' + 
	   					Pays + ';' + 
	   					Region_capture + ';' + 
	    				Site_capture + ';' + 
	    				row.doc.Lieu_capture + ';' +
	    				Environnement + ';' + 
	    				Latitude + ';' + 
	   					Lat_degre_dec + ';' + 
	   					Longitude + ';' + 
	   					Long_degre_dec + ';' +
	   					Proximite_village_km + ';' + 
	   					row.doc.Methode_capture + ';' +
	    				row.doc.NumFilet + ';' +	
	    				LongueurFilet + ';' +	
	    				HauteurFilet + ';' +	
	    				Lat_degre_decFilet + ';' +	
	   					LatitudeFilet + ';' +	
	   					Long_degre_decFilet	 + ';' +
	   					LongitudeFilet + ';' +	
	   					Lat_degre_dec_Lieu_capture + ';' +	
	   					row.doc.Latitude_Lieu_capture + ';' +	
	    				Long_degre_dec_Lieu_capture + ';' +
	    				row.doc.Longitude_Lieu_capture + ';' +	
	    				row.doc.Type_chauve_souris + ';' +
	    				row.doc.Espece_identifiee + ';' + 
	   					row.doc.Famille_terrain + ';' + 
	   					row.doc.Genre_terrain + ';' + 
	   					row.doc.Espece_terrain + ';' +
	   					row.doc.Famille_labo + ';' + 
	    				row.doc.Genre_labo + ';' + 
	    				row.doc.Espece_labo + ';' + 
	    				row.doc.Famille_consensus + ';' + 
	    				row.doc.Genre_consensus + ';' + 
	    				row.doc.Espece_consensus + ';' + 
	   					row.doc.Sexe + ';' + 
	   					row.doc.Age + ';' + 
	   					row.doc.Gestante + ';' + 
	   					row.doc.Lactation + ';' + 
	   					row.doc.Suitee + ';' + 
	    				row.doc.Sexe_enfant + ';' +
	    				Poids_enfant + ';' + 
	    				row.doc.Identifiant_enfant + ';' + 
	    				row.doc.Vivante + ';' + 
	   					row.doc.Cause_deces + ';' + 
	   					Poids_gr + ';' +
	   					L_avant_bras_mm + ';' + 
	   					L_totale_corps_mm + ';' + 
	   					row.doc.Taille_yeux + ';' + 
	    				L_queue_mm + ';' +
	    				L_metacarpe_3ieme_doigt_mm + ';' + 
	    				row.doc.Couleur_pelage_dorsal + ';' +
	    				row.doc.Couleur_pelage_ventral + ';' + 
	   					row.doc.Remarques_anomalies.split(';').join(',') + ';' + 
	   					Sang_DBS_nb_cercles + ';' + 
	   					row.doc.Sang_tube_EDTA + ';' + 
	   					row.doc.Feces_RNAl + ';' + 
	   					row.doc.Urine + ';' + 
	    				row.doc.Urine_DUS_nombre_cercles + ';' +
	    				row.doc.Feces_urine_RNAl + ';' + 
	    				row.doc.Ecouvillon_gorge_RNAl + ';' + 
	    				row.doc.Ecouvillon_rectal_RNAl + ';' +
	   					row.doc.Ectoparasites_ethanol + ';' + 
	   					row.doc.Poils_ethanol + ';' + 
	   					row.doc.Wing_punch_ethanol + ';' +
	   					row.doc.Feces_culture_glycerol + ';' + 
	   					Feces_ethanol + ';' + 
	    				row.doc.Sperme + ';' + 
	    				Lait + ';' + 
	    				row.doc.Autres_echantillons_remarques.split(';').join(',') + ';' +
	    				row.doc.Specimen_entier + ';' + 
	   					row.doc.Specimen_preserve_dans + ';' + 
	   					row.doc.Prelevement_organe + ';' +
	   					row.doc.Foie_formol + ';' + 
	   					row.doc.Foie_RNAl + ';' + 
	   					row.doc.Rate_formol + ';' + 
	    				row.doc.Rate_RNAl + ';' + 
	    				row.doc.Reins_formol + ';' +
	    				row.doc.Reins_RNAl + ';' + 
	    				row.doc.Intestins_formol + ';' + 
	   					row.doc.Intestins_RNAl + ';' + 
	   					row.doc.Poumons_formol + ';' +
	   					row.doc.Poumons_RNAl + ';' + 
	   					row.doc.Coeur_formol + ';' +
	   					row.doc.Coeur_RNAl + ';' + 
	    				row.doc.Ggl_lymph_formol + ';' +
	    				row.doc.Ggl_lymph_RNAl + ';' + 
	    				row.doc.Testicules_formol + ';' + 
	    				row.doc.Testicules_RNAl + ';' + 
	   					row.doc.Peau_formol + ';' +
	   					row.doc.Peau_RNAl + ';' + 
	   					row.doc.Muscles_formol + ';' + 
	   					row.doc.Muscles_RNAl + ';' + 
	   					row.doc.Cerveau_formol + ';' +
	    				row.doc.Cerveau_RNAl + ';' + 
	    				row.doc.Autre + ';' + 
	    				row.doc.Autre_formol + ';' + 
	    				row.doc.Autre_RNAl + ';' + 
	   					row.doc.Remarques_echantillons.split(';').join(',') + ';' +
	   					Username + ';' +
	   					Filet_temps + ';' +  
	   					Arret_Capture + ";\r\n"
    			
	   			} else {
	   				if (array_selected_fields.indexOf('N_identification_CS') > -1) {
	    				CSV = CSV + row.doc.N_identification_CS + ";" 
					};
	    			if (array_selected_fields.indexOf('N_identification_mere') > -1) {
	    				CSV = CSV + row.doc.N_identification_mere + ";"
	    			};
	    			if (array_selected_fields.indexOf('Numero_mission') > -1) {
	    				CSV = CSV + row.doc.Numero_mission + ";"
	    			};
	    			if (array_selected_fields.indexOf('N_site') > -1) {
	    				CSV = CSV + row.doc.N_site + ";"
	    			};
	    			if (array_selected_fields.indexOf('Date') > -1) {
	    				CSV = CSV + row.doc.Date + ";"
	    			};
	    			if (array_selected_fields.indexOf('Equipe') > -1) {
	    				CSV = CSV + row.doc.Equipe + ";"
	    			};
	    			if (array_selected_fields.indexOf('Pays') > -1) {
	    				CSV = CSV + Pays + ";"
	    			};
	    			if (array_selected_fields.indexOf('Region_capture') > -1) {
	    				CSV = CSV + Region_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Site_capture') > -1) {
	    				CSV = CSV + Site_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Lieu_capture') > -1) {
	    				CSV = CSV + row.doc.Lieu_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Environnement') > -1) {
	    				CSV = CSV + Environnement + ";"
	    			};
	    			if (array_selected_fields.indexOf('Latitude') > -1) {
	    				CSV = CSV + Latitude + ";"
	    			};
	    			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
	    				CSV = CSV + Lat_degre_dec + ";"
	    			};
	    			if (array_selected_fields.indexOf('Longitude') > -1) {
	    				CSV = CSV + Longitude + ";"
	    			};
	    			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
	    				CSV = CSV + Long_degre_dec + ";"
	    			};
	    			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
	    				CSV = CSV + Proximite_village_km + ";"
	    			};
	    			if (array_selected_fields.indexOf('Methode_capture') > -1) {
	    				CSV = CSV + row.doc.Methode_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('NumFilet') > -1) {
	    				CSV = CSV + row.doc.NumFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('LongueurFilet') > -1) {
	    				CSV = CSV + LongueurFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('HauteurFilet') > -1) {
	    				CSV = CSV + HauteurFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('Lat_degre_decFilet') > -1) {
	    				CSV = CSV + Lat_degre_decFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('LatitudeFilet') > -1) {
	    				CSV = CSV + LatitudeFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('Long_degre_decFilet') > -1) {
	    				CSV = CSV + Long_degre_decFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('LongitudeFilet') > -1) {
	    				CSV = CSV + LongitudeFilet + ";"
	    			};
	    			if (array_selected_fields.indexOf('Lat_degre_dec_Lieu_capture') > -1) {
	    				CSV = CSV + Lat_degre_dec_Lieu_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Latitude_Lieu_capture') > -1) {
	    				CSV = CSV + row.doc.Latitude_Lieu_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Long_degre_dec_Lieu_capture') > -1) {
	    				CSV = CSV + Long_degre_dec_Lieu_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Longitude_Lieu_capture') > -1) {
	    				CSV = CSV + row.doc.Longitude_Lieu_capture + ";"
	    			};
	    			if (array_selected_fields.indexOf('Type_chauve_souris') > -1) {
	    				CSV = CSV + row.doc.Type_chauve_souris + ";"
	    			};
	    			if (array_selected_fields.indexOf('Espece_identifiee') > -1) {
	    				CSV = CSV + row.doc.Espece_identifiee + ";"
	    			};
	    			if (array_selected_fields.indexOf('Famille_terrain') > -1) {
	    				CSV = CSV + row.doc.Famille_terrain + ";"
	    			};
	        		if (array_selected_fields.indexOf('Genre_terrain') > -1) {
	    				CSV = CSV + row.doc.Genre_terrain + ";"
	    			};
	    			if (array_selected_fields.indexOf('Espece_terrain') > -1) {
	    				CSV = CSV + row.doc.Espece_terrain + ";"
	    			};
	    			if (array_selected_fields.indexOf('Famille_labo') > -1) {
	    				CSV = CSV + row.doc.Famille_labo + ";"
	    			};
	    			if (array_selected_fields.indexOf('Genre_labo') > -1) {
	    				CSV = CSV + row.doc.Genre_labo + ";"
	    			};
	    			if (array_selected_fields.indexOf('Espece_labo') > -1) {
	    				CSV = CSV + row.doc.Espece_labo + ";"
	    			};
	    			if (array_selected_fields.indexOf('Famille_consensus') > -1) {
	    				CSV = CSV + row.doc.Famille_consensus + ";"
	    			};
	    			if (array_selected_fields.indexOf('Genre_consensus') > -1) {
	    				CSV = CSV + row.doc.Genre_consensus + ";"
	    			};
	    			if (array_selected_fields.indexOf('Espece_consensus') > -1) {
	    				CSV = CSV + row.doc.Espece_consensus + ";"
	    			};
	    			if (array_selected_fields.indexOf('Sexe') > -1) {
	    				CSV = CSV + row.doc.Sexe + ";"
	    			};
	    			if (array_selected_fields.indexOf('Age') > -1) {
	    				CSV = CSV + row.doc.Age + ";"
	    			};
	    			if (array_selected_fields.indexOf('Gestante') > -1) {
	    				CSV = CSV + row.doc.Gestante + ";"
	    			};
	    			if (array_selected_fields.indexOf('Lactation') > -1) {
	    				CSV = CSV + row.doc.Lactation + ";"
	    			};
	    			if (array_selected_fields.indexOf('Suitee') > -1) {
	    				CSV = CSV + row.doc.Suitee + ";"
	    			};
	    			if (array_selected_fields.indexOf('Sexe_enfant') > -1) {
	    				CSV = CSV + row.doc.Sexe_enfant + ";"
	    			};
	    			if (array_selected_fields.indexOf('Poids_enfant') > -1) {
	    				CSV = CSV + Poids_enfant + ";"
	    			};
	    			if (array_selected_fields.indexOf('Identifiant_enfant') > -1) {
	    				CSV = CSV + row.doc.Identifiant_enfant + ";"
	    			};
	    			if (array_selected_fields.indexOf('Vivante') > -1) {
	    				CSV = CSV + row.doc.Vivante + ";"
	    			};
	    			if (array_selected_fields.indexOf('Cause_deces') > -1) {
	    				CSV = CSV + row.doc.Cause_deces + ";"
	    			};
	    			if (array_selected_fields.indexOf('Poids_gr') > -1) {
	    				CSV = CSV + Poids_gr + ";"
	    			};
	    			if (array_selected_fields.indexOf('L_avant_bras_mm') > -1) {
	    				CSV = CSV + L_avant_bras_mm + ";"
	    			};
	    			if (array_selected_fields.indexOf('L_totale_corps_mm') > -1) {
	    				CSV = CSV + L_totale_corps_mm + ";"
	    			};
	        		if (array_selected_fields.indexOf('Taille_yeux') > -1) {
	    				CSV = CSV + row.doc.Taille_yeux + ";"
	    			};
	    			if (array_selected_fields.indexOf('L_queue_mm') > -1) {
	    				CSV = CSV + L_queue_mm + ";"
	    			};
	    			if (array_selected_fields.indexOf('L_metacarpe_3ieme_doigt_mm') > -1) {
	    				CSV = CSV + L_metacarpe_3ieme_doigt_mm + ";"
	    			};
	    			if (array_selected_fields.indexOf('Couleur_pelage_dorsal') > -1) {
	    				CSV = CSV + row.doc.Couleur_pelage_dorsal + ";"
	    			};
	    			if (array_selected_fields.indexOf('Couleur_pelage_ventral') > -1) {
	    				CSV = CSV + row.doc.Couleur_pelage_ventral + ";"
	    			};
	    			if (array_selected_fields.indexOf('Remarques_anomalies') > -1) {
	    				CSV = CSV + row.doc.Remarques_anomalies.split(';').join(',') + ";"
	    			};
	    			if (array_selected_fields.indexOf('Sang_DBS_nb_cercles') > -1) {
	    				CSV = CSV + Sang_DBS_nb_cercles + ";"
	    			};
	    			if (array_selected_fields.indexOf('Sang_tube_EDTA') > -1) {
	    				CSV = CSV + row.doc.Sang_tube_EDTA + ";"
	    			};
	    			if (array_selected_fields.indexOf('Feces_RNAl') > -1) {
	    				CSV = CSV + row.doc.Feces_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Urine') > -1) {
	    				CSV = CSV + row.doc.Urine + ";"
	    			};
	    			if (array_selected_fields.indexOf('Urine_DUS_nombre_cercles') > -1) {
	    				CSV = CSV + row.doc.Urine_DUS_nombre_cercles + ";"
	    			};
	    			if (array_selected_fields.indexOf('Feces_urine_RNAl') > -1) {
	    				CSV = CSV + row.doc.Feces_urine_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Ecouvillon_gorge_RNAl') > -1) {
	    				CSV = CSV + row.doc.Ecouvillon_gorge_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Ecouvillon_rectal_RNAl') > -1) {
	    				CSV = CSV + row.doc.Ecouvillon_rectal_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Ectoparasites_ethanol') > -1) {
	    				CSV = CSV + row.doc.Ectoparasites_ethanol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Poils_ethanol') > -1) {
	    				CSV = CSV + row.doc.Poils_ethanol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Wing_punch_ethanol') > -1) {
	    				CSV = CSV + row.doc.Wing_punch_ethanol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Feces_culture_glycerol') > -1) {
	    				CSV = CSV + row.doc.Feces_culture_glycerol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Feces_ethanol') > -1) {
	    				CSV = CSV + Feces_ethanol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Sperme') > -1) {
	    				CSV = CSV + row.doc.Sperme + ";"
	    			};
	    			if (array_selected_fields.indexOf('Lait') > -1) {
	    				CSV = CSV + Lait + ";"
	    			};
	    			if (array_selected_fields.indexOf('Autres_echantillons_remarques') > -1) {
	    				CSV = CSV + row.doc.Autres_echantillons_remarques.split(';').join(',') + ";"
	    			};
	    			if (array_selected_fields.indexOf('Specimen_entier') > -1) {
	    				CSV = CSV + row.doc.Specimen_entier + ";"
	    			};
	        		if (array_selected_fields.indexOf('Specimen_preserve_dans') > -1) {
	    				CSV = CSV + row.doc.Specimen_preserve_dans + ";"
	    			};
	    			if (array_selected_fields.indexOf('Prelevement_organe') > -1) {
	    				CSV = CSV + row.doc.Prelevement_organe + ";"
	    			};
	    			if (array_selected_fields.indexOf('Foie_formol') > -1) {
	    				CSV = CSV + row.doc.Foie_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Foie_RNAl') > -1) {
	    				CSV = CSV + row.doc.Foie_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Rate_formol') > -1) {
	    				CSV = CSV + row.doc.Rate_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Rate_RNAl') > -1) {
	    				CSV = CSV + row.doc.Rate_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Reins_formol') > -1) {
	    				CSV = CSV + row.doc.Reins_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Reins_RNAl') > -1) {
	    				CSV = CSV + row.doc.Reins_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Intestins_formol') > -1) {
	    				CSV = CSV + row.doc.Intestins_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Intestins_RNAl') > -1) {
	    				CSV = CSV + row.doc.Intestins_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Poumons_formol') > -1) {
	    				CSV = CSV + row.doc.Poumons_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Poumons_RNAl') > -1) {
	    				CSV = CSV + row.doc.Poumons_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Coeur_formol') > -1) {
	    				CSV = CSV + row.doc.Coeur_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Coeur_RNAl') > -1) {
	    				CSV = CSV + row.doc.Coeur_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Ggl_lymph_formol') > -1) {
	    				CSV = CSV + row.doc.Ggl_lymph_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Ggl_lymph_RNAl') > -1) {
	    				CSV = CSV + row.doc.Ggl_lymph_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Testicules_formol') > -1) {
	    				CSV = CSV + row.doc.Testicules_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Testicules_RNAl') > -1) {
	    				CSV = CSV + row.doc.Testicules_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Peau_formol') > -1) {
	    				CSV = CSV + row.doc.Peau_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Peau_RNAl') > -1) {
	    				CSV = CSV + row.doc.Peau_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Muscles_formol') > -1) {
	    				CSV = CSV + row.doc.Muscles_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Muscles_RNAl') > -1) {
	    				CSV = CSV + row.doc.Muscles_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Cerveau_formol') > -1) {
	    				CSV = CSV + row.doc.Cerveau_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Cerveau_RNAl') > -1) {
	    				CSV = CSV + row.doc.Cerveau_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Autre') > -1) {
	    				CSV = CSV + row.doc.Autre + ";"
	    			};
	    			if (array_selected_fields.indexOf('Autre_formol') > -1) {
	    				CSV = CSV + row.doc.Autre_formol + ";"
	    			};
	    			if (array_selected_fields.indexOf('Autre_RNAl') > -1) {
	    				CSV = CSV + row.doc.Autre_RNAl + ";"
	    			};
	    			if (array_selected_fields.indexOf('Remarques_echantillons') > -1) {
	    				CSV = CSV + row.doc.Remarques_echantillons.split(';').join(',') + ";"
	    			};
	    			if (array_selected_fields.indexOf('Username') > -1) {
	    				CSV = CSV + Username + ";"
	    			};
	    			if (array_selected_fields.indexOf('Filet_temps') > -1) {
	    				CSV = CSV + Filet_temps + ";"
	    			};
	    			if (array_selected_fields.indexOf('Arret_Capture') > -1) {
	    				CSV = CSV + Arret_Capture + ";"
	    			};
	    			CSV = CSV + "\r\n";
	   			}
  				count--
  				console.log(count);
    					
    			if (count == 0) {
    	   			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
   		       		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
   		   		}
    				
   			}
   		}
    				
    		
    	
    	
    	function addChauves_souris_capturees_selected_heading() {
    		CSV = '';
    		if (array_selected_fields.indexOf('N_identification_CS') > -1) {
				CSV = CSV + 'N_identification_CS;'
			};
			if (array_selected_fields.indexOf('N_identification_mere') > -1) {
				CSV = CSV + 'N_identification_mere;'
			};
			if (array_selected_fields.indexOf('Numero_mission') > -1) {
				CSV = CSV + 'Numero_mission;'
			};
			if (array_selected_fields.indexOf('N_site') > -1) {
				CSV = CSV + 'N_site;'
			};
			if (array_selected_fields.indexOf('Date') > -1) {
				CSV = CSV + 'Date;'
			};
			if (array_selected_fields.indexOf('Equipe') > -1) {
				CSV = CSV + 'Equipe;'
			};
			if (array_selected_fields.indexOf('Pays') > -1) {
				CSV = CSV + 'Pays;'
			};
			if (array_selected_fields.indexOf('Region_capture') > -1) {
				CSV = CSV + 'Region_capture;'
			};
			if (array_selected_fields.indexOf('Site_capture') > -1) {
				CSV = CSV + 'Site_capture;'
			};
			if (array_selected_fields.indexOf('Lieu_capture') > -1) {
				CSV = CSV + 'Lieu_capture;'
			};
			if (array_selected_fields.indexOf('Environnement') > -1) {
				CSV = CSV + 'Environnement;'
			};
			if (array_selected_fields.indexOf('Latitude') > -1) {
				CSV = CSV + 'Latitude;'
			};
			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
				CSV = CSV + 'Lat_degre_dec;'
			};
			if (array_selected_fields.indexOf('Longitude') > -1) {
				CSV = CSV + 'Longitude;'
			};
			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
				CSV = CSV + 'Long_degre_dec;'
			};
			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
				CSV = CSV + 'Proximite_village_km;'
			};
			if (array_selected_fields.indexOf('Methode_capture') > -1) {
				CSV = CSV + 'Methode_capture;'
			};
			if (array_selected_fields.indexOf('NumFilet') > -1) {
				CSV = CSV + 'NumFilet;'
			};
			if (array_selected_fields.indexOf('LongueurFilet') > -1) {
				CSV = CSV + 'LongueurFilet;'
			};
			if (array_selected_fields.indexOf('HauteurFilet') > -1) {
				CSV = CSV + 'HauteurFilet;'
			};
			if (array_selected_fields.indexOf('Lat_degre_decFilet') > -1) {
				CSV = CSV + 'Lat_degre_decFilet;'
			};
			if (array_selected_fields.indexOf('LatitudeFilet') > -1) {
				CSV = CSV + 'LatitudeFilet;'
			};
			if (array_selected_fields.indexOf('Long_degre_decFilet') > -1) {
				CSV = CSV + 'Long_degre_decFilet;'
			};
			if (array_selected_fields.indexOf('LongitudeFilet') > -1) {
				CSV = CSV + 'LongitudeFilet;'
			};
			if (array_selected_fields.indexOf('Lat_degre_dec_Lieu_capture') > -1) {
				CSV = CSV + 'Lat_degre_dec_Lieu_capture;'
			};
			if (array_selected_fields.indexOf('Latitude_Lieu_capture') > -1) {
				CSV = CSV + 'Latitude_Lieu_capture;'
			};
			if (array_selected_fields.indexOf('Long_degre_dec_Lieu_capture') > -1) {
				CSV = CSV + 'Long_degre_dec_Lieu_capture;'
			};
			if (array_selected_fields.indexOf('Longitude_Lieu_capture') > -1) {
				CSV = CSV + 'Longitude_Lieu_capture;'
			};
			if (array_selected_fields.indexOf('Type_chauve_souris') > -1) {
				CSV = CSV + 'Type_chauve_souris;'
			};
			if (array_selected_fields.indexOf('Espece_identifiee') > -1) {
				CSV = CSV + 'Espece_identifiee;'
			};
			if (array_selected_fields.indexOf('Famille_terrain') > -1) {
				CSV = CSV + 'Famille_terrain;'
			};
    		if (array_selected_fields.indexOf('Genre_terrain') > -1) {
				CSV = CSV + 'Genre_terrain;'
			};
			if (array_selected_fields.indexOf('Espece_terrain') > -1) {
				CSV = CSV + 'Espece_terrain;'
			};
			if (array_selected_fields.indexOf('Famille_labo') > -1) {
				CSV = CSV + 'Famille_labo;'
			};
			if (array_selected_fields.indexOf('Genre_labo') > -1) {
				CSV = CSV + 'Genre_labo;'
			};
			if (array_selected_fields.indexOf('Espece_labo') > -1) {
				CSV = CSV + 'Espece_labo;'
			};
			if (array_selected_fields.indexOf('Famille_consensus') > -1) {
				CSV = CSV + 'Famille_consensus;'
			};
			if (array_selected_fields.indexOf('Genre_consensus') > -1) {
				CSV = CSV + 'Genre_consensus;'
			};
			if (array_selected_fields.indexOf('Espece_consensus') > -1) {
				CSV = CSV + 'Espece_consensus;'
			};
			if (array_selected_fields.indexOf('Sexe') > -1) {
				CSV = CSV + 'Sexe;'
			};
			if (array_selected_fields.indexOf('Age') > -1) {
				CSV = CSV + 'Age;'
			};
			if (array_selected_fields.indexOf('Gestante') > -1) {
				CSV = CSV + 'Gestante;'
			};
			if (array_selected_fields.indexOf('Lactation') > -1) {
				CSV = CSV + 'Lactation;'
			};
			if (array_selected_fields.indexOf('Suitee') > -1) {
				CSV = CSV + 'Suitee;'
			};
			if (array_selected_fields.indexOf('Sexe_enfant') > -1) {
				CSV = CSV + 'Sexe_enfant;'
			};
			if (array_selected_fields.indexOf('Poids_enfant') > -1) {
				CSV = CSV + 'Poids_enfant;'
			};
			if (array_selected_fields.indexOf('Identifiant_enfant') > -1) {
				CSV = CSV + 'Identifiant_enfant;'
			};
			if (array_selected_fields.indexOf('Vivante') > -1) {
				CSV = CSV + 'Vivante;'
			};
			if (array_selected_fields.indexOf('Cause_deces') > -1) {
				CSV = CSV + 'Cause_deces;'
			};
			if (array_selected_fields.indexOf('Poids_gr') > -1) {
				CSV = CSV + 'Poids_gr;'
			};
			if (array_selected_fields.indexOf('L_avant_bras_mm') > -1) {
				CSV = CSV + 'L_avant_bras_mm;'
			};
			if (array_selected_fields.indexOf('L_totale_corps_mm') > -1) {
				CSV = CSV + 'L_totale_corps_mm;'
			};
    		if (array_selected_fields.indexOf('Taille_yeux') > -1) {
				CSV = CSV + 'Taille_yeux;'
			};
			if (array_selected_fields.indexOf('L_queue_mm') > -1) {
				CSV = CSV + 'L_queue_mm;'
			};
			if (array_selected_fields.indexOf('L_metacarpe_3ieme_doigt_mm') > -1) {
				CSV = CSV + 'L_metacarpe_3ieme_doigt_mm;'
			};
			if (array_selected_fields.indexOf('Couleur_pelage_dorsal') > -1) {
				CSV = CSV + 'Couleur_pelage_dorsal;'
			};
			if (array_selected_fields.indexOf('Couleur_pelage_ventral') > -1) {
				CSV = CSV + 'Couleur_pelage_ventral;'
			};
			if (array_selected_fields.indexOf('Remarques_anomalies') > -1) {
				CSV = CSV + 'Remarques_anomalies;'
			};
			if (array_selected_fields.indexOf('Sang_DBS_nb_cercles') > -1) {
				CSV = CSV + 'Sang_DBS_nb_cercles;'
			};
			if (array_selected_fields.indexOf('Sang_tube_EDTA') > -1) {
				CSV = CSV + 'Sang_tube_EDTA;'
			};
			if (array_selected_fields.indexOf('Feces_RNAl') > -1) {
				CSV = CSV + 'Feces_RNAl;'
			};
			if (array_selected_fields.indexOf('Urine') > -1) {
				CSV = CSV + 'Urine;'
			};
			if (array_selected_fields.indexOf('Urine_DUS_nombre_cercles') > -1) {
				CSV = CSV + 'Urine_DUS_nombre_cercles;'
			};
			if (array_selected_fields.indexOf('Feces_urine_RNAl') > -1) {
				CSV = CSV + 'Feces_urine_RNAl;'
			};
			if (array_selected_fields.indexOf('Ecouvillon_gorge_RNAl') > -1) {
				CSV = CSV + 'Ecouvillon_gorge_RNAl;'
			};
			if (array_selected_fields.indexOf('Ecouvillon_rectal_RNAl') > -1) {
				CSV = CSV + 'Ecouvillon_rectal_RNAl;'
			};
			if (array_selected_fields.indexOf('Ectoparasites_ethanol') > -1) {
				CSV = CSV + 'Ectoparasites_ethanol;'
			};
			if (array_selected_fields.indexOf('Poils_ethanol') > -1) {
				CSV = CSV + 'Poils_ethanol;'
			};
			if (array_selected_fields.indexOf('Wing_punch_ethanol') > -1) {
				CSV = CSV + 'Wing_punch_ethanol;'
			};
			if (array_selected_fields.indexOf('Feces_culture_glycerol') > -1) {
				CSV = CSV + 'Feces_culture_glycerol;'
			};
			if (array_selected_fields.indexOf('Feces_ethanol') > -1) {
				CSV = CSV + 'Feces_ethanol';
			};			
			if (array_selected_fields.indexOf('Sperme') > -1) {
				CSV = CSV + 'Sperme;'
			};
			if (array_selected_fields.indexOf('Lait') > -1) {
				CSV = CSV + 'Lait;'
			};
			if (array_selected_fields.indexOf('Autres_echantillons_remarques') > -1) {
				CSV = CSV + 'Autres_echantillons_remarques;'
			};
			if (array_selected_fields.indexOf('Specimen_entier') > -1) {
				CSV = CSV + 'Specimen_entier;'
			};
    		if (array_selected_fields.indexOf('Specimen_preserve_dans') > -1) {
				CSV = CSV + 'Specimen_preserve_dans;'
			};
			if (array_selected_fields.indexOf('Prelevement_organe') > -1) {
				CSV = CSV + 'Prelevement_organe;'
			};
			if (array_selected_fields.indexOf('Foie_formol') > -1) {
				CSV = CSV + 'Foie_formol;'
			};
			if (array_selected_fields.indexOf('Foie_RNAl') > -1) {
				CSV = CSV + 'Foie_RNAl;'
			};
			if (array_selected_fields.indexOf('Rate_formol') > -1) {
				CSV = CSV + 'Rate_formol;'
			};
			if (array_selected_fields.indexOf('Rate_RNAl') > -1) {
				CSV = CSV + 'Rate_RNAl;'
			};
			if (array_selected_fields.indexOf('Reins_formol') > -1) {
				CSV = CSV + 'Reins_formol;'
			};
			if (array_selected_fields.indexOf('Reins_RNAl') > -1) {
				CSV = CSV + 'Reins_RNAl;'
			};
			if (array_selected_fields.indexOf('Intestins_formol') > -1) {
				CSV = CSV + 'Intestins_formol;'
			};
			if (array_selected_fields.indexOf('Intestins_RNAl') > -1) {
				CSV = CSV + 'Intestins_RNAl;'
			};
			if (array_selected_fields.indexOf('Poumons_formol') > -1) {
				CSV = CSV + 'Poumons_formol;'
			};
			if (array_selected_fields.indexOf('Poumons_RNAl') > -1) {
				CSV = CSV + 'Poumons_RNAl;'
			};
			if (array_selected_fields.indexOf('Coeur_formol') > -1) {
				CSV = CSV + 'Coeur_formol;'
			};
			if (array_selected_fields.indexOf('Coeur_RNAl') > -1) {
				CSV = CSV + 'Coeur_RNAl;'
			};
			if (array_selected_fields.indexOf('Ggl_lymph_formol') > -1) {
				CSV = CSV + 'Ggl_lymph_formol;'
			};
			if (array_selected_fields.indexOf('Ggl_lymph_RNAl') > -1) {
				CSV = CSV + 'Ggl_lymph_RNAl;'
			};
			if (array_selected_fields.indexOf('Testicules_formol') > -1) {
				CSV = CSV + 'Testicules_formol;'
			};
			if (array_selected_fields.indexOf('Testicules_RNAl') > -1) {
				CSV = CSV + 'Testicules_RNAl;'
			};
			if (array_selected_fields.indexOf('Peau_formol') > -1) {
				CSV = CSV + 'Peau_formol;'
			};
			if (array_selected_fields.indexOf('Peau_RNAl') > -1) {
				CSV = CSV + 'Peau_RNAl;'
			};
			if (array_selected_fields.indexOf('Muscles_formol') > -1) {
				CSV = CSV + 'Muscles_formol;'
			};
			if (array_selected_fields.indexOf('Muscles_RNAl') > -1) {
				CSV = CSV + 'Muscles_RNAl;'
			};
			if (array_selected_fields.indexOf('Cerveau_formol') > -1) {
				CSV = CSV + 'Cerveau_formol;'
			};
			if (array_selected_fields.indexOf('Cerveau_RNAl') > -1) {
				CSV = CSV + 'Cerveau_RNAl;'
			};
			if (array_selected_fields.indexOf('Autre') > -1) {
				CSV = CSV + 'Autre;'
			};
			if (array_selected_fields.indexOf('Autre_formol') > -1) {
				CSV = CSV + 'Autre_formol;'
			};
			if (array_selected_fields.indexOf('Autre_RNAl') > -1) {
				CSV = CSV + 'Autre_RNAl;'
			};
			if (array_selected_fields.indexOf('Remarques_echantillons') > -1) {
				CSV = CSV + 'Remarques_echantillons;'
			};
			if (array_selected_fields.indexOf('Username') > -1) {
				CSV = CSV + 'Username;'
			};
			if (array_selected_fields.indexOf('Filet_temps') > -1) {
				CSV = CSV + 'Filet_temps;'
			};
			if (array_selected_fields.indexOf('Arret_Capture') > -1) {
				CSV = CSV + 'Arret_Capture;'
			};
			CSV = CSV + "\r\n";
    	}
    	
		function addChauves_souris_capturees_selected(row) {
			if (count > 0) {
	    		
				/*var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};*/
    			
    			if (row.doc.N_site == null) {
    				console.log(row.doc.N_identification_CS)
    				
    				if (row.doc.Pays != null) {
    					Pays = row.doc.Pays; 
    				} else {
    					Pays = '';
					}
    				if (row.doc.Region_capture != null) {
    					Region_capture = row.doc.Region_capture;
    				} else {
    					Region_capture = '';
					}
    				if (row.doc.Site_capture != null) {
    					Site_capture = row.doc.Site_capture;
    				} else {
    					Site_capture = '';
					}
    				if (row.doc.Environnement != null) {
    					Environnement = row.doc.Environnement;
    				} else {
    					Environnement = '';
					}
    				if (row.doc.Pays != null) {
    					Latitude = row.doc.Latitude;
    				} else {
    					Latitude = '';
					}
    				if (row.doc.Lat_degre_dec != null) {
    					Lat_degre_dec = row.doc.Lat_degre_dec;
    					Lat_degre_dec = Lat_degre_dec.replace('°', '');
						Lat_degre_dec = Lat_degre_dec.replace('.', ','); 
    				} else {
    					Lat_degre_dec = '';
					}
    				if (row.doc.Longitude != null) {
    					Longitude = row.doc.Longitude;
    				} else {
    					Longitude = '';
					}
    				if (row.doc.Long_degre_dec != null) {
    					Long_degre_dec = row.doc.Long_degre_dec;
						Long_degre_dec = Long_degre_dec.replace('°', '');
    					Long_degre_dec = Long_degre_dec.replace('.', ',');
    				} else {
    					Long_degre_dec = '';
					}
    				if (row.doc.Proximite_village_km != null) {
    					Proximite_village_km = row.doc.Proximite_village_km;
    					Proximite_village_km = Proximite_village_km.replace('.', ',');
    				} else {
    					Proximite_village_km = '';
					}
    				
    				
    			}
    			
    			if (row.doc.N_site != null) {
    				console.log(row.doc.N_identification_CS)
	    			var N_site = row.doc.N_site;
	    			
	    			var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
	    			
	    			var site = JSON.stringify(res);
	    			
	    			var obj_site = JSON.parse(site);
	    			
	    			obj_site.forEach(function(row){
	    				Pays = row.Pays;
	    				Region_capture = row.Region_capture;
	    				Site_capture = row.Site_capture;
	    				Environnement = row.Environnement;
    					Latitude = row.Latitude;
    					Lat_degre_dec = row.Lat_degre_dec;
    					Lat_degre_dec = Lat_degre_dec.replace('°', '');
    					Lat_degre_dec = Lat_degre_dec.replace('.', ',');
    					Longitude = row.Longitude;
    					Long_degre_dec = row.Long_degre_dec;
    					Long_degre_dec = Long_degre_dec.replace('°', '');
    					Long_degre_dec = Long_degre_dec.replace('.', ',');
    					Proximite_village_km = row.Proximite_village_km;
    					Proximite_village_km = Proximite_village_km.replace('.', ',')
    					NbSite = row.NbSite;
	    			});
	    		}
	    			
    			LongueurFilet = '';
				HauteurFilet = '';
				Lat_degre_decFilet = '';
				LatitudeFilet = '';
				Long_degre_decFilet = '';
				LongitudeFilet = '';
				
				var Filet_temps = '';
				var Arret_Capture = '';
				var Feces_ethanol = '0';
				var Lait = '0';
				var Username = '';
				
				if (row.doc.NumFilet != null) {
					var NumFilet = row.doc.NumFilet;
						
					var res = alasql('SELECT NumFilet, LongueurFilet, HauteurFilet, Lat_degre_decFilet, LatitudeFilet, Long_degre_decFilet, LongitudeFilet FROM ? WHERE NumFilet == "' + NumFilet + '"' + ' GROUP BY NumFilet, LongueurFilet, HauteurFilet, Lat_degre_decFilet, LatitudeFilet, Long_degre_decFilet, LongitudeFilet', [tabFilet] );
						
					var filet = JSON.stringify(res);
						
					var obj_filet = JSON.parse(filet);
						
					obj_filet.forEach(function(row){
						if (row.LongueurFilet != null) {
							LongueurFilet = row.LongueurFilet;
							LongueurFilet = LongueurFilet.replace('.', ',');
						} else {
							LongueurFilet = '';
						}
						if (row.HauteurFilet != null) {
							HauteurFilet = row.HauteurFilet;
							HauteurFilet = HauteurFilet.replace('.', ',');
						} else {
							HauteurFilet = '';
						}
						if (row.Lat_degre_decFilet != null) {
							Lat_degre_decFilet = row.Lat_degre_decFilet;
							Lat_degre_decFilet = Lat_degre_decFilet.replace('.', ',');
						} else {
							Lat_degre_decFilet = '';
						}
						if (row.LatitudeFilet != null) {
							LatitudeFilet = row.LatitudeFilet;
						} else {
							LatitudeFilet = '';
						}
						if (row.Long_degre_decFilet != null) {
							Long_degre_decFilet = row.Long_degre_decFilet;
							Long_degre_decFilet = Long_degre_decFilet.replace('.', ',');
						} else {
							Long_degre_decFilet = '';
						}
						if (row.LongitudeFilet != null) {
							LongitudeFilet = row.LongitudeFilet;
						} else {
							LongitudeFilet = '';
						}
					});
				}	
				
				var Filet_temps = '';
				var Arret_Capture = '';
				
				var id;
				try {
					if (row.doc.N_identification_CS.charAt(row.doc.N_identification_CS.length - 1) == 'D') {
						id = Number(extraireNombre(row.doc.N_identification_CS)) + .1;
						//alert(id);
						idD = true;
					} else {
	   					id = Number(extraireNombre(row.doc.N_identification_CS));
	   					idD = false;
		   			}
				} catch (err) {
					alert('ERROR');
				}
   				
				if (idD && ((id - 0.1) % 2) == 0) {
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id + ' AND (Pairs_impairs == "Pairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ') GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				} else if (idD && ((id - 0.1) % 2)!= 0) {
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id  + ' AND (Pairs_impairs == "Impairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ')  GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				} else if ((id % 2) == 0) {
					//alert(id + '-> Pair')
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id + ' AND (Pairs_impairs == "Pairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ')  GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				} else {
					//alert(id + '-> Impair')
					var res = alasql('SELECT ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture FROM ? WHERE (ID_CS_preleve_debut <= ' + id + ' AND ID_CS_preleve_fin >= ' + id  + ' AND (Pairs_impairs == "Impairs" OR Pairs_impairs == "Les deux")) OR (Avec_ID_1 == ' + id + ') OR (Avec_ID_2 == ' + id + ') OR (Avec_ID_3 == ' + id + ')  GROUP BY ID_CS_preleve_debut, ID_CS_preleve_fin, Pairs_impairs, Sans_ID_1, Sans_ID_2, Sans_ID_3, Avec_ID_1, Avec_ID_2, Avec_ID_3, Filet_temps, Arret_Capture', [tabDonneesJournalieres] );
				}
				
				try {
					var donneesJournaliere = JSON.stringify(res);
					
					var obj_donneesJournaliere = JSON.parse(donneesJournaliere);
					
					obj_donneesJournaliere.forEach(function(row){
						if ((id.toString().charAt(id.toString().length - 1) == '1') 
							&& (id.toString().charAt(id.toString().length - 2) == '.')) {
							//alert('debut = ' + row.ID_CS_preleve_debut);
							//alert('fin = ' + row.ID_CS_preleve_fin);
						}
						
						if  ((row.Sans_ID_1 == '') && (row.Sans_ID_2 == '') && (row.Sans_ID_3 == '')) {
							try {
								Filet_temps = row.Filet_temps;
							} catch  (err) {
								Filet_temps = '';
							}
							try {
								Arret_Capture = row.Arret_Capture;
							} catch (err) {
								Arret_Capture = 'Non';
							}
						}
						else if ((row.ID_CS_preleve_debut != '') && (row.ID_CS_preleve_fin != '')) {
							if ((row.ID_CS_preleve_debut != null) && (row.ID_CS_preleve_fin != null) 
								 && (row.Sans_ID_1 != id)
								 && (row.Sans_ID_2 != id) 
								 && (row.Sans_ID_3 != id) ){
								try {
									Filet_temps = row.Filet_temps;
								} catch  (err) {
									Filet_temps = '';
								}
								try {
									Arret_Capture = row.Arret_Capture;
								} catch (err) {
									Arret_Capture = 'Non';
								}
								
							}
						}
		   				
					});
				} catch (err) {
				
				}	
					/*var Arret_Capture;
					if (row.doc.Arret_Capture == null) {
						Arret_Capture = ''
					} else {
						Arret_Capture = row.doc.Arret_Capture;
					}
					var Causes_Arret_Capture;
					if ((row.doc.Causes_Arret_Capture == null) || (row.doc.Causes_Arret_Capture == 'undefined')) {
						Causes_Arret_Capture = ''
					} else {
						Causes_Arret_Capture = row.doc.Causes_Arret_Capture;
					}*/
					var Feces_ethanol;
					if ((row.doc.Feces_ethanol == null) || (row.doc.Feces_ethanol == 'undefined')) {
						Feces_ethanol = '0'
					} else {
						Feces_ethanol = row.doc.Feces_ethanol;
					}
					var Lait;
					if ((row.doc.Lait == null) || (row.doc.Lait == 'undefined') || (row.doc.Lait == '')) {
						Lait = '0'
					} else {
						Lait = row.doc.Lait;
					}
					var Username;
					if ((row.doc.Username == null) || (row.doc.Username == 'undefined')) {
						Username = ''
					} else {
						Username = row.doc.Username;
					}
	    			
    				if (NbSite > 0) {
    			
    			/*if (localStorage.getItem('web') === 'oui') {
    				var remote_couchdb = localStorage.getItem('remote_couchdb');
    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
    			} else {
    				var DB_Site = new PouchDB('site' + nom_table + debug);
    			};
    			
    			var N_site = row.doc.N_site;
    			
    			DB_Site.find({
    		       	selector: {N_site: N_site}
    			}).then(function (result) {
    				if (result.docs.length > 0) {*/
				
		    			if (array_selected_fields.indexOf('N_identification_CS') > -1) {
		    				CSV = CSV + row.doc.N_identification_CS + ";" 
						};
		    			if (array_selected_fields.indexOf('N_identification_mere') > -1) {
		    				CSV = CSV + row.doc.N_identification_mere + ";"
		    			};
		    			if (array_selected_fields.indexOf('Numero_mission') > -1) {
		    				CSV = CSV + row.doc.Numero_mission + ";"
		    			};
		    			if (array_selected_fields.indexOf('N_site') > -1) {
		    				CSV = CSV + row.doc.N_site + ";"
		    			};
		    			if (array_selected_fields.indexOf('Date') > -1) {
		    				CSV = CSV + row.doc.Date + ";"
		    			};
		    			if (array_selected_fields.indexOf('Equipe') > -1) {
		    				CSV = CSV + row.doc.Equipe + ";"
		    			};
		    			if (array_selected_fields.indexOf('Pays') > -1) {
		    				CSV = CSV + Pays + ";"
		    			};
		    			if (array_selected_fields.indexOf('Region_capture') > -1) {
		    				CSV = CSV + Region_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Site_capture') > -1) {
		    				CSV = CSV + Site_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Environnement') > -1) {
		    				CSV = CSV + Environnement + ";"
		    			};
		    			if (array_selected_fields.indexOf('Latitude') > -1) {
		    				CSV = CSV + Latitude + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
		    				CSV = CSV + Lat_degre_dec + ";"
		    			};
		    			if (array_selected_fields.indexOf('Longitude') > -1) {
		    				CSV = CSV + Longitude + ";"
		    			};
		    			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
		    				CSV = CSV + Long_degre_dec + ";"
		    			};
		    			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
		    				CSV = CSV + Proximite_village_km + ";"
		    			};
		    			if (array_selected_fields.indexOf('Methode_capture') > -1) {
		    				CSV = CSV + row.doc.Methode_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('NumFilet') > -1) {
		    				CSV = CSV + row.doc.NumFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('LongueurFilet') > -1) {
		    				CSV = CSV + LongueurFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('HauteurFilet') > -1) {
		    				CSV = CSV + HauteurFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lat_degre_decFilet') > -1) {
		    				CSV = CSV + Lat_degre_decFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('LatitudeFilet') > -1) {
		    				CSV = CSV + LatitudeFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('Long_degre_decFilet') > -1) {
		    				CSV = CSV + Long_degre_decFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('LongitudeFilet') > -1) {
		    				CSV = CSV + LongitudeFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lat_degre_dec_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Lat_degre_dec_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Latitude_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Latitude_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Long_degre_dec_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Long_degre_dec_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Longitude_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Longitude_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Type_chauve_souris') > -1) {
		    				CSV = CSV + row.doc.Type_chauve_souris + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_identifiee') > -1) {
		    				CSV = CSV + row.doc.Espece_identifiee + ";"
		    			};
		    			if (array_selected_fields.indexOf('Famille_terrain') > -1) {
		    				CSV = CSV + row.doc.Famille_terrain + ";"
		    			};
		        		if (array_selected_fields.indexOf('Genre_terrain') > -1) {
		    				CSV = CSV + row.doc.Genre_terrain + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_terrain') > -1) {
		    				CSV = CSV + row.doc.Espece_terrain + ";"
		    			};
		    			if (array_selected_fields.indexOf('Famille_labo') > -1) {
		    				CSV = CSV + row.doc.Famille_labo + ";"
		    			};
		    			if (array_selected_fields.indexOf('Genre_labo') > -1) {
		    				CSV = CSV + row.doc.Genre_labo + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_labo') > -1) {
		    				CSV = CSV + row.doc.Espece_labo + ";"
		    			};
		    			if (array_selected_fields.indexOf('Famille_consensus') > -1) {
		    				CSV = CSV + row.doc.Famille_consensus + ";"
		    			};
		    			if (array_selected_fields.indexOf('Genre_consensus') > -1) {
		    				CSV = CSV + row.doc.Genre_consensus + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_consensus') > -1) {
		    				CSV = CSV + row.doc.Espece_consensus + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sexe') > -1) {
		    				CSV = CSV + row.doc.Sexe + ";"
		    			};
		    			if (array_selected_fields.indexOf('Age') > -1) {
		    				CSV = CSV + row.doc.Age + ";"
		    			};
		    			if (array_selected_fields.indexOf('Gestante') > -1) {
		    				CSV = CSV + row.doc.Gestante + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lactation') > -1) {
		    				CSV = CSV + row.doc.Lactation + ";"
		    			};
		    			if (array_selected_fields.indexOf('Suitee') > -1) {
		    				CSV = CSV + row.doc.Suitee + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sexe_enfant') > -1) {
		    				CSV = CSV + row.doc.Sexe_enfant + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poids_enfant') > -1) {
		    				CSV = CSV + row.doc.Poids_enfant + ";"
		    			};
		    			if (array_selected_fields.indexOf('Identifiant_enfant') > -1) {
		    				CSV = CSV + row.doc.Identifiant_enfant + ";"
		    			};
		    			if (array_selected_fields.indexOf('Vivante') > -1) {
		    				CSV = CSV + row.doc.Vivante + ";"
		    			};
		    			if (array_selected_fields.indexOf('Cause_deces') > -1) {
		    				CSV = CSV + row.doc.Cause_deces + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poids_gr') > -1) {
		    				CSV = CSV + row.doc.Poids_gr + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_avant_bras_mm') > -1) {
		    				CSV = CSV + row.doc.L_avant_bras_mm + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_totale_corps_mm') > -1) {
		    				CSV = CSV + row.doc.L_totale_corps_mm + ";"
		    			};
		        		if (array_selected_fields.indexOf('Taille_yeux') > -1) {
		    				CSV = CSV + row.doc.Taille_yeux + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_queue_mm') > -1) {
		    				CSV = CSV + row.doc.L_queue_mm + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_metacarpe_3ieme_doigt_mm') > -1) {
		    				CSV = CSV + row.doc.L_metacarpe_3ieme_doigt_mm + ";"
		    			};
		    			if (array_selected_fields.indexOf('Couleur_pelage_dorsal') > -1) {
		    				CSV = CSV + row.doc.Couleur_pelage_dorsal + ";"
		    			};
		    			if (array_selected_fields.indexOf('Couleur_pelage_ventral') > -1) {
		    				CSV = CSV + row.doc.Couleur_pelage_ventral + ";"
		    			};
		    			if (array_selected_fields.indexOf('Remarques_anomalies') > -1) {
		    				CSV = CSV + row.doc.Remarques_anomalies.split(';').join(',') + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sang_DBS_nb_cercles') > -1) {
		    				CSV = CSV + row.doc.Sang_DBS_nb_cercles + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sang_tube_EDTA') > -1) {
		    				CSV = CSV + row.doc.Sang_tube_EDTA + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_RNAl') > -1) {
		    				CSV = CSV + row.doc.Feces_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Urine') > -1) {
		    				CSV = CSV + row.doc.Urine + ";"
		    			};
		    			if (array_selected_fields.indexOf('Urine_DUS_nombre_cercles') > -1) {
		    				CSV = CSV + row.doc.Urine_DUS_nombre_cercles + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_urine_RNAl') > -1) {
		    				CSV = CSV + row.doc.Feces_urine_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ecouvillon_gorge_RNAl') > -1) {
		    				CSV = CSV + row.doc.Ecouvillon_gorge_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ecouvillon_rectal_RNAl') > -1) {
		    				CSV = CSV + row.doc.Ecouvillon_rectal_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ectoparasites_ethanol') > -1) {
		    				CSV = CSV + row.doc.Ectoparasites_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poils_ethanol') > -1) {
		    				CSV = CSV + row.doc.Poils_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Wing_punch_ethanol') > -1) {
		    				CSV = CSV + row.doc.Wing_punch_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_culture_glycerol') > -1) {
		    				CSV = CSV + row.doc.Feces_culture_glycerol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_ethanol') > -1) {
		    				CSV = CSV + Feces_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sperme') > -1) {
		    				CSV = CSV + row.doc.Sperme + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lait') > -1) {
		    				CSV = CSV + Lait + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autres_echantillons_remarques') > -1) {
		    				CSV = CSV + row.doc.Autres_echantillons_remarques.split(';').join(',') + ";"
		    			};
		    			if (array_selected_fields.indexOf('Specimen_entier') > -1) {
		    				CSV = CSV + row.doc.Specimen_entier + ";"
		    			};
		        		if (array_selected_fields.indexOf('Specimen_preserve_dans') > -1) {
		    				CSV = CSV + row.doc.Specimen_preserve_dans + ";"
		    			};
		    			if (array_selected_fields.indexOf('Prelevement_organe') > -1) {
		    				CSV = CSV + row.doc.Prelevement_organe + ";"
		    			};
		    			if (array_selected_fields.indexOf('Foie_formol') > -1) {
		    				CSV = CSV + row.doc.Foie_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Foie_RNAl') > -1) {
		    				CSV = CSV + row.doc.Foie_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Rate_formol') > -1) {
		    				CSV = CSV + row.doc.Rate_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Rate_RNAl') > -1) {
		    				CSV = CSV + row.doc.Rate_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Reins_formol') > -1) {
		    				CSV = CSV + row.doc.Reins_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Reins_RNAl') > -1) {
		    				CSV = CSV + row.doc.Reins_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Intestins_formol') > -1) {
		    				CSV = CSV + row.doc.Intestins_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Intestins_RNAl') > -1) {
		    				CSV = CSV + row.doc.Intestins_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poumons_formol') > -1) {
		    				CSV = CSV + row.doc.Poumons_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poumons_RNAl') > -1) {
		    				CSV = CSV + row.doc.Poumons_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Coeur_formol') > -1) {
		    				CSV = CSV + row.doc.Coeur_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Coeur_RNAl') > -1) {
		    				CSV = CSV + row.doc.Coeur_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ggl_lymph_formol') > -1) {
		    				CSV = CSV + row.doc.Ggl_lymph_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ggl_lymph_RNAl') > -1) {
		    				CSV = CSV + row.doc.Ggl_lymph_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Testicules_formol') > -1) {
		    				CSV = CSV + row.doc.Testicules_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Testicules_RNAl') > -1) {
		    				CSV = CSV + row.doc.Testicules_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Peau_formol') > -1) {
		    				CSV = CSV + row.doc.Peau_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Peau_RNAl') > -1) {
		    				CSV = CSV + row.doc.Peau_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Muscles_formol') > -1) {
		    				CSV = CSV + row.doc.Muscles_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Muscles_RNAl') > -1) {
		    				CSV = CSV + row.doc.Muscles_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Cerveau_formol') > -1) {
		    				CSV = CSV + row.doc.Cerveau_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Cerveau_RNAl') > -1) {
		    				CSV = CSV + row.doc.Cerveau_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autre') > -1) {
		    				CSV = CSV + row.doc.Autre + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autre_formol') > -1) {
		    				CSV = CSV + row.doc.Autre_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autre_RNAl') > -1) {
		    				CSV = CSV + row.doc.Autre_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Remarques_echantillons') > -1) {
		    				CSV = CSV + row.doc.Remarques_echantillons.split(';').join(',') + ";"
		    			};
		    			if (array_selected_fields.indexOf('Username') > -1) {
		    				CSV = CSV + Username + ";"
		    			};
		    			if (array_selected_fields.indexOf('Filet_temps') > -1) {
		    				CSV = CSV + Filet_temps + ";"
		    			};
		    			if (array_selected_fields.indexOf('Arret_Capture') > -1) {
		    				CSV = CSV + Arret_Capture + ";"
		    			};
		    			CSV = CSV + "\r\n";
		    			
		    			count--		
						console.log(count);
						
						if (count == 0) {
			    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
			    			
				    		
				    		//saveAs(blob, "testfile1.csv");
				    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
			    		}
	    			} else {
	    				if (array_selected_fields.indexOf('N_identification_CS') > -1) {
		    				CSV = CSV + row.doc.N_identification_CS + ";" 
						};
		    			if (array_selected_fields.indexOf('N_identification_mere') > -1) {
		    				CSV = CSV + row.doc.N_identification_mere + ";"
		    			};
		    			if (array_selected_fields.indexOf('Numero_mission') > -1) {
		    				CSV = CSV + row.doc.Numero_mission + ";"
		    			};
		    			if (array_selected_fields.indexOf('N_site') > -1) {
		    				CSV = CSV + row.doc.N_site + ";"
		    			};
		    			if (array_selected_fields.indexOf('Date') > -1) {
		    				CSV = CSV + row.doc.Date + ";"
		    			};
		    			if (array_selected_fields.indexOf('Equipe') > -1) {
		    				CSV = CSV + row.doc.Equipe + ";"
		    			};
		    			if (array_selected_fields.indexOf('Pays') > -1) {
		    				CSV = CSV + row.doc.Pays + ";"
		    			};
		    			if (array_selected_fields.indexOf('Region_capture') > -1) {
		    				CSV = CSV + row.doc.Region_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Site_capture') > -1) {
		    				CSV = CSV + row.doc.Site_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Environnement') > -1) {
		    				CSV = CSV + row.doc.Environnement + ";"
		    			};
		    			if (array_selected_fields.indexOf('Latitude') > -1) {
		    				CSV = CSV + row.doc.Latitude + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
		    				CSV = CSV + row.doc.Lat_degre_dec + ";"
		    			};
		    			if (array_selected_fields.indexOf('Longitude') > -1) {
		    				CSV = CSV + row.doc.Longitude + ";"
		    			};
		    			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
		    				CSV = CSV + row.doc.Long_degre_dec + ";"
		    			};
		    			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
		    				CSV = CSV + row.doc.Proximite_village_km + ";"
		    			};
		    			if (array_selected_fields.indexOf('Methode_capture') > -1) {
		    				CSV = CSV + row.doc.Methode_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('NumFilet') > -1) {
		    				CSV = CSV + row.doc.NumFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('LongueurFilet') > -1) {
		    				CSV = CSV + LongueurFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('HauteurFilet') > -1) {
		    				CSV = CSV + HauteurFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lat_degre_decFilet') > -1) {
		    				CSV = CSV + Lat_degre_decFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('LatitudeFilet') > -1) {
		    				CSV = CSV + LatitudeFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('Long_degre_decFilet') > -1) {
		    				CSV = CSV + Long_degre_decFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('LongitudeFilet') > -1) {
		    				CSV = CSV + LongitudeFilet + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lat_degre_dec_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Lat_degre_dec_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Latitude_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Latitude_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Long_degre_dec_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Long_degre_dec_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Longitude_Lieu_capture') > -1) {
		    				CSV = CSV + row.doc.Longitude_Lieu_capture + ";"
		    			};
		    			if (array_selected_fields.indexOf('Type_chauve_souris') > -1) {
		    				CSV = CSV + row.doc.Type_chauve_souris + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_identifiee') > -1) {
		    				CSV = CSV + row.doc.Espece_identifiee + ";"
		    			};
		    			if (array_selected_fields.indexOf('Famille_terrain') > -1) {
		    				CSV = CSV + row.doc.Famille_terrain + ";"
		    			};
		        		if (array_selected_fields.indexOf('Genre_terrain') > -1) {
		    				CSV = CSV + row.doc.Genre_terrain + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_terrain') > -1) {
		    				CSV = CSV + row.doc.Espece_terrain + ";"
		    			};
		    			if (array_selected_fields.indexOf('Famille_labo') > -1) {
		    				CSV = CSV + row.doc.Famille_labo + ";"
		    			};
		    			if (array_selected_fields.indexOf('Genre_labo') > -1) {
		    				CSV = CSV + row.doc.Genre_labo + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_labo') > -1) {
		    				CSV = CSV + row.doc.Espece_labo + ";"
		    			};
		    			if (array_selected_fields.indexOf('Famille_consensus') > -1) {
		    				CSV = CSV + row.doc.Famille_consensus + ";"
		    			};
		    			if (array_selected_fields.indexOf('Genre_consensus') > -1) {
		    				CSV = CSV + row.doc.Genre_consensus + ";"
		    			};
		    			if (array_selected_fields.indexOf('Espece_consensus') > -1) {
		    				CSV = CSV + row.doc.Espece_consensus + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sexe') > -1) {
		    				CSV = CSV + row.doc.Sexe + ";"
		    			};
		    			if (array_selected_fields.indexOf('Age') > -1) {
		    				CSV = CSV + row.doc.Age + ";"
		    			};
		    			if (array_selected_fields.indexOf('Gestante') > -1) {
		    				CSV = CSV + row.doc.Gestante + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lactation') > -1) {
		    				CSV = CSV + row.doc.Lactation + ";"
		    			};
		    			if (array_selected_fields.indexOf('Suitee') > -1) {
		    				CSV = CSV + row.doc.Suitee + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sexe_enfant') > -1) {
		    				CSV = CSV + row.doc.Sexe_enfant + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poids_enfant') > -1) {
		    				CSV = CSV + row.doc.Poids_enfant + ";"
		    			};
		    			if (array_selected_fields.indexOf('Identifiant_enfant') > -1) {
		    				CSV = CSV + row.doc.Identifiant_enfant + ";"
		    			};
		    			if (array_selected_fields.indexOf('Vivante') > -1) {
		    				CSV = CSV + row.doc.Vivante + ";"
		    			};
		    			if (array_selected_fields.indexOf('Cause_deces') > -1) {
		    				CSV = CSV + row.doc.Cause_deces + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poids_gr') > -1) {
		    				CSV = CSV + row.doc.Poids_gr + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_avant_bras_mm') > -1) {
		    				CSV = CSV + row.doc.L_avant_bras_mm + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_totale_corps_mm') > -1) {
		    				CSV = CSV + row.doc.L_totale_corps_mm + ";"
		    			};
		        		if (array_selected_fields.indexOf('Taille_yeux') > -1) {
		    				CSV = CSV + row.doc.Taille_yeux + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_queue_mm') > -1) {
		    				CSV = CSV + row.doc.L_queue_mm + ";"
		    			};
		    			if (array_selected_fields.indexOf('L_metacarpe_3ieme_doigt_mm') > -1) {
		    				CSV = CSV + row.doc.L_metacarpe_3ieme_doigt_mm + ";"
		    			};
		    			if (array_selected_fields.indexOf('Couleur_pelage_dorsal') > -1) {
		    				CSV = CSV + row.doc.Couleur_pelage_dorsal + ";"
		    			};
		    			if (array_selected_fields.indexOf('Couleur_pelage_ventral') > -1) {
		    				CSV = CSV + row.doc.Couleur_pelage_ventral + ";"
		    			};
		    			if (array_selected_fields.indexOf('Remarques_anomalies') > -1) {
		    				CSV = CSV + row.doc.Remarques_anomalies.split(';').join(',') + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sang_DBS_nb_cercles') > -1) {
		    				CSV = CSV + row.doc.Sang_DBS_nb_cercles + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sang_tube_EDTA') > -1) {
		    				CSV = CSV + row.doc.Sang_tube_EDTA + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_RNAl') > -1) {
		    				CSV = CSV + row.doc.Feces_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Urine') > -1) {
		    				CSV = CSV + row.doc.Urine + ";"
		    			};
		    			if (array_selected_fields.indexOf('Urine_DUS_nombre_cercles') > -1) {
		    				CSV = CSV + row.doc.Urine_DUS_nombre_cercles + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_urine_RNAl') > -1) {
		    				CSV = CSV + row.doc.Feces_urine_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ecouvillon_gorge_RNAl') > -1) {
		    				CSV = CSV + row.doc.Ecouvillon_gorge_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ecouvillon_rectal_RNAl') > -1) {
		    				CSV = CSV + row.doc.Ecouvillon_rectal_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ectoparasites_ethanol') > -1) {
		    				CSV = CSV + row.doc.Ectoparasites_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poils_ethanol') > -1) {
		    				CSV = CSV + row.doc.Poils_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Wing_punch_ethanol') > -1) {
		    				CSV = CSV + row.doc.Wing_punch_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_culture_glycerol') > -1) {
		    				CSV = CSV + row.doc.Feces_culture_glycerol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Feces_ethanol') > -1) {
		    				CSV = CSV + Feces_ethanol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Sperme') > -1) {
		    				CSV = CSV + row.doc.Sperme + ";"
		    			};
		    			if (array_selected_fields.indexOf('Lait') > -1) {
		    				CSV = CSV + Lait + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autres_echantillons_remarques') > -1) {
		    				CSV = CSV + row.doc.Autres_echantillons_remarques.split(';').join(',') + ";"
		    			};
		    			if (array_selected_fields.indexOf('Specimen_entier') > -1) {
		    				CSV = CSV + row.doc.Specimen_entier + ";"
		    			};
		        		if (array_selected_fields.indexOf('Specimen_preserve_dans') > -1) {
		    				CSV = CSV + row.doc.Specimen_preserve_dans + ";"
		    			};
		    			if (array_selected_fields.indexOf('Prelevement_organe') > -1) {
		    				CSV = CSV + row.doc.Prelevement_organe + ";"
		    			};
		    			if (array_selected_fields.indexOf('Foie_formol') > -1) {
		    				CSV = CSV + row.doc.Foie_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Foie_RNAl') > -1) {
		    				CSV = CSV + row.doc.Foie_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Rate_formol') > -1) {
		    				CSV = CSV + row.doc.Rate_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Rate_RNAl') > -1) {
		    				CSV = CSV + row.doc.Rate_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Reins_formol') > -1) {
		    				CSV = CSV + row.doc.Reins_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Reins_RNAl') > -1) {
		    				CSV = CSV + row.doc.Reins_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Intestins_formol') > -1) {
		    				CSV = CSV + row.doc.Intestins_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Intestins_RNAl') > -1) {
		    				CSV = CSV + row.doc.Intestins_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poumons_formol') > -1) {
		    				CSV = CSV + row.doc.Poumons_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Poumons_RNAl') > -1) {
		    				CSV = CSV + row.doc.Poumons_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Coeur_formol') > -1) {
		    				CSV = CSV + row.doc.Coeur_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Coeur_RNAl') > -1) {
		    				CSV = CSV + row.doc.Coeur_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ggl_lymph_formol') > -1) {
		    				CSV = CSV + row.doc.Ggl_lymph_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Ggl_lymph_RNAl') > -1) {
		    				CSV = CSV + row.doc.Ggl_lymph_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Testicules_formol') > -1) {
		    				CSV = CSV + row.doc.Testicules_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Testicules_RNAl') > -1) {
		    				CSV = CSV + row.doc.Testicules_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Peau_formol') > -1) {
		    				CSV = CSV + row.doc.Peau_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Peau_RNAl') > -1) {
		    				CSV = CSV + row.doc.Peau_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Muscles_formol') > -1) {
		    				CSV = CSV + row.doc.Muscles_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Muscles_RNAl') > -1) {
		    				CSV = CSV + row.doc.Muscles_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Cerveau_formol') > -1) {
		    				CSV = CSV + row.doc.Cerveau_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Cerveau_RNAl') > -1) {
		    				CSV = CSV + row.doc.Cerveau_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autre') > -1) {
		    				CSV = CSV + row.doc.Autre + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autre_formol') > -1) {
		    				CSV = CSV + row.doc.Autre_formol + ";"
		    			};
		    			if (array_selected_fields.indexOf('Autre_RNAl') > -1) {
		    				CSV = CSV + row.doc.Autre_RNAl + ";"
		    			};
		    			if (array_selected_fields.indexOf('Remarques_echantillons') > -1) {
		    				CSV = CSV + row.doc.Remarques_echantillons.split(';').join(',') + ";"
		    			};
		    			if (array_selected_fields.indexOf('Username') > -1) {
		    				CSV = CSV + Username + ";"
		    			};
		    			if (array_selected_fields.indexOf('Filet_temps') > -1) {
		    				CSV = CSV + Filet_temps + ";"
		    			};
		    			if (array_selected_fields.indexOf('Arret_Capture') > -1) {
		    				CSV = CSV + Arret_Capture + ";"
		    			};
		    			CSV = CSV + "\r\n";
		    			
		    			count--		
						console.log(count);
						
						if (count == 0) {
			    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
			    			
				    		
				    		//saveAs(blob, "testfile1.csv");
				    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
			    		}
	    			//}    
    			}/*
	    		}).catch(function (err) {
			       		console.log(err);
			    });*/
			}
    		
    	};
    	
		function addChauves_souris_non_invasives(tableData, row) {
    		    		
			//alert('count = ' + count)
			
    		if (count > 0) {
	    		
    			//alert('rowcount:' + rowcount);
    			
    			tableData.rows[rowcount].doc.Echantillons.forEach(function(row1){
    			
    				/*if (localStorage.getItem('web') === 'oui') {
        				var remote_couchdb = localStorage.getItem('remote_couchdb');
        				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
        			} else {
        				var DB_Site = new PouchDB('site' + nom_table + debug);
        			};
        			
        			var N_site = row.doc.N_site;
        			
        			DB_Site.find({
        		       	selector: {N_site: N_site}
        			}).then(function (result) {
        				if (result.docs.length > 0) {*/
        					
        					
        			if (row.doc.N_site != null) {
        		    	var N_site = row.doc.N_site;
        		    			
        		    	var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
        		    			
        		    	var site = JSON.stringify(res);
        		    			
        		    	var obj_site = JSON.parse(site);
        		    			
        		    	obj_site.forEach(function(row){
        		    		Pays = row.Pays;
        		    		Region_capture = row.Region_capture;
        		    		Site_capture = row.Site_capture;
        		    		Environnement = row.Environnement;
        	    			Latitude = row.Latitude;
        	    			Lat_degre_dec = row.Lat_degre_dec;
        	    			Longitude = row.Longitude;
        	    			Long_degre_dec = row.Long_degre_dec;
        	    			Proximite_village_km = row.Proximite_village_km;
        	    			NbSite = row.NbSite;
        		    	});
        		    			
        		    	if (NbSite > 0) {
			    			CSV = CSV +
				    			row.doc.Date + ';' +	
				    			row.doc.Heure_debut + ';' +	
				    			row.doc.Heure_fin + ';' +	
				    			row.doc.N_site + ';' +
				    			row.doc.Equipe + ';' +	
				    			Pays + ';' +	
				    			Region_capture + ';' +	
				    			Site_capture + ';' +	
				    			Environnement + ';' +	
				    			row.doc.Lieu_collecte + ';' +	
				    			Lat_degre_dec + ';' +	
				    			Latitude + ';' +	
				    			Long_degre_dec + ';' +	
				    			Longitude + ';' +	
				    			row.doc.Type_site + ';' +	
				    			Proximite_village_km + ';' +	
				    			row.doc.Type_chauves_souris + ';' +	
				    			row.doc.Famille_1 + ';' +	
				    			row.doc.Genre_1 + ';' +	
				    			row.doc.Espece_1 + ';' +	
				    			row.doc.Famille_2 + ';' +	
				    			row.doc.Genre_2 + ';' +	
				    			row.doc.Espece_2 + ';' +	
				    			row.doc.Famille_3 + ';' +	
				    			row.doc.Genre_3 + ';' +	
				    			row.doc.Espece_3 + ';' +	
				    			row.doc.Remarques.replace(/\n|\r|\;/g,'') + ';' +	
				    			row1.N_identification_echantillon + ';' +	
				    			row1.Type_echantillon + ';' +	
				    			row1.Nbre_feces_par_tube + ';' +	
				    			row1.Urine_methode + ';' +	
				    			row1.Urine_papier_buvard_nbre_cercles + ";" +
				    			row.doc.Username + ";\r\n"
								
				    			count--		
								console.log(count);
				    			
				    			if (count == 0) {
					    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
					    			
						    		
						    		//saveAs(blob, "testfile1.csv");
						    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
					    		}
			    			} else {
			    				CSV = CSV +
				    			row.doc.Date + ';' +	
				    			row.doc.Heure_debut + ';' +	
				    			row.doc.Heure_fin + ';' +	
				    			row.doc.N_site + ';' +
				    			row.doc.Equipe + ';' +	
				    			row.doc.Pays + ';' +	
				    			row.doc.Region_collecte + ';' +	
				    			row.doc.Site_collecte + ';' +	
				    			row.doc.Environnement + ';' +	
				    			row.doc.Lieu_collecte + ';' +	
				    			row.doc.Lat_degre_dec + ';' +	
				    			row.doc.Latitude + ';' +	
				    			row.doc.Long_degre_dec + ';' +	
				    			row.doc.Longitude + ';' +	
				    			row.doc.Type_site + ';' +	
				    			row.doc.Proximite_village_km + ';' +	
				    			row.doc.Type_chauves_souris + ';' +	
				    			row.doc.Famille_1 + ';' +	
				    			row.doc.Genre_1 + ';' +	
				    			row.doc.Espece_1 + ';' +	
				    			row.doc.Famille_2 + ';' +	
				    			row.doc.Genre_2 + ';' +	
				    			row.doc.Espece_2 + ';' +	
				    			row.doc.Famille_3 + ';' +	
				    			row.doc.Genre_3 + ';' +	
				    			row.doc.Espece_3 + ';' +	
				    			row.doc.Remarques.replace(/\n|\r|\;/g,'') + ';' +	
				    			row1.N_identification_echantillon + ';' +	
				    			row1.Type_echantillon + ';' +	
				    			row1.Nbre_feces_par_tube + ';' +	
				    			row1.Urine_methode + ';' +	
				    			row1.Urine_papier_buvard_nbre_cercles + ";" +
				    			row.doc.Username + ";\r\n"
				    			
				    			count--		
								console.log(count);
								
				    			if (count == 0) {
					    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
					    			
						    		
						    		//saveAs(blob, "testfile1.csv");
						    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
					    		}
			    			}   
        				}
			    		/*}).catch(function (err) {
					       		console.log(err);
					    });*/
    			});	
    			
    			rowcount++;
				
    		}
    	};
    	
    	function addChauves_souris_non_invasives_selected_heading() {
    		CSV = '';
			if (array_selected_fields.indexOf('Date') > -1) {
				CSV = CSV + 'Date;'
			};
			if (array_selected_fields.indexOf('Heure_debut') > -1) {
				CSV = CSV + 'Heure_debut;'
			};
			if (array_selected_fields.indexOf('Heure_fin') > -1) {
				CSV = CSV + 'Heure_fin;'
			};
			if (array_selected_fields.indexOf('N_site') > -1) {
				CSV = CSV + 'N_site;'
			};
			if (array_selected_fields.indexOf('Equipe') > -1) {
				CSV = CSV + 'Equipe;'
			};
			if (array_selected_fields.indexOf('Pays') > -1) {
				CSV = CSV + 'Pays;'
			};
			if (array_selected_fields.indexOf('Region_collecte') > -1) {
				CSV = CSV + 'Region_collecte;'
			};
			if (array_selected_fields.indexOf('Site_collecte') > -1) {
				CSV = CSV + 'Site_collecte;'
			};
			if (array_selected_fields.indexOf('Lieu_capture') > -1) {
				CSV = CSV + 'Lieu_capture;'
			};
			if (array_selected_fields.indexOf('Environnement') > -1) {
				CSV = CSV + 'Environnement;'
			};
			if (array_selected_fields.indexOf('Lieu_collecte') > -1) {
				CSV = CSV + 'Lieu_collecte;'
			};
			if (array_selected_fields.indexOf('Latitude') > -1) {
				CSV = CSV + 'Latitude;'
			};
			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
				CSV = CSV + 'Lat_degre_dec;'
			};
			if (array_selected_fields.indexOf('Longitude') > -1) {
				CSV = CSV + 'Longitude;'
			};
			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
				CSV = CSV + 'Long_degre_dec;'
			};
			if (array_selected_fields.indexOf('Type_site') > -1) {
				CSV = CSV + 'Type_site;'
			};
			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
				CSV = CSV + 'Proximite_village_km;'
			};
			if (array_selected_fields.indexOf('Type_chauves_souris') > -1) {
				CSV = CSV + 'Type_chauves_souris;'
			};
			if (array_selected_fields.indexOf('Famille_1') > -1) {
				CSV = CSV + 'Famille_1;'
			};
    		if (array_selected_fields.indexOf('Genre_1') > -1) {
				CSV = CSV + 'Genre_1;'
			};
			if (array_selected_fields.indexOf('Espece_1') > -1) {
				CSV = CSV + 'Espece_1;'
			};
			if (array_selected_fields.indexOf('Famille_2') > -1) {
				CSV = CSV + 'Famille_2;'
			};
			if (array_selected_fields.indexOf('Genre_2') > -1) {
				CSV = CSV + 'Genre_2;'
			};
			if (array_selected_fields.indexOf('Espece_2') > -1) {
				CSV = CSV + 'Espece_2;'
			};
			if (array_selected_fields.indexOf('Famille_3') > -1) {
				CSV = CSV + 'Famille_3;'
			};
			if (array_selected_fields.indexOf('Genre_3') > -1) {
				CSV = CSV + 'Genre_3;'
			};
			if (array_selected_fields.indexOf('Espece_3') > -1) {
				CSV = CSV + 'Espece_3;'
			};
			if (array_selected_fields.indexOf('Remarques') > -1) {
				CSV = CSV + 'Remarques;'
			};
			if (array_selected_fields.indexOf('N_identification_echantillon') > -1) {
				CSV = CSV + 'N_identification_echantillon;'
			};
			if (array_selected_fields.indexOf('Type_echantillon') > -1) {
				CSV = CSV + 'Type_echantillon;'
			};
			if (array_selected_fields.indexOf('Nbre_feces_par_tube') > -1) {
				CSV = CSV + 'Nbre_feces_par_tube;'
			};
			if (array_selected_fields.indexOf('Urine_methode') > -1) {
				CSV = CSV + 'Urine_methode;'
			};
			if (array_selected_fields.indexOf('Urine_papier_buvard_nbre_cercles') > -1) {
				CSV = CSV + 'Urine_papier_buvard_nbre_cercles;'
			};
			if (array_selected_fields.indexOf('Username') > -1) {
				CSV = CSV + 'Username;'
			};
			CSV = CSV + "\r\n";
    	}
    	
		function addChauves_souris_non_invasives_selected(tableData, row) {
			
			//alert('count selected = ' + count)
			
			if (count > 0) {
	    		//test
				tableData.rows[rowcount].doc.Echantillons.forEach(function(row1){  
					
					/*if (localStorage.getItem('web') === 'oui') {
	    				var remote_couchdb = localStorage.getItem('remote_couchdb');
	    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
	    			} else {
	    				var DB_Site = new PouchDB('site' + nom_table + debug);
	    			};
	    			
	    			var N_site = row.doc.N_site;
	    			
	    			DB_Site.find({
	    		       	selector: {N_site: N_site}
	    			}).then(function (result) {
	    				if (result.docs.length > 0) {*/
	    			
	    			if (row.doc.N_site != null) {
	            	   	var N_site = row.doc.N_site;
	            	    			
	            	   	var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
	            		    			
	            	   	var site = JSON.stringify(res);
	            		    			
	            	   	var obj_site = JSON.parse(site);
	            		    			
	            	   	obj_site.forEach(function(row){
	            	   		Pays = row.Pays;
	            	   		Region_capture = row.Region_capture;
	            	   		Site_capture = row.Site_capture;
	            	   		Environnement = row.Environnement;
	            			Latitude = row.Latitude;
	            			Lat_degre_dec = row.Lat_degre_dec;
	            			Longitude = row.Longitude;
	            			Long_degre_dec = row.Long_degre_dec;
	            			Proximite_village_km = row.Proximite_village_km;
	            			NbSite = row.NbSite;
	            	   	});
	            		    			
	            	   	if (NbSite > 0) {
	    			
							if (array_selected_fields.indexOf('Date') > -1) {
								CSV = CSV + row.doc.Date + ";" 
							};
							if (array_selected_fields.indexOf('Heure_debut') > -1) {
								CSV = CSV + row.doc.Heure_debut + ";" 
							};
							if (array_selected_fields.indexOf('Heure_fin') > -1) {
								CSV = CSV + row.doc.Heure_fin + ";" 
							};
							if (array_selected_fields.indexOf('N_site') > -1) {
								CSV = CSV + row.doc.N_site + ";" 
							};
							if (array_selected_fields.indexOf('Equipe') > -1) {
								CSV = CSV + row.doc.Equipe + ";" 
							};
							if (array_selected_fields.indexOf('Pays') > -1) {
								CSV = CSV + Pays + ";" 
							};
							if (array_selected_fields.indexOf('Region_collecte') > -1) {
								CSV = CSV + Region_capture + ";" 
							};
							if (array_selected_fields.indexOf('Site_collecte') > -1) {
								CSV = CSV + Site_capture + ";" 
							};
							/*if (array_selected_fields.indexOf('Lieu_capture') > -1) {
								CSV = CSV + row.doc.Lieu_capture + ";" 
							};*/
							if (array_selected_fields.indexOf('Environnement') > -1) {
								CSV = CSV + Environnement + ";" 
							};
							if (array_selected_fields.indexOf('Lieu_collecte') > -1) {
								CSV = CSV + row.doc.Lieu_collecte + ";" 
							};
							if (array_selected_fields.indexOf('Latitude') > -1) {
								CSV = CSV + Latitude + ";" 
							};
							if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
								CSV = CSV + Lat_degre_dec + ";" 
							};
							if (array_selected_fields.indexOf('Longitude') > -1) {
								CSV = CSV + Longitude + ";" 
							};
							if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
								CSV = CSV + Long_degre_dec + ";" 
							};
							if (array_selected_fields.indexOf('Type_site') > -1) {
								CSV = CSV + row.doc.Type_site + ";" 
							};
							if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
								CSV = CSV + Proximite_village_km + ";" 
							};
							if (array_selected_fields.indexOf('Type_chauves_souris') > -1) {
								CSV = CSV + row.doc.Type_chauves_souris + ";" 
							};
							if (array_selected_fields.indexOf('Famille_1') > -1) {
								CSV = CSV + row.doc.Famille_1 + ";" 
							};
				    		if (array_selected_fields.indexOf('Genre_1') > -1) {
								CSV = CSV + row.doc.Genre_1 + ";" 
							};
							if (array_selected_fields.indexOf('Espece_1') > -1) {
								CSV = CSV + row.doc.Espece_1 + ";" 
							};
							if (array_selected_fields.indexOf('Famille_2') > -1) {
								CSV = CSV + row.doc.Famille_2 + ";" 
							};
							if (array_selected_fields.indexOf('Genre_2') > -1) {
								CSV = CSV + row.doc.Genre_2 + ";" 
							};
							if (array_selected_fields.indexOf('Espece_2') > -1) {
								CSV = CSV + row.doc.Espece_2 + ";" 
							};
							if (array_selected_fields.indexOf('Famille_3') > -1) {
								CSV = CSV + row.doc.Famille_3 + ";" 
							};
							if (array_selected_fields.indexOf('Genre_3') > -1) {
								CSV = CSV + row.doc.Genre_3 + ";" 
							};
							if (array_selected_fields.indexOf('Espece_3') > -1) {
								CSV = CSV + row.doc.Espece_3 + ";" 
							};
							if (array_selected_fields.indexOf('Remarques') > -1) {
								CSV = CSV + row.doc.Remarques + ";" 
							};
							if (array_selected_fields.indexOf('N_identification_echantillon') > -1) {
								CSV = CSV + row1.N_identification_echantillon + ";" 
							};
							if (array_selected_fields.indexOf('Type_echantillon') > -1) {
								CSV = CSV + row1.Type_echantillon + ";" 
							};
							if (array_selected_fields.indexOf('Nbre_feces_par_tube') > -1) {
								CSV = CSV + row1.Nbre_feces_par_tube + ";" 
							};
							if (array_selected_fields.indexOf('Urine_methode') > -1) {
								CSV = CSV + row1.Urine_methode + ";" 
							};
							if (array_selected_fields.indexOf('Urine_papier_buvard_nbre_cercles') > -1) {
								CSV = CSV + row1.Urine_papier_buvard_nbre_cercles + ";" 
							};
							if (array_selected_fields.indexOf('Username') > -1) {
								CSV = CSV + row.doc.Username + ";" 
							};
							CSV = CSV + "\r\n";
							//addChauves_souris_non_invasives_selected(chauves_souris_non_invasives_TablesData, row);
							
							count--		
							console.log(count);
							
			    			if (count == 0) {
				    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
				    			
					    		
					    		//saveAs(blob, "testfile1.csv");
					    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
				    		}
			    			
	    				} else {
	    					if (array_selected_fields.indexOf('Date') > -1) {
								CSV = CSV + row.doc.Date + ";" 
							};
							if (array_selected_fields.indexOf('Heure_debut') > -1) {
								CSV = CSV + row.doc.Heure_debut + ";" 
							};
							if (array_selected_fields.indexOf('Heure_fin') > -1) {
								CSV = CSV + row.doc.Heure_fin + ";" 
							};
							if (array_selected_fields.indexOf('N_site') > -1) {
								CSV = CSV + row.doc.N_site + ";" 
							};
							if (array_selected_fields.indexOf('Equipe') > -1) {
								CSV = CSV + row.doc.Equipe + ";" 
							};
							if (array_selected_fields.indexOf('Pays') > -1) {
								CSV = CSV + row.doc.Pays + ";" 
							};
							if (array_selected_fields.indexOf('Region_collecte') > -1) {
								CSV = CSV + row.doc.Region_collecte + ";" 
							};
							if (array_selected_fields.indexOf('Site_collecte') > -1) {
								CSV = CSV + row.doc.Site_collecte + ";" 
							};
							if (array_selected_fields.indexOf('Lieu_capture') > -1) {
								CSV = CSV + row.doc.Lieu_capture + ";" 
							};
							if (array_selected_fields.indexOf('Environnement') > -1) {
								CSV = CSV + row.doc.Environnement + ";" 
							};
							if (array_selected_fields.indexOf('Lieu_collecte') > -1) {
								CSV = CSV + row.doc.Lieu_collecte + ";" 
							};
							if (array_selected_fields.indexOf('Latitude') > -1) {
								CSV = CSV + row.doc.Latitude + ";" 
							};
							if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
								CSV = CSV + row.doc.Lat_degre_dec + ";" 
							};
							if (array_selected_fields.indexOf('Longitude') > -1) {
								CSV = CSV + row.doc.Longitude + ";" 
							};
							if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
								CSV = CSV + row.doc.Long_degre_dec + ";" 
							};
							if (array_selected_fields.indexOf('Type_site') > -1) {
								CSV = CSV + row.doc.Type_site + ";" 
							};
							if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
								CSV = CSV + row.doc.Proximite_village_km + ";" 
							};
							if (array_selected_fields.indexOf('Type_chauves_souris') > -1) {
								CSV = CSV + row.doc.Type_chauves_souris + ";" 
							};
							if (array_selected_fields.indexOf('Famille_1') > -1) {
								CSV = CSV + row.doc.Famille_1 + ";" 
							};
				    		if (array_selected_fields.indexOf('Genre_1') > -1) {
								CSV = CSV + row.doc.Genre_1 + ";" 
							};
							if (array_selected_fields.indexOf('Espece_1') > -1) {
								CSV = CSV + row.doc.Espece_1 + ";" 
							};
							if (array_selected_fields.indexOf('Famille_2') > -1) {
								CSV = CSV + row.doc.Famille_2 + ";" 
							};
							if (array_selected_fields.indexOf('Genre_2') > -1) {
								CSV = CSV + row.doc.Genre_2 + ";" 
							};
							if (array_selected_fields.indexOf('Espece_2') > -1) {
								CSV = CSV + row.doc.Espece_2 + ";" 
							};
							if (array_selected_fields.indexOf('Famille_3') > -1) {
								CSV = CSV + row.doc.Famille_3 + ";" 
							};
							if (array_selected_fields.indexOf('Genre_3') > -1) {
								CSV = CSV + row.doc.Genre_3 + ";" 
							};
							if (array_selected_fields.indexOf('Espece_3') > -1) {
								CSV = CSV + row.doc.Espece_3 + ";" 
							};
							if (array_selected_fields.indexOf('Remarques') > -1) {
								CSV = CSV + row.doc.Remarques + ";" 
							};
							if (array_selected_fields.indexOf('N_identification_echantillon') > -1) {
								CSV = CSV + row1.N_identification_echantillon + ";" 
							};
							if (array_selected_fields.indexOf('Type_echantillon') > -1) {
								CSV = CSV + row1.Type_echantillon + ";" 
							};
							if (array_selected_fields.indexOf('Nbre_feces_par_tube') > -1) {
								CSV = CSV + row1.Nbre_feces_par_tube + ";" 
							};
							if (array_selected_fields.indexOf('Urine_methode') > -1) {
								CSV = CSV + row1.Urine_methode + ";" 
							};
							if (array_selected_fields.indexOf('Urine_papier_buvard_nbre_cercles') > -1) {
								CSV = CSV + row1.Urine_papier_buvard_nbre_cercles + ";" 
							};
							if (array_selected_fields.indexOf('Username') > -1) {
								CSV = CSV + row.doc.Username + ";" 
							};
							CSV = CSV + "\r\n";
							
							count--		
							console.log(count);
							
			    			if (count == 0) {
				    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
				    			
					    		
					    		//saveAs(blob, "testfile1.csv");
					    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
				    		}
		    			}
	    			}
		    		/*}).catch(function (err) {
				       		console.log(err);
				    });*/
	    		});		
				
				rowcount++;
			}
			
    	};
    	
		function addViande_de_brousse(row) {
    		
    		if (count > 0) {
    			
    			var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};
    			
    			if (localStorage.getItem('web') === 'oui') {
    				var remote_couchdb = localStorage.getItem('remote_couchdb');
    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
    			} else {
    				var DB_Site = new PouchDB('site' + nom_table + debug);
    			};
    			
    			var N_site = row.doc.N_site;
    			
    			DB_Site.find({
    		       	selector: {N_site: N_site}
    			}).then(function (result) {
    				if (result.docs.length > 0) {
	    		
		    			CSV = CSV +
							row.doc.N_identification_echantillon + ';' +
							row.doc.N_site + ';' +
							row.doc.Date + ';' +
							result.docs[0].Pays + ';' +
							row.doc.Enqueteur + ';' +
							result.docs[0].Region_capture + ';' +
							result.docs[0].Site_capture + ';' +
							result.docs[0].Environnement + ';' +
							row.doc.Lieu_collecte + ';' +
							result.docs[0].Lat_degre_dec + ';' +
							result.docs[0].Latitude + ';' +
							result.docs[0].Long_degre_dec + ';' +
							result.docs[0].Longitude + ';' +
							result.docs[0].Proximite_village_km + ';' +
							row.doc.Preleve_chez + ';' +
							row.doc.Tue_par_chasseur + ';' +
							row.doc.Methode_chasse + ';' +
							row.doc.Nbre_pieges + ';' +
							row.doc.Distance_village + ';' +
							row.doc.Duree_de_chasse + ';' +
							row.doc.Destination + ';' +
							row.doc.Lieu_vente + ';' +
							row.doc.Prix_vente + ';' +
							row.doc.Type_animal + ';' +
							row.doc.Espece_nom_local + ';' +
							row.doc.Famille + ';' +
							row.doc.Genre + ';' +
							row.doc.Espece + ';' +
							row.doc.Sexe + ';' +
							row.doc.Age + ';' +
							row.doc.Mort_depuis + ';' +
							row.doc.Etat_carcasse_animal + ';' +
							row.doc.Decoupage_carcasse + ';' +
							row.doc.L_total_corps + ';' +
							row.doc.Poids + ';' +
							row.doc.Observations_carcasse + ';' +
							row.doc.Collecte_sang_DBS + ';' +
							row.doc.Qualite_echantillon + ';' + 
							row.doc.Endroit_prelevement + ';' +
							row.doc.Remarques_echantillon + ';' +
							row.doc.Username + ";\r\n"
						
						count--
	    				console.log(count);
	    					
	    				if (count == 0) {
	    		    		var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
	    		    			
	    			    	//saveAs(blob, "testfile1.csv");
	    			    	saveAs(blob, "ebo-sursy" + clock.now + ".csv");
	    		    	}
	    			} else {
	    				CSV = CSV +
							row.doc.N_identification_echantillon + ';' +
							row.doc.N_site + ';' +
							row.doc.Date + ';' +
							row.doc.Pays + ';' +
							row.doc.Enqueteur + ';' +
							row.doc.Region_collecte + ';' +
							row.doc.Site_collecte + ';' +
							row.doc.Environnement + ';' +
							row.doc.Lieu_collecte + ';' +
							row.doc.Lat_degre_dec + ';' +
							row.doc.Latitude + ';' +
							row.doc.Long_degre_dec + ';' +
							row.doc.Longitude + ';' +
							row.doc.Proximite_village_km + ';' + 
							row.doc.Preleve_chez + ';' +
							row.doc.Tue_par_chasseur + ';' +
							row.doc.Methode_chasse + ';' +
							row.doc.Nbre_pieges + ';' +
							row.doc.Distance_village + ';' +
							row.doc.Duree_de_chasse + ';' +
							row.doc.Destination + ';' +
							row.doc.Lieu_vente + ';' +
							row.doc.Prix_vente + ';' +
							row.doc.Type_animal + ';' +
							row.doc.Espece_nom_local + ';' +
							row.doc.Famille + ';' +
							row.doc.Genre + ';' +
							row.doc.Espece + ';' +
							row.doc.Sexe + ';' +
							row.doc.Age + ';' +
							row.doc.Mort_depuis + ';' +
							row.doc.Etat_carcasse_animal + ';' +
							row.doc.Decoupage_carcasse + ';' +
							row.doc.L_total_corps + ';' +
							row.doc.Poids + ';' +
							row.doc.Observations_carcasse + ';' +
							row.doc.Collecte_sang_DBS + ';' +
							row.doc.Qualite_echantillon + ';' + 
							row.doc.Endroit_prelevement + ';' +
							row.doc.Remarques_echantillon + ';' +
							row.doc.Username + ";\r\n"
						
						count--
	    				console.log(count);
	    					
	    				if (count == 0) {
	    		    		var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
	    		    			
	    			    	//saveAs(blob, "testfile1.csv");
	    			    	saveAs(blob, "ebo-sursy" + clock.now + ".csv");
	    		    	}
		    		
		    		}
				
				}).catch(function (err) {
	    			console.log(err);
	    		});
    		}
    	};
    	
    	function addViandes_de_brousse_selected_heading() {
    		CSV = '';
    		if (array_selected_fields.indexOf('N_identification_echantillon') > -1) {
				CSV = CSV + 'N_identification_echantillon;'
			};
			if (array_selected_fields.indexOf('N_site') > -1) {
				CSV = CSV + 'N_site;'
			};
			if (array_selected_fields.indexOf('Date') > -1) {
				CSV = CSV + 'Date;'
			};
			if (array_selected_fields.indexOf('Pays') > -1) {
				CSV = CSV + 'Pays;'
			};
			if (array_selected_fields.indexOf('Enqueteur') > -1) {
				CSV = CSV + 'Enqueteur;'
			};
			if (array_selected_fields.indexOf('Region_collecte') > -1) {
				CSV = CSV + 'Region_collecte;'
			};
			if (array_selected_fields.indexOf('Site_collecte') > -1) {
				CSV = CSV + 'Site_collecte;'
			};
			if (array_selected_fields.indexOf('Environnement') > -1) {
				CSV = CSV + 'Environnement;'
			};
			if (array_selected_fields.indexOf('Lieu_collecte') > -1) {
				CSV = CSV + 'Lieu_collecte;'
			};
			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
				CSV = CSV + 'Lat_degre_dec;'
			};
			if (array_selected_fields.indexOf('Latitude') > -1) {
				CSV = CSV + 'Latitude;'
			};
			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
				CSV = CSV + 'Long_degre_dec;'
			};
			if (array_selected_fields.indexOf('Longitude') > -1) {
				CSV = CSV + 'Longitude;'
			};
			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
				CSV = CSV + 'Proximite_village_km;' 
			};
			if (array_selected_fields.indexOf('Preleve_chez') > -1) {
				CSV = CSV + 'Preleve_chez;'
			};
			if (array_selected_fields.indexOf('Tue_par_chasseur') > -1) {
				CSV = CSV + 'Tue_par_chasseur;'
			};
			if (array_selected_fields.indexOf('Methode_chasse') > -1) {
				CSV = CSV + 'Methode_chasse;'
			};
			if (array_selected_fields.indexOf('Nbre_pieges') > -1) {
				CSV = CSV + 'Nbre_pieges;'
			};
			if (array_selected_fields.indexOf('Distance_village') > -1) {
				CSV = CSV + 'Distance_village;'
			};
			if (array_selected_fields.indexOf('Duree_de_chasse') > -1) {
				CSV = CSV + 'Duree_de_chasse;'
			};
			if (array_selected_fields.indexOf('Destination') > -1) {
				CSV = CSV + 'Destination;'
			};
			if (array_selected_fields.indexOf('Lieu_vente') > -1) {
				CSV = CSV + 'Lieu_vente;'
			};
			if (array_selected_fields.indexOf('Prix_vente') > -1) {
				CSV = CSV + 'Prix_vente;'
			};
			if (array_selected_fields.indexOf('Type_animal') > -1) {
				CSV = CSV + 'Type_animal;'
			};
			if (array_selected_fields.indexOf('Espece_nom_local') > -1) {
				CSV = CSV + 'Espece_nom_local;'
			};
			if (array_selected_fields.indexOf('Famille') > -1) {
				CSV = CSV + 'Famille;'
			};
    		if (array_selected_fields.indexOf('Genre') > -1) {
				CSV = CSV + 'Genre;'
			};
			if (array_selected_fields.indexOf('Espece') > -1) {
				CSV = CSV + 'Espece;'
			};
			if (array_selected_fields.indexOf('Sexe') > -1) {
				CSV = CSV + 'Sexe;'
			};
			if (array_selected_fields.indexOf('Age') > -1) {
				CSV = CSV + 'Age;'
			};
			if (array_selected_fields.indexOf('Mort_depuis') > -1) {
				CSV = CSV + 'Mort_depuis;'
			};
			if (array_selected_fields.indexOf('Etat_carcasse_animal') > -1) {
				CSV = CSV + 'Etat_carcasse_animal;'
			};
			if (array_selected_fields.indexOf('Decoupage_carcasse') > -1) {
				CSV = CSV + 'Decoupage_carcasse;'
			};
			if (array_selected_fields.indexOf('L_total_corps') > -1) {
				CSV = CSV + 'L_total_corps;'
			};
			if (array_selected_fields.indexOf('Poids') > -1) {
				CSV = CSV + 'Poids;'
			};
			if (array_selected_fields.indexOf('Observations_carcasse') > -1) {
				CSV = CSV + 'Observations_carcasse;'
			};
			if (array_selected_fields.indexOf('Collecte_sang_DBS') > -1) {
				CSV = CSV + 'Collecte_sang_DBS;'
			};
			if (array_selected_fields.indexOf('Qualite_echantillon') > -1) {
				CSV = CSV + 'Qualite_echantillon;'
			};
			if (array_selected_fields.indexOf('Endroit_prelevement') > -1) {
				CSV = CSV + 'Endroit_prelevement;'
			};
			if (array_selected_fields.indexOf('Urine_papier_buvard_nbre_cercles') > -1) {
				CSV = CSV + 'Urine_papier_buvard_nbre_cercles;'
			};
			if (array_selected_fields.indexOf('Username') > -1) {
				CSV = CSV + 'Username;'
			};
			CSV = CSV + "\r\n";
    	}
    	
    	function addViandes_de_brousse_selected(row) {
			if (count > 0) {
				
				var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};
    			
    			if (localStorage.getItem('web') === 'oui') {
    				var remote_couchdb = localStorage.getItem('remote_couchdb');
    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
    			} else {
    				var DB_Site = new PouchDB('site' + nom_table + debug);
    			};
    			
    			var N_site = row.doc.N_site;
				
				DB_Site.find({
    		       	selector: {N_site: N_site}
    			}).then(function (result) {
    				if (result.docs.length > 0) {
		
						if (array_selected_fields.indexOf('N_identification_echantillon') > -1) {
							CSV = CSV + row.doc.N_identification_echantillon + ";" 
						};
						if (array_selected_fields.indexOf('N_site') > -1) {
							CSV = CSV + row.doc.N_site + ";" 
						};
						if (array_selected_fields.indexOf('Date') > -1) {
							CSV = CSV + row.doc.Date + ";" 
						};
						if (array_selected_fields.indexOf('Pays') > -1) {
							CSV = CSV + result.docs[0].Pays + ";" 
						};
						if (array_selected_fields.indexOf('Enqueteur') > -1) {
							CSV = CSV + row.doc.Enqueteur + ";" 
						};
						if (array_selected_fields.indexOf('Region_collecte') > -1) {
							CSV = CSV + result.docs[0].Region_capture + ";" 
						};
						if (array_selected_fields.indexOf('Site_collecte') > -1) {
							CSV = CSV + result.docs[0].Site_capture + ";" 
						};
						if (array_selected_fields.indexOf('Environnement') > -1) {
							CSV = CSV + result.docs[0].Environnement + ";" 
						};
						if (array_selected_fields.indexOf('Lieu_collecte') > -1) {
							CSV = CSV + row.doc.Lieu_collecte + ";" 
						};
						if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
							CSV = CSV + result.docs[0].Lat_degre_dec + ";" 
						};
						if (array_selected_fields.indexOf('Latitude') > -1) {
							CSV = CSV + result.docs[0].Latitude + ";" 
						};
						if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
							CSV = CSV + result.docs[0].Long_degre_dec + ";" 
						};
						if (array_selected_fields.indexOf('Longitude') > -1) {
							CSV = CSV + result.docs[0].Longitude + ";" 
						};
						if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
							CSV = CSV + result.docs[0].Proximite_village_km + ";" 
						};
						if (array_selected_fields.indexOf('Preleve_chez') > -1) {
							CSV = CSV + row.doc.Preleve_chez + ";" 
						};
						if (array_selected_fields.indexOf('Tue_par_chasseur') > -1) {
							CSV = CSV + row.doc.Tue_par_chasseur + ";" 
						};
						if (array_selected_fields.indexOf('Methode_chasse') > -1) {
							CSV = CSV + row.doc.Methode_chasse + ";" 
						};
						if (array_selected_fields.indexOf('Nbre_pieges') > -1) {
							CSV = CSV + row.doc.Nbre_pieges + ";" 
						};
						if (array_selected_fields.indexOf('Distance_village') > -1) {
							CSV = CSV + row.doc.Distance_village + ";" 
						};
						if (array_selected_fields.indexOf('Duree_de_chasse') > -1) {
							CSV = CSV + row.doc.Duree_de_chasse + ";" 
						};
						if (array_selected_fields.indexOf('Destination') > -1) {
							CSV = CSV + row.doc.Destination + ";" 
						};
						if (array_selected_fields.indexOf('Lieu_vente') > -1) {
							CSV = CSV + row.doc.Lieu_vente + ";" 
						};
						if (array_selected_fields.indexOf('Prix_vente') > -1) {
							CSV = CSV + row.doc.Prix_vente + ";" 
						};
						if (array_selected_fields.indexOf('Type_animal') > -1) {
							CSV = CSV + row.doc.Type_animal + ";" 
						};
						if (array_selected_fields.indexOf('Espece_nom_local') > -1) {
							CSV = CSV + row.doc.Espece_nom_local + ";" 
						};
						if (array_selected_fields.indexOf('Famille') > -1) {
							CSV = CSV + row.doc.Famille + ";" 
						};
			    		if (array_selected_fields.indexOf('Genre') > -1) {
							CSV = CSV + row.doc.Genre + ";" 
						};
						if (array_selected_fields.indexOf('Espece') > -1) {
							CSV = CSV + row.doc.Espece + ";" 
						};
						if (array_selected_fields.indexOf('Sexe') > -1) {
							CSV = CSV + row.doc.Sexe + ";" 
						};
						if (array_selected_fields.indexOf('Age') > -1) {
							CSV = CSV + row.doc.Age + ";" 
						};
						if (array_selected_fields.indexOf('Mort_depuis') > -1) {
							CSV = CSV + row.doc.Mort_depuis + ";" 
						};
						if (array_selected_fields.indexOf('Etat_carcasse_animal') > -1) {
							CSV = CSV + row.doc.Etat_carcasse_animal + ";" 
						};
						if (array_selected_fields.indexOf('Decoupage_carcasse') > -1) {
							CSV = CSV + row.doc.Decoupage_carcasse + ";" 
						};
						if (array_selected_fields.indexOf('L_total_corps') > -1) {
							CSV = CSV + row.doc.L_total_corps + ";" 
						};
						if (array_selected_fields.indexOf('Poids') > -1) {
							CSV = CSV + row.doc.Poids + ";" 
						};
						if (array_selected_fields.indexOf('Observations_carcasse') > -1) {
							CSV = CSV + row.doc.Observations_carcasse + ";" 
						};
						if (array_selected_fields.indexOf('Collecte_sang_DBS') > -1) {
							CSV = CSV + row.doc.Collecte_sang_DBS + ";" 
						};
						if (array_selected_fields.indexOf('Qualite_echantillon') > -1) {
							CSV = CSV + row.doc.Qualite_echantillon + ";" 
						};
						if (array_selected_fields.indexOf('Endroit_prelevement') > -1) {
							CSV = CSV + row.doc.Endroit_prelevement + ";" 
						};
						if (array_selected_fields.indexOf('Urine_papier_buvard_nbre_cercles') > -1) {
							CSV = CSV + row.doc.Urine_papier_buvard_nbre_cercles + ";" 
						};
						if (array_selected_fields.indexOf('Username') > -1) {
							CSV = CSV + row.doc.Username + ";" 
						};
						
		    			CSV = CSV + "\r\n";
		    				
		    			count--
    					console.log(count);
    					
    					if (count == 0) {
    		    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    			
    			    		
    			    		//saveAs(blob, "testfile1.csv");
    			    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    		}
    				} else {
    					if (array_selected_fields.indexOf('N_identification_echantillon') > -1) {
    						CSV = CSV + row.doc.N_identification_echantillon + ";" 
    					};
    					if (array_selected_fields.indexOf('N_site') > -1) {
    						CSV = CSV + row.doc.N_site + ";" 
    					};
    					if (array_selected_fields.indexOf('Date') > -1) {
    						CSV = CSV + row.doc.Date + ";" 
    					};
    					if (array_selected_fields.indexOf('Pays') > -1) {
    						CSV = CSV + row.doc.Pays + ";" 
    					};
    					if (array_selected_fields.indexOf('Enqueteur') > -1) {
    						CSV = CSV + row.doc.Enqueteur + ";" 
    					};
    					if (array_selected_fields.indexOf('Region_collecte') > -1) {
    						CSV = CSV + row.doc.Region_collecte + ";" 
    					};
    					if (array_selected_fields.indexOf('Site_collecte') > -1) {
    						CSV = CSV + row.doc.Site_collecte + ";" 
    					};
    					if (array_selected_fields.indexOf('Environnement') > -1) {
    						CSV = CSV + row.doc.Environnement + ";" 
    					};
    					if (array_selected_fields.indexOf('Lieu_collecte') > -1) {
    						CSV = CSV + row.doc.Lieu_collecte + ";" 
    					};
    					if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
    						CSV = CSV + row.doc.Lat_degre_dec + ";" 
    					};
    					if (array_selected_fields.indexOf('Latitude') > -1) {
    						CSV = CSV + row.doc.Latitude + ";" 
    					};
    					if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
    						CSV = CSV + row.doc.Long_degre_dec + ";" 
    					};
    					if (array_selected_fields.indexOf('Longitude') > -1) {
    						CSV = CSV + row.doc.Longitude + ";" 
    					};
    					if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
    						CSV = CSV + row.doc.Proximite_village_km + ";" 
    					};
    					if (array_selected_fields.indexOf('Preleve_chez') > -1) {
    						CSV = CSV + row.doc.Preleve_chez + ";" 
    					};
    					if (array_selected_fields.indexOf('Tue_par_chasseur') > -1) {
    						CSV = CSV + row.doc.Tue_par_chasseur + ";" 
    					};
    					if (array_selected_fields.indexOf('Methode_chasse') > -1) {
    						CSV = CSV + row.doc.Methode_chasse + ";" 
    					};
    					if (array_selected_fields.indexOf('Nbre_pieges') > -1) {
    						CSV = CSV + row.doc.Nbre_pieges + ";" 
    					};
    					if (array_selected_fields.indexOf('Distance_village') > -1) {
    						CSV = CSV + row.doc.Distance_village + ";" 
    					};
    					if (array_selected_fields.indexOf('Duree_de_chasse') > -1) {
    						CSV = CSV + row.doc.Duree_de_chasse + ";" 
    					};
    					if (array_selected_fields.indexOf('Destination') > -1) {
    						CSV = CSV + row.doc.Destination + ";" 
    					};
    					if (array_selected_fields.indexOf('Lieu_vente') > -1) {
    						CSV = CSV + row.doc.Lieu_vente + ";" 
    					};
    					if (array_selected_fields.indexOf('Prix_vente') > -1) {
    						CSV = CSV + row.doc.Prix_vente + ";" 
    					};
    					if (array_selected_fields.indexOf('Type_animal') > -1) {
    						CSV = CSV + row.doc.Type_animal + ";" 
    					};
    					if (array_selected_fields.indexOf('Espece_nom_local') > -1) {
    						CSV = CSV + row.doc.Espece_nom_local + ";" 
    					};
    					if (array_selected_fields.indexOf('Famille') > -1) {
    						CSV = CSV + row.doc.Famille + ";" 
    					};
    		    		if (array_selected_fields.indexOf('Genre') > -1) {
    						CSV = CSV + row.doc.Genre + ";" 
    					};
    					if (array_selected_fields.indexOf('Espece') > -1) {
    						CSV = CSV + row.doc.Espece + ";" 
    					};
    					if (array_selected_fields.indexOf('Sexe') > -1) {
    						CSV = CSV + row.doc.Sexe + ";" 
    					};
    					if (array_selected_fields.indexOf('Age') > -1) {
    						CSV = CSV + row.doc.Age + ";" 
    					};
    					if (array_selected_fields.indexOf('Mort_depuis') > -1) {
    						CSV = CSV + row.doc.Mort_depuis + ";" 
    					};
    					if (array_selected_fields.indexOf('Etat_carcasse_animal') > -1) {
    						CSV = CSV + row.doc.Etat_carcasse_animal + ";" 
    					};
    					if (array_selected_fields.indexOf('Decoupage_carcasse') > -1) {
    						CSV = CSV + row.doc.Decoupage_carcasse + ";" 
    					};
    					if (array_selected_fields.indexOf('L_total_corps') > -1) {
    						CSV = CSV + row.doc.L_total_corps + ";" 
    					};
    					if (array_selected_fields.indexOf('Poids') > -1) {
    						CSV = CSV + row.doc.Poids + ";" 
    					};
    					if (array_selected_fields.indexOf('Observations_carcasse') > -1) {
    						CSV = CSV + row.doc.Observations_carcasse + ";" 
    					};
    					if (array_selected_fields.indexOf('Collecte_sang_DBS') > -1) {
    						CSV = CSV + row.doc.Collecte_sang_DBS + ";" 
    					};
    					if (array_selected_fields.indexOf('Qualite_echantillon') > -1) {
    						CSV = CSV + row.doc.Qualite_echantillon + ";" 
    					};
    					if (array_selected_fields.indexOf('Endroit_prelevement') > -1) {
    						CSV = CSV + row.doc.Endroit_prelevement + ";" 
    					};
    					if (array_selected_fields.indexOf('Urine_papier_buvard_nbre_cercles') > -1) {
    						CSV = CSV + row.doc.Urine_papier_buvard_nbre_cercles + ";" 
    					};
    					if (array_selected_fields.indexOf('Username') > -1) {
    						CSV = CSV + row.doc.Username + ";" 
    					};
    					
    	    			CSV = CSV + "\r\n";
    	    				
    	    			count--
    					console.log(count);
    					
    					if (count == 0) {
    		    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    			
    			    		
    			    		//saveAs(blob, "testfile1.csv");
    			    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    		}
		    		
		    		}

					
				}).catch(function (err) {
	    			console.log(err);
	    		});
			}
    		
    	};
    	
		function addDonnees_journalieres(row) {
    		
    		if (count > 0) {   	
    			
    			var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};
    			
    			/*if (localStorage.getItem('web') === 'oui') {
    				var remote_couchdb = localStorage.getItem('remote_couchdb');
    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
    			} else {
    				var DB_Site = new PouchDB('site' + nom_table + debug);
    			};*/
    			
    			//var N_site = row.doc.N_site;
    			
    			if (row.doc.N_site != null) {
	    			var N_site = row.doc.N_site;
	    			
	    			var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
	    			
	    			var site = JSON.stringify(res);
	    			
	    			var obj_site = JSON.parse(site);
	    			
	    			obj_site.forEach(function(row){
	    				Pays = row.Pays;
	    				Region_capture = row.Region_capture;
	    				Site_capture = row.Site_capture;
	    				Environnement = row.Environnement;
    					Latitude = row.Latitude;
    					Lat_degre_dec = row.Lat_degre_dec;
    					Longitude = row.Longitude;
    					Long_degre_dec = row.Long_degre_dec;
    					Proximite_village_km = row.Proximite_village_km;
    					NbSite = row.NbSite;
	    			});
	    			
	    			if (NbSite > 0) {
    			
    			/*DB_Site.find({
    		       	selector: {N_site: N_site}
    			}).then(function (result) {
    				if (result.docs.length > 0) {*/
    			
		    			CSV = CSV +
				    			row.doc.Date + ';' +
				    			row.doc.Equipe + ';' +
				    			row.doc.ID_CS_preleve_debut + ';' +
				    			row.doc.ID_CS_preleve_fin + ';' +
				    			row.doc.N_site + ';' +
				    			Pays + ';' +
				    			Region_capture + ';' +
				    			Site_capture + ';' +
				    			Environnement + ';' +
				    			Proximite_village_km + ';' +
				    			Lat_degre_dec + ';' +
				    			Latitude + ';' +
				    			Long_degre_dec + ';' +
				    			Longitude + ';' +
				    			row.doc.Roost_diurne + ';' +
				    			row.doc.Presence_diurne  + ';';
								
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.TaxonomieDiurne[i].Famille);
										if (typeof row.doc.TaxonomieDiurne[i] !== 'undefined') {
											 
												CSV = CSV + row.doc.TaxonomieDiurne[i].Famille + ';'
													+ row.doc.TaxonomieDiurne[i].Genre + ';'
													+ row.doc.TaxonomieDiurne[i].Espece + ';'
										} else {
											CSV = CSV + ';;;';
										}
									} catch (err) {
										CSV = CSV + ';;;';
									}
								}
								
								CSV = CSV + row.doc.Methode_comptage_diurne + ';' 
										  + row.doc.Resultat_comptage_diurne_1 + ';'
										  + row.doc.Resultat_comptage_diurne_2 + ';'
										  + row.doc.Utilisation_site_nocturne + ';'
										  + row.doc.Aliment_consomme + ';'
										  + row.doc.Presence_nocturne + ';'
								
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.TaxonomieNocturne[i].Famille);
										CSV = CSV + row.doc.TaxonomieNocturne[i].Famille + ';'
											+ row.doc.TaxonomieNocturne[i].Genre + ';'
											+ row.doc.TaxonomieNocturne[i].Espece + ';'
									} catch (err) {
											CSV = CSV + ';;;';
									}
								}
										  
								CSV = CSV + row.doc.Methode_comptage_nocturne + ';' 
								          + row.doc.Resultat_comptage_nocturne_1 + ';' 
								          + row.doc.Resultat_comptage_nocturne_2 + ';'
										  + row.doc.Vocalisations + ';'  
										  + row.doc.Parade_sexuelle + ';' 
										  + row.doc.Famille_vocalisations + ';' 
										  + row.doc.Genre_vocalisations + ';' 
										  + row.doc.Espece_vocalisations + ';'
										  + row.doc.Copulations + ';'
										  + row.doc.Famille_copulations + ';' 
										  + row.doc.Genre_copulations + ';' 
										  + row.doc.Espece_copulations + ';'
										  + row.doc.Suitee + ';'
										  + row.doc.Famille_suitee + ';' 
										  + row.doc.Genre_suitee + ';'
										  + row.doc.Espece_suitee + ';'
										  + row.doc.Agressions + ';'
										  + row.doc.Famille_agressions + ';' 
										  + row.doc.Genre_agressions + ';' 
										  + row.doc.Espece_agressions + ';'
										  + row.doc.Filet_canopee_nb_7 + ';' 
										  + row.doc.Filet_canopee_m2_7 + ';'
										  
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.FiletCanopee_7[i].NumFilet);
										CSV = CSV + row.doc.FiletCanopee_7[i].NumFilet + ';'
											+ row.doc.FiletCanopee_7[i].LongueurFilet + ';'
											+ row.doc.FiletCanopee_7[i].HauteurFilet + ';'
									} catch (err) {
										CSV = CSV + ';;;';
									}
								}
										  
										  
								CSV = CSV + row.doc.Filet_canopee_nb_20 + ';' 
								  		  + row.doc.Filet_canopee_m2_20 + ';'
								  		  
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.FiletCanopee_20[i].NumFilet);
										CSV = CSV + row.doc.FiletCanopee_20[i].NumFilet + ';'
											+ row.doc.FiletCanopee_20[i].LongueurFilet + ';'
											+ row.doc.FiletCanopee_20[i].HauteurFilet + ';'
									} catch (err) {
										CSV = CSV + ';;;';
									}
								}
								  		  
								CSV = CSV + row.doc.Filet_sol_nb + ';' 
										  + row.doc.Filet_sol_m2 + ';'
										  
										  
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.FiletSol[i].NumFilet);
										CSV = CSV + row.doc.FiletSol[i].NumFilet + ';'
											+ row.doc.FiletSol[i].LongueurFilet + ';'
											+ row.doc.FiletSol[i].HauteurFilet + ';'
										} catch (err) {
											CSV = CSV + ';;;';
									}
								}	
										  
								CSV = CSV + row.doc.Filet_debut + ';'
										  + row.doc.Filet_fin + ';'
										  + row.doc.Filet_temps + ';' 
										  + row.doc.Filet_capture_nb + ';' 
										  + row.doc.Harp_debut + ';' 
										  + row.doc.Harp_fin + ';' 
										  + row.doc.Harp_temps + ';' 
										  + row.doc.Harpe_nb + ';' 
										  + row.doc.Saison + ';' 
										  + row.doc.Climat + ';' 
										  + row.doc.Autre_climat + ';' 
										  + row.doc.Precipitation + ';'
										  + row.doc.Vent + ';' 
										  + row.doc.Lune + ';' 
										  + row.doc.Temperature_logger + ';' 
										  + row.doc.Humidite_logger + ';'
										  + row.doc.Username + ";\r\n";
							
									count--
							    	console.log(count);
							    					
							    	if (count == 0) {
							    	   	var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
							    	   	//saveAs(blob, "testfile1.csv");
							    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
							    	}
    					} else {
    						CSV = CSV +
				    			row.doc.Date + ';' +
				    			row.doc.Equipe + ';' +
				    			row.doc.ID_CS_preleve_debut + ';' +
				    			row.doc.ID_CS_preleve_fin + ';' +
				    			row.doc.N_site + ';' +
				    			row.doc.Pays + ';' +
				    			row.doc.Region_capture + ';' +
				    			row.doc.Site_capture + ';' +
				    			row.doc.Environnement + ';' +
				    			row.doc.Proximite_village_km + ';' +
				    			row.doc.Lat_degre_dec + ';' +
				    			row.doc.Latitude + ';' +
				    			row.doc.Long_degre_dec + ';' +
				    			row.doc.Longitude + ';' +
				    			row.doc.Roost_diurne + ';' +
				    			row.doc.Presence_diurne  + ';';
								
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.TaxonomieDiurne[i].Famille);
										if (typeof row.doc.TaxonomieDiurne[i] !== 'undefined') {
											 
												CSV = CSV + row.doc.TaxonomieDiurne[i].Famille + ';'
													+ row.doc.TaxonomieDiurne[i].Genre + ';'
													+ row.doc.TaxonomieDiurne[i].Espece + ';'
										} else {
											CSV = CSV + ';;;';
										}
									} catch (err) {
										CSV = CSV + ';;;';
									}
								}
								
								CSV = CSV + row.doc.Methode_comptage_diurne + ';' 
										  + row.doc.Resultat_comptage_diurne_1 + ';'
										  + row.doc.Resultat_comptage_diurne_2 + ';'
										  + row.doc.Utilisation_site_nocturne + ';'
										  + row.doc.Aliment_consomme + ';'
										  + row.doc.Presence_nocturne + ';'
								
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.TaxonomieNocturne[i].Famille);
										CSV = CSV + row.doc.TaxonomieNocturne[i].Famille + ';'
											+ row.doc.TaxonomieNocturne[i].Genre + ';'
											+ row.doc.TaxonomieNocturne[i].Espece + ';'
									} catch (err) {
											CSV = CSV + ';;;';
									}
								}
										  
								CSV = CSV + row.doc.Methode_comptage_nocturne + ';' 
								          + row.doc.Resultat_comptage_nocturne_1 + ';' 
								          + row.doc.Resultat_comptage_nocturne_2 + ';'
										  + row.doc.Vocalisations + ';'  
										  + row.doc.Parade_sexuelle + ';' 
										  + row.doc.Famille_vocalisations + ';' 
										  + row.doc.Genre_vocalisations + ';' 
										  + row.doc.Espece_vocalisations + ';'
										  + row.doc.Copulations + ';'
										  + row.doc.Famille_copulations + ';' 
										  + row.doc.Genre_copulations + ';' 
										  + row.doc.Espece_copulations + ';'
										  + row.doc.Suitee + ';'
										  + row.doc.Famille_suitee + ';' 
										  + row.doc.Genre_suitee + ';'
										  + row.doc.Espece_suitee + ';'
										  + row.doc.Agressions + ';'
										  + row.doc.Famille_agressions + ';' 
										  + row.doc.Genre_agressions + ';' 
										  + row.doc.Espece_agressions + ';'
										  + row.doc.Filet_canopee_nb_7 + ';' 
										  + row.doc.Filet_canopee_m2_7 + ';'
										  
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.FiletCanopee_7[i].NumFilet);
										CSV = CSV + row.doc.FiletCanopee_7[i].NumFilet + ';'
											+ row.doc.FiletCanopee_7[i].LongueurFilet + ';'
											+ row.doc.FiletCanopee_7[i].HauteurFilet + ';'
									} catch (err) {
										CSV = CSV + ';;;';
									}
								}
										  
										  
								CSV = CSV + row.doc.Filet_canopee_nb_20 + ';' 
								  		  + row.doc.Filet_canopee_m2_20 + ';'
								  		  
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.FiletCanopee_20[i].NumFilet);
										CSV = CSV + row.doc.FiletCanopee_20[i].NumFilet + ';'
											+ row.doc.FiletCanopee_20[i].LongueurFilet + ';'
											+ row.doc.FiletCanopee_20[i].HauteurFilet + ';'
									} catch (err) {
										CSV = CSV + ';;;';
									}
								}
								  		  
								CSV = CSV + row.doc.Filet_sol_nb + ';' 
										  + row.doc.Filet_sol_m2 + ';'
										  
										  
								for (var i=0;i<7;i++) {
									try {
										console.log(row.doc.FiletSol[i].NumFilet);
										CSV = CSV + row.doc.FiletSol[i].NumFilet + ';'
											+ row.doc.FiletSol[i].LongueurFilet + ';'
											+ row.doc.FiletSol[i].HauteurFilet + ';'
										} catch (err) {
											CSV = CSV + ';;;';
									}
								}	
										  
								CSV = CSV + row.doc.Filet_debut + ';'
										  + row.doc.Filet_fin + ';'
										  + row.doc.Filet_temps + ';' 
										  + row.doc.Filet_capture_nb + ';' 
										  + row.doc.Harp_debut + ';' 
										  + row.doc.Harp_fin + ';' 
										  + row.doc.Harp_temps + ';' 
										  + row.doc.Harpe_nb + ';' 
										  + row.doc.Saison + ';' 
										  + row.doc.Climat + ';' 
										  + row.doc.Autre_climat + ';' 
										  + row.doc.Precipitation + ';'
										  + row.doc.Vent + ';' 
										  + row.doc.Lune + ';' 
										  + row.doc.Temperature_logger + ';' 
										  + row.doc.Humidite_logger + ';'
										  + row.doc.Username + ";\r\n";
							
									count--
					    			console.log(count);
					    					
					    			if (count == 0) {
					    		    	var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
					    		    	//saveAs(blob, "testfile1.csv");
					    				saveAs(blob, "ebo-sursy" + clock.now + ".csv");
					    		    }
		    					}	
							
    					}	
			    		/*}).catch(function (err) {
			    		     console.log(err);
			    		});*/
    				
    		}
    	};
    	
    	function addJournalieres_selected_heading() {
    		CSV = '';
	    		if (array_selected_fields.indexOf('Date') > -1) {
	    			CSV = CSV + 'Date;'
	    		};
	    		if (array_selected_fields.indexOf('Equipe') > -1) {
	    			CSV = CSV + 'Equipe;'
	    		};
	    		if (array_selected_fields.indexOf('ID_CS_preleve_debut') > -1) {
	    			CSV = CSV + 'ID_CS_preleve_debut;'
	    		};
	    		if (array_selected_fields.indexOf('ID_CS_preleve_fin') > -1) {
	    			CSV = CSV + 'ID_CS_preleve_fin;'
	    		};
	    		if (array_selected_fields.indexOf('N_site') > -1) {
	    			CSV = CSV + 'N_site;'
	    		};
	    		if (array_selected_fields.indexOf('Pays') > -1) {
	    			CSV = CSV + 'Pays;'
	    		};
	    		if (array_selected_fields.indexOf('Region_capture') > -1) {
	    			CSV = CSV + 'Region_capture;'
	    		};
	    		if (array_selected_fields.indexOf('Site_capture') > -1) {
	    			CSV = CSV + 'Site_capture;'
	    		};
	    		if (array_selected_fields.indexOf('Environnement') > -1) {
	    			CSV = CSV + 'Environnement;'
	    		};
	    		if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
	    			CSV = CSV + 'Proximite_village_km;'
	    		};
	    		if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
	    			CSV = CSV + 'Lat_degre_dec;'
	    		};
	    		if (array_selected_fields.indexOf('Latitude') > -1) {
	    			CSV = CSV + 'Latitude;'
	    		};
	    		if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
	    			CSV = CSV + 'Long_degre_dec;'
	    		};
	    		if (array_selected_fields.indexOf('Longitude') > -1) {
	    			CSV = CSV + 'Longitude;'
	    		};
	    		if (array_selected_fields.indexOf('Roost_diurne') > -1) {
	    			CSV = CSV + 'Roost_diurne;'
	    		};
	    		if (array_selected_fields.indexOf('Presence_diurne') > -1) {
	    			CSV = CSV + 'Presence_diurne;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne1') > -1) {
	    			CSV = CSV + 'Famille_diurne1;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne1') > -1) {
	    			CSV = CSV + 'Genre_diurne1;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne1') > -1) {
	    			CSV = CSV + 'Espece_diurne1;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne2') > -1) {
	    			CSV = CSV + 'Famille_diurne2;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne2') > -1) {
	    			CSV = CSV + 'Genre_diurne2;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne2') > -1) {
	    			CSV = CSV + 'Espece_diurne2;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne3') > -1) {
	    			CSV = CSV + 'Famille_diurne3;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne3') > -1) {
	    			CSV = CSV + 'Genre_diurne3;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne3') > -1) {
	    			CSV = CSV + 'Espece_diurne3;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne4') > -1) {
	    			CSV = CSV + 'Famille_diurne4;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne4') > -1) {
	    			CSV = CSV + 'Genre_diurne4;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne4') > -1) {
	    			CSV = CSV + 'Espece_diurne4;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne5') > -1) {
	    			CSV = CSV + 'Famille_diurne5;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne5') > -1) {
	    			CSV = CSV + 'Genre_diurne5;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne5') > -1) {
	    			CSV = CSV + 'Espece_diurne5;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne6') > -1) {
	    			CSV = CSV + 'Famille_diurne6;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne6') > -1) {
	    			CSV = CSV + 'Genre_diurne6;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne6') > -1) {
	    			CSV = CSV + 'Espece_diurne6;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_diurne7') > -1) {
	    			CSV = CSV + 'Famille_diurne7;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_diurne7') > -1) {
	    			CSV = CSV + 'Genre_diurne7;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_diurne7') > -1) {
	    			CSV = CSV + 'Espece_diurne7;'
	    		};
	    		if (array_selected_fields.indexOf('Methode_comptage_diurne') > -1) {
	    			CSV = CSV + 'Methode_comptage_diurne;'
	    		};
	    		if (array_selected_fields.indexOf('Resultat_comptage_diurne_1') > -1) {
	    			CSV = CSV + 'Resultat_comptage_diurne_1;'
	    		};
	    		if (array_selected_fields.indexOf('Resultat_comptage_diurne_2') > -1) {
	    			CSV = CSV + 'Resultat_comptage_diurne_2;'
	    		};
	    		if (array_selected_fields.indexOf('Utilisation_site_nocturne') > -1) {
	    			CSV = CSV + 'Utilisation_site_nocturne;'
	    		};
	    		if (array_selected_fields.indexOf('Aliment_consomme') > -1) {
	    			CSV = CSV + 'Aliment_consomme;'
	    		};
	    		if (array_selected_fields.indexOf('Presence_nocturne') > -1) {
	    			CSV = CSV + 'Presence_nocturne;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne1') > -1) {
	    			CSV = CSV + 'Famille_nocturne1;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne1') > -1) {
	    			CSV = CSV + 'Genre_nocturne1;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne1') > -1) {
	    			CSV = CSV + 'Espece_nocturne1;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne2') > -1) {
	    			CSV = CSV + 'Famille_nocturne2;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne2') > -1) {
	    			CSV = CSV + 'Genre_nocturne2;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne2') > -1) {
	    			CSV = CSV + 'Espece_nocturne2;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne3') > -1) {
	    			CSV = CSV + 'Famille_nocturne3;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne3') > -1) {
	    			CSV = CSV + 'Genre_nocturne3;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne3') > -1) {
	    			CSV = CSV + 'Espece_nocturne3;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne4') > -1) {
	    			CSV = CSV + 'Famille_nocturne4;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne4') > -1) {
	    			CSV = CSV + 'Genre_nocturne4;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne4') > -1) {
	    			CSV = CSV + 'Espece_nocturne4;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne5') > -1) {
	    			CSV = CSV + 'Famille_nocturne5;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne5') > -1) {
	    			CSV = CSV + 'Genre_nocturne5;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne5') > -1) {
	    			CSV = CSV + 'Espece_nocturne5;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne6') > -1) {
	    			CSV = CSV + 'Famille_nocturne6;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne6') > -1) {
	    			CSV = CSV + 'Genre_nocturne6;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne6') > -1) {
	    			CSV = CSV + 'Espece_nocturne6;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_nocturne7') > -1) {
	    			CSV = CSV + 'Famille_nocturne7;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_nocturne7') > -1) {
	    			CSV = CSV + 'Genre_nocturne7;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_nocturne7') > -1) {
	    			CSV = CSV + 'Espece_nocturne7;'
	    		};
	    		if (array_selected_fields.indexOf('Methode_comptage_nocturne') > -1) {
	    			CSV = CSV + 'Methode_comptage_nocturne;'
	    		};
	    		if (array_selected_fields.indexOf('Resultat_comptage_nocturne_1') > -1) {
	    			CSV = CSV + 'Resultat_comptage_nocturne_1;'
	    		};
	    		if (array_selected_fields.indexOf('Resultat_comptage_nocturne_2') > -1) {
	    			CSV = CSV + 'Resultat_comptage_nocturne_2;'
	    		};
	    		if (array_selected_fields.indexOf('Vocalisations') > -1) {
	    			CSV = CSV + 'Vocalisations;'
	    		};
	    		if (array_selected_fields.indexOf('Parade_sexuelle') > -1) {
	    			CSV = CSV + 'Parade_sexuelle;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_vocalisations') > -1) {
	    			CSV = CSV + 'Famille_vocalisations;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_vocalisations') > -1) {
	    			CSV = CSV + 'Genre_vocalisations;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_vocalisations') > -1) {
	    			CSV = CSV + 'Espece_vocalisations;'
	    		};
	    		if (array_selected_fields.indexOf('Copulations') > -1) {
	    			CSV = CSV + 'Copulations;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_copulations') > -1) {
	    			CSV = CSV + 'Famille_copulations;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_copulations') > -1) {
	    			CSV = CSV + 'Genre_copulations;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_copulations') > -1) {
	    			CSV = CSV + 'Espece_copulations;'
	    		};
	    		if (array_selected_fields.indexOf('Suitee') > -1) {
	    			CSV = CSV + 'Suitee;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_suitee') > -1) {
	    			CSV = CSV + 'Famille_suitee;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_suitee') > -1) {
	    			CSV = CSV + 'Genre_suitee;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_suitee') > -1) {
	    			CSV = CSV + 'Espece_suitee;'
	    		};
	    		if (array_selected_fields.indexOf('Agressions') > -1) {
	    			CSV = CSV + 'Agressions;'
	    		};
	    		if (array_selected_fields.indexOf('Famille_agressions') > -1) {
	    			CSV = CSV + 'Famille_agressions;'
	    		};
	    		if (array_selected_fields.indexOf('Genre_agressions') > -1) {
	    			CSV = CSV + 'Genre_agressions;'
	    		};
	    		if (array_selected_fields.indexOf('Espece_agressions') > -1) {
	    			CSV = CSV + 'Espece_agressions;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_canopee_nb_7') > -1) {
	    			CSV = CSV + 'Filet_canopee_nb_7;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_canopee_m2_7') > -1) {
	    			CSV = CSV + 'Filet_canopee_m2_7;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_1') > -1) {
	    			CSV = CSV + 'NumFilet7_1;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_1') > -1) {
	    			CSV = CSV + 'LongueurFilet7_1;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_1') > -1) {
	    			CSV = CSV + 'HauteurFilet7_1;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_2') > -1) {
	    			CSV = CSV + 'NumFilet7_2;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_2') > -1) {
	    			CSV = CSV + 'LongueurFilet7_2;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_2') > -1) {
	    			CSV = CSV + 'HauteurFilet7_2;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_3') > -1) {
	    			CSV = CSV + 'NumFilet7_3;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_3') > -1) {
	    			CSV = CSV + 'LongueurFilet7_3;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_3') > -1) {
	    			CSV = CSV + 'HauteurFilet7_3;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_4') > -1) {
	    			CSV = CSV + 'NumFilet7_4;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_4') > -1) {
	    			CSV = CSV + 'LongueurFilet7_4;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_4') > -1) {
	    			CSV = CSV + 'HauteurFilet7_4;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_5') > -1) {
	    			CSV = CSV + 'NumFilet7_5;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_5') > -1) {
	    			CSV = CSV + 'LongueurFilet7_5;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_5') > -1) {
	    			CSV = CSV + 'HauteurFilet7_5;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_6') > -1) {
	    			CSV = CSV + 'NumFilet7_6;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_6') > -1) {
	    			CSV = CSV + 'LongueurFilet7_6;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_6') > -1) {
	    			CSV = CSV + 'HauteurFilet7_6;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet7_7') > -1) {
	    			CSV = CSV + 'NumFilet7_7;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet7_7') > -1) {
	    			CSV = CSV + 'LongueurFilet7_7;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet7_7') > -1) {
	    			CSV = CSV + 'HauteurFilet7_7;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_canopee_nb_20') > -1) {
	    			CSV = CSV + 'Filet_canopee_nb_20;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_canopee_m2_20') > -1) {
	    			CSV = CSV + 'Filet_canopee_m2_20;'
	    		};				
				if (array_selected_fields.indexOf('NumFilet20_1') > -1) {
	    			CSV = CSV + 'NumFilet20_1;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_1') > -1) {
	    			CSV = CSV + 'LongueurFilet20_1;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_1') > -1) {
	    			CSV = CSV + 'HauteurFilet20_1;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet20_2') > -1) {
	    			CSV = CSV + 'NumFilet20_2;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_2') > -1) {
	    			CSV = CSV + 'LongueurFilet20_2;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_2') > -1) {
	    			CSV = CSV + 'HauteurFilet20_2;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet20_3') > -1) {
	    			CSV = CSV + 'NumFilet20_3;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_3') > -1) {
	    			CSV = CSV + 'LongueurFilet20_3;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_3') > -1) {
	    			CSV = CSV + 'HauteurFilet20_3;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet20_4') > -1) {
	    			CSV = CSV + 'NumFilet20_4;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_4') > -1) {
	    			CSV = CSV + 'LongueurFilet20_4;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_4') > -1) {
	    			CSV = CSV + 'HauteurFilet20_4;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet20_5') > -1) {
	    			CSV = CSV + 'NumFilet20_5;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_5') > -1) {
	    			CSV = CSV + 'LongueurFilet20_5;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_5') > -1) {
	    			CSV = CSV + 'HauteurFilet20_5;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet20_6') > -1) {
	    			CSV = CSV + 'NumFilet20_6;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_6') > -1) {
	    			CSV = CSV + 'LongueurFilet20_6;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_6') > -1) {
	    			CSV = CSV + 'HauteurFilet20_6;'
	    		};
	    		if (array_selected_fields.indexOf('NumFilet20_7') > -1) {
	    			CSV = CSV + 'NumFilet20_7;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFilet20_7') > -1) {
	    			CSV = CSV + 'LongueurFilet20_7;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFilet20_7') > -1) {
	    			CSV = CSV + 'HauteurFilet20_7;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_sol_nb') > -1) {
	    			CSV = CSV + 'Filet_sol_nb;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_sol_m2') > -1) {
	    			CSV = CSV + 'Filet_sol_m2;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_1') > -1) {
	    			CSV = CSV + 'NumFiletSol_1;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_1') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_1;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_1') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_1;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_2') > -1) {
	    			CSV = CSV + 'NumFiletSol_2;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_2') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_2;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_2') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_2;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_3') > -1) {
	    			CSV = CSV + 'NumFiletSol_3;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_3') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_3;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_3') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_3;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_4') > -1) {
	    			CSV = CSV + 'NumFiletSol_4;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_4') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_4;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_4') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_4;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_5') > -1) {
	    			CSV = CSV + 'NumFiletSol_5;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_5') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_5;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_5') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_5;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_6') > -1) {
	    			CSV = CSV + 'NumFiletSol_6;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_6') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_6;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_6') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_6;'
	    		};
	    		if (array_selected_fields.indexOf('NumFiletSol_7') > -1) {
	    			CSV = CSV + 'NumFiletSol_7;'
	    		};
	    		if (array_selected_fields.indexOf('LongueurFiletSol_7') > -1) {
	    			CSV = CSV + 'LongueurFiletSol_7;'
	    		};
	    		if (array_selected_fields.indexOf('HauteurFiletSol_7') > -1) {
	    			CSV = CSV + 'HauteurFiletSol_7;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_debut') > -1) {
	    			CSV = CSV + 'Filet_debut;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_fin') > -1) {
	    			CSV = CSV + 'Filet_fin;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_temps') > -1) {
	    			CSV = CSV + 'Filet_temps;'
	    		};
	    		if (array_selected_fields.indexOf('Filet_capture_nb') > -1) {
	    			CSV = CSV + 'Filet_capture_nb;'
	    		};
	    		if (array_selected_fields.indexOf('Harp_debut') > -1) {
	    			CSV = CSV + 'Harp_debut;'
	    		};
	    		if (array_selected_fields.indexOf('Harp_fin') > -1) {
	    			CSV = CSV + 'Harp_fin;'
	    		};
	    		if (array_selected_fields.indexOf('Harp_temps') > -1) {
	    			CSV = CSV + 'Harp_temps;'
	    		};
	    		if (array_selected_fields.indexOf('Harpe_nb') > -1) {
	    			CSV = CSV + 'Harpe_nb;'
	    		};
	    		if (array_selected_fields.indexOf('Saison') > -1) {
	    			CSV = CSV + 'Saison;'
	    		};
	    		if (array_selected_fields.indexOf('Climat') > -1) {
	    			CSV = CSV + 'Climat;'
	    		};
	    		if (array_selected_fields.indexOf('Autre_climat') > -1) {
	    			CSV = CSV + 'Autre_climat;'
	    		};
	    		if (array_selected_fields.indexOf('Precipitation') > -1) {
	    			CSV = CSV + 'Precipitation;'
	    		};
	    		if (array_selected_fields.indexOf('Vent') > -1) {
	    			CSV = CSV + 'Vent;'
	    		};
	    		if (array_selected_fields.indexOf('Lune') > -1) {
	    			CSV = CSV + 'Lune;'
	    		};
	    		if (array_selected_fields.indexOf('Temperature_logger') > -1) {
	    			CSV = CSV + 'Temperature_logger;'
	    		};
	    		if (array_selected_fields.indexOf('Humidite_logger') > -1) {
	    			CSV = CSV + 'Humidite_logger;'
	    		};
	    		if (array_selected_fields.indexOf('Username') > -1) {
	    			CSV = CSV + 'Username;'
	    		};
			CSV = CSV + "\r\n";
    	}
    	
    	function addJournalieres_selected(row) {
			
    		if (count > 0) {
	    		var debug;
				if (localStorage.getItem('debug') === null) {
					debug = '';
				} else {
					debug = localStorage.getItem('debug');
				};
				
				/*if (localStorage.getItem('web') === 'oui') {
					var remote_couchdb = localStorage.getItem('remote_couchdb');
					var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
				} else {
					var DB_Site = new PouchDB('site' + nom_table + debug);
				};
				
				var N_site = row.doc.N_site;
				
				DB_Site.find({
			       	selector: {N_site: N_site}
				}).then(function (result) {
					if (result.docs.length > 0) {*/
						
				if (row.doc.N_site != null) {
			    	var N_site = row.doc.N_site;
			    			
			    	var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
			    			
			    	var site = JSON.stringify(res);
			    	
			    	var obj_site = JSON.parse(site);
			    			
			    	obj_site.forEach(function(row){
			    		Pays = row.Pays;
			    		Region_capture = row.Region_capture;
			    		Site_capture = row.Site_capture;
			    		Environnement = row.Environnement;
		    			Latitude = row.Latitude;
		    			Lat_degre_dec = row.Lat_degre_dec;
		    			Longitude = row.Longitude;
		    			Long_degre_dec = row.Long_degre_dec;
		    			Proximite_village_km = row.Proximite_village_km;
		    			NbSite = row.NbSite;
			    	});
			    	
			    	if (NbSite > 0) {
    		
		    			if (array_selected_fields.indexOf('Date') > -1) {
							CSV = CSV + row.doc.Date + ";"
						};
						if (array_selected_fields.indexOf('Equipe') > -1) {
							CSV = CSV + row.doc.Equipe + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_preleve_debut') > -1) {
							CSV = CSV + row.doc.ID_CS_preleve_debut + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_preleve_fin') > -1) {
							CSV = CSV + row.doc.ID_CS_preleve_fin + ";"
						};
						if (array_selected_fields.indexOf('N_site') > -1) {
							CSV = CSV + row.doc.N_site + ";"
						};
						if (array_selected_fields.indexOf('Pays') > -1) {
							CSV = CSV + result.docs[0].Pays + ";"
						};
						if (array_selected_fields.indexOf('Region_capture') > -1) {
							CSV = CSV + result.docs[0].Region_capture + ";"
						};
						if (array_selected_fields.indexOf('Site_capture') > -1) {
							CSV = CSV + result.docs[0].Site_capture + ";"
						};
						if (array_selected_fields.indexOf('Environnement') > -1) {
							CSV = CSV + result.docs[0].Environnement + ";"
						};
						if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
							CSV = CSV + result.docs[0].Proximite_village_km + ";"
						};
						if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
							CSV = CSV + result.docs[0].Lat_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Latitude') > -1) {
							CSV = CSV + result.docs[0].Latitude + ";"
						};
						if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
							CSV = CSV + result.docs[0].Long_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Longitude') > -1) {
							CSV = CSV + result.docs[0].Longitude + ";"
						};
						if (array_selected_fields.indexOf('Roost_diurne') > -1) {
							CSV = CSV + row.doc.Roost_diurne + ";"
						};
						if (array_selected_fields.indexOf('Presence_diurne') > -1) {
							CSV = CSV + row.doc.Presence_diurne + ";"
						};
						if (array_selected_fields.indexOf('Famille_diurne1') > -1) {
							if (typeof row.doc.TaxonomieDiurne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[0].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne1') > -1) {
							if (typeof row.doc.TaxonomieDiurne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[0].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne1') > -1) {
							if (typeof row.doc.TaxonomieDiurne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[0].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne2') > -1) {
							if (typeof row.doc.TaxonomieDiurne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[1].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne2') > -1) {
							if (typeof row.doc.TaxonomieDiurne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[1].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne2') > -1) {
							if (typeof row.doc.TaxonomieDiurne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[1].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne3') > -1) {
							if (typeof row.doc.TaxonomieDiurne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[2].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne3') > -1) {
							if (typeof row.doc.TaxonomieDiurne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[2].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne3') > -1) {
							if (typeof row.doc.TaxonomieDiurne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[2].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne4') > -1) {
							if (typeof row.doc.TaxonomieDiurne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[3].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne4') > -1) {
							if (typeof row.doc.TaxonomieDiurne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[3].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne4') > -1) {
							if (typeof row.doc.TaxonomieDiurne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[3].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne5') > -1) {
							if (typeof row.doc.TaxonomieDiurne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[4].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne5') > -1) {
							if (typeof row.doc.TaxonomieDiurne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[4].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne5') > -1) {
							if (typeof row.doc.TaxonomieDiurne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[4].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne6') > -1) {
							if (typeof row.doc.TaxonomieDiurne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[5].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne6') > -1) {
							if (typeof row.doc.TaxonomieDiurne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[5].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne6') > -1) {
							if (typeof row.doc.TaxonomieDiurne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[5].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne7') > -1) {
							if (typeof row.doc.TaxonomieDiurne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[6].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne7') > -1) {
							if (typeof row.doc.TaxonomieDiurne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[6].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne7') > -1) {
							if (typeof row.doc.TaxonomieDiurne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[6].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Methode_comptage_diurne') > -1) {
							CSV = CSV + row.doc.Methode_comptage_diurne + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_diurne_1') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_diurne_1 + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_diurne_2') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_diurne_2 + ";"
						};
						if (array_selected_fields.indexOf('Utilisation_site_nocturne') > -1) {
							CSV = CSV + row.doc.Utilisation_site_nocturne + ";"
						};
						if (array_selected_fields.indexOf('Aliment_consomme') > -1) {
							CSV = CSV + row.doc.Aliment_consomme + ";"
						};
						if (array_selected_fields.indexOf('Presence_nocturne') > -1) {
							CSV = CSV + row.doc.Presence_nocturne + ";"
						};
						if (array_selected_fields.indexOf('Famille_nocturne1') > -1) {
							if (typeof row.doc.TaxonomieNocturne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[0].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne1') > -1) {
							if (typeof row.doc.TaxonomieNocturne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[0].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne1') > -1) {
							if (typeof row.doc.TaxonomieNocturne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[0].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne2') > -1) {
							if (typeof row.doc.TaxonomieNocturne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[1].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne2') > -1) {
							if (typeof row.doc.TaxonomieNocturne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[1].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne2') > -1) {
							if (typeof row.doc.TaxonomieNocturne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[1].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne3') > -1) {
							if (typeof row.doc.TaxonomieNocturne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[2].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne3') > -1) {
							if (typeof row.doc.TaxonomieNocturne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[2].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne3') > -1) {
							if (typeof row.doc.TaxonomieNocturne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[2].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne4') > -1) {
							if (typeof row.doc.TaxonomieNocturne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[3].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne4') > -1) {
							if (typeof row.doc.TaxonomieNocturne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[3].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne4') > -1) {
							if (typeof row.doc.TaxonomieNocturne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[3].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne5') > -1) {
							if (typeof row.doc.TaxonomieNocturne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[4].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne5') > -1) {
							if (typeof row.doc.TaxonomieNocturne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[4].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne5') > -1) {
							if (typeof row.doc.TaxonomieNocturne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[4].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne6') > -1) {
							if (typeof row.doc.TaxonomieNocturne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[5].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne6') > -1) {
							if (typeof row.doc.TaxonomieNocturne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[5].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne6') > -1) {
							if (typeof row.doc.TaxonomieNocturne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[5].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne7') > -1) {
							if (typeof row.doc.TaxonomieNocturne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[6].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne7') > -1) {
							if (typeof row.doc.TaxonomieNocturne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[6].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne7') > -1) {
							if (typeof row.doc.TaxonomieNocturne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[6].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Methode_comptage_nocturne') > -1) {
							CSV = CSV + row.doc.Methode_comptage_nocturne + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_nocturne_1') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_nocturne_1 + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_nocturne_2') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_nocturne_2 + ";"
						};
						if (array_selected_fields.indexOf('Vocalisations') > -1) {
							CSV = CSV + row.doc.Vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Parade_sexuelle') > -1) {
							CSV = CSV + row.doc.Parade_sexuelle + ";"
						};
						if (array_selected_fields.indexOf('Famille_vocalisations') > -1) {
							CSV = CSV + row.doc.Famille_vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Genre_vocalisations') > -1) {
							CSV = CSV + row.doc.Genre_vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Espece_vocalisations') > -1) {
							CSV = CSV + row.doc.Espece_vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Copulations') > -1) {
							CSV = CSV + row.doc.Copulations + ";"
						};
						if (array_selected_fields.indexOf('Famille_copulations') > -1) {
							CSV = CSV + row.doc.Famille_copulations + ";"
						};
						if (array_selected_fields.indexOf('Genre_copulations') > -1) {
							CSV = CSV + row.doc.Genre_copulations + ";"
						};
						if (array_selected_fields.indexOf('Espece_copulations') > -1) {
							CSV = CSV + row.doc.Espece_copulations + ";"
						};
						if (array_selected_fields.indexOf('Suitee') > -1) {
							CSV = CSV + row.doc.Suitee + ";"
						};
						if (array_selected_fields.indexOf('Famille_suitee') > -1) {
							CSV = CSV + row.doc.Famille_suitee + ";"
						};
						if (array_selected_fields.indexOf('Genre_suitee') > -1) {
							CSV = CSV + row.doc.Genre_suitee + ";"
						};
						if (array_selected_fields.indexOf('Espece_suitee') > -1) {
							CSV = CSV + row.doc.Espece_suitee + ";"
						};
						if (array_selected_fields.indexOf('Agressions') > -1) {
							CSV = CSV + row.doc.Agressions + ";"
						};
						if (array_selected_fields.indexOf('Famille_agressions') > -1) {
							CSV = CSV + row.doc.Famille_agressions + ";"
						};
						if (array_selected_fields.indexOf('Genre_agressions') > -1) {
							CSV = CSV + row.doc.Genre_agressions + ";"
						};
						if (array_selected_fields.indexOf('Espece_agressions') > -1) {
							CSV = CSV + row.doc.Espece_agressions + ";"
						};
						if (array_selected_fields.indexOf('Filet_canopee_nb_7') > -1) {
							CSV = CSV + row.doc.Filet_canopee_nb_7 + ";"
						};
						if (array_selected_fields.indexOf('Filet_canopee_m2_7') > -1) {
							CSV = CSV + row.doc.Filet_canopee_m2_7 + ";"
						};
						if (array_selected_fields.indexOf('NumFilet7_1') > -1) {
							if (typeof row.doc.FiletCanopee_7[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[0].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_1') > -1) {
							if (typeof row.doc.FiletCanopee_7[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[0].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_1') > -1) {
							if (typeof row.doc.FiletCanopee_7[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[0].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_2') > -1) {
							if (typeof row.doc.FiletCanopee_7[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[1].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_2') > -1) {
							if (typeof row.doc.FiletCanopee_7[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[1].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_2') > -1) {
							if (typeof row.doc.FiletCanopee_7[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[1].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_3') > -1) {
							if (typeof row.doc.FiletCanopee_7[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[2].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_3') > -1) {
							if (typeof row.doc.FiletCanopee_7[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[2].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_3') > -1) {
							if (typeof row.doc.FiletCanopee_7[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[2].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_4') > -1) {
							if (typeof row.doc.FiletCanopee_7[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[3].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_4') > -1) {
							if (typeof row.doc.FiletCanopee_7[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[3].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_4') > -1) {
							if (typeof row.doc.FiletCanopee_7[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[3].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_5') > -1) {
							if (typeof row.doc.FiletCanopee_7[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[4].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_5') > -1) {
							if (typeof row.doc.FiletCanopee_7[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[4].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_5') > -1) {
							if (typeof row.doc.FiletCanopee_7[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[4].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_6') > -1) {
							if (typeof row.doc.FiletCanopee_7[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[5].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_6') > -1) {
							if (typeof row.doc.FiletCanopee_7[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[5].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_6') > -1) {
							if (typeof row.doc.FiletCanopee_7[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[5].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_7') > -1) {
							if (typeof row.doc.FiletCanopee_7[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[6].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_7') > -1) {
							if (typeof row.doc.FiletCanopee_7[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[6].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_7') > -1) {
							if (typeof row.doc.FiletCanopee_7[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[6].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Filet_canopee_nb_20') > -1) {
							CSV = CSV + row.doc.Filet_canopee_nb_20 + ";"
						};
						if (array_selected_fields.indexOf('Filet_canopee_m2_20') > -1) {
							CSV = CSV + row.doc.Filet_canopee_m2_20 + ";"
						};
						if (array_selected_fields.indexOf('NumFilet20_1') > -1) {
							if (typeof row.doc.FiletCanopee_20[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[0].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_1') > -1) {
							if (typeof row.doc.FiletCanopee_20[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[0].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_1') > -1) {
							if (typeof row.doc.FiletCanopee_20[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[0].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_2') > -1) {
							if (typeof row.doc.FiletCanopee_20[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[1].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_2') > -1) {
							if (typeof row.doc.FiletCanopee_20[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[1].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_2') > -1) {
							if (typeof row.doc.FiletCanopee_20[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[1].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_3') > -1) {
							if (typeof row.doc.FiletCanopee_20[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[2].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_3') > -1) {
							if (typeof row.doc.FiletCanopee_20[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[2].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_3') > -1) {
							if (typeof row.doc.FiletCanopee_20[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[2].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_4') > -1) {
							if (typeof row.doc.FiletCanopee_20[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[3].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_4') > -1) {
							if (typeof row.doc.FiletCanopee_20[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[3].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_4') > -1) {
							if (typeof row.doc.FiletCanopee_20[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[3].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_5') > -1) {
							if (typeof row.doc.FiletCanopee_20[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[4].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_5') > -1) {
							if (typeof row.doc.FiletCanopee_20[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[4].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_5') > -1) {
							if (typeof row.doc.FiletCanopee_20[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[4].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_6') > -1) {
							if (typeof row.doc.FiletCanopee_20[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[5].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_6') > -1) {
							if (typeof row.doc.FiletCanopee_20[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[5].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_6') > -1) {
							if (typeof row.doc.FiletCanopee_20[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[5].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_7') > -1) {
							if (typeof row.doc.FiletCanopee_20[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[6].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_7') > -1) {
							if (typeof row.doc.FiletCanopee_20[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[6].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_7') > -1) {
							if (typeof row.doc.FiletCanopee_20[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[6].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Filet_sol_nb') > -1) {
							CSV = CSV + row.doc.Filet_sol_nb + ";"
						};
						if (array_selected_fields.indexOf('Filet_sol_m2') > -1) {
							CSV = CSV + row.doc.Filet_sol_m2 + ";"
						};
						if (array_selected_fields.indexOf('NumFiletSol_1') > -1) {
							if (typeof row.doc.FiletSol[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[0].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_1') > -1) {
							if (typeof row.doc.FiletSol[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[0].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_1') > -1) {
							if (typeof row.doc.FiletSol[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[0].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_2') > -1) {
							if (typeof row.doc.FiletSol[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[1].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_2') > -1) {
							if (typeof row.doc.FiletSol[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[1].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_2') > -1) {
							if (typeof row.doc.FiletSol[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[1].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_3') > -1) {
							if (typeof row.doc.FiletSol[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[2].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_3') > -1) {
							if (typeof row.doc.FiletSol[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[2].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_3') > -1) {
							if (typeof row.doc.FiletSol[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[2].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_4') > -1) {
							if (typeof row.doc.FiletSol[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[3].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_4') > -1) {
							if (typeof row.doc.FiletSol[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[3].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_4') > -1) {
							if (typeof row.doc.FiletSol[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[3].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_5') > -1) {
							if (typeof row.doc.FiletSol[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[4].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_5') > -1) {
							if (typeof row.doc.FiletSol[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[4].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_5') > -1) {
							if (typeof row.doc.FiletSol[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[4].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_6') > -1) {
							if (typeof row.doc.FiletSol[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[5].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_6') > -1) {
							if (typeof row.doc.FiletSol[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[5].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_6') > -1) {
							if (typeof row.doc.FiletSol[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[5].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_7') > -1) {
							if (typeof row.doc.FiletSol[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[6].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_7') > -1) {
							if (typeof row.doc.FiletSol[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[6].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_7') > -1) {
							if (typeof row.doc.FiletSol[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[6].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Filet_debut') > -1) {
							CSV = CSV + row.doc.Filet_debut + ";"
						};
						if (array_selected_fields.indexOf('Filet_fin') > -1) {
							CSV = CSV + row.doc.Filet_fin + ";"
						};
						if (array_selected_fields.indexOf('Filet_temps') > -1) {
							CSV = CSV + row.doc.Filet_temps + ";"
						};
						if (array_selected_fields.indexOf('Filet_capture_nb') > -1) {
							CSV = CSV + row.doc.Filet_capture_nb + ";"
						};
						if (array_selected_fields.indexOf('Harp_debut') > -1) {
							CSV = CSV + row.doc.Harp_debut + ";"
						};
						if (array_selected_fields.indexOf('Harp_fin') > -1) {
							CSV = CSV + row.doc.Harp_fin + ";"
						};
						if (array_selected_fields.indexOf('Harp_temps') > -1) {
							CSV = CSV + row.doc.Harp_temps + ";"
						};
						if (array_selected_fields.indexOf('Harpe_nb') > -1) {
							CSV = CSV + row.doc.Harpe_nb + ";"
						};
						if (array_selected_fields.indexOf('Saison') > -1) {
							CSV = CSV + row.doc.Saison + ";"
						};
						if (array_selected_fields.indexOf('Climat') > -1) {
							CSV = CSV + row.doc.Climat + ";"
						};
						if (array_selected_fields.indexOf('Autre_climat') > -1) {
							CSV = CSV + row.doc.Autre_climat + ";"
						};
						if (array_selected_fields.indexOf('Precipitation') > -1) {
							CSV = CSV + row.doc.Precipitation + ";"
						};
						if (array_selected_fields.indexOf('Vent') > -1) {
							CSV = CSV + row.doc.Vent + ";"
						};
						if (array_selected_fields.indexOf('Lune') > -1) {
							CSV = CSV + row.doc.Lune + ";"
						};
						if (array_selected_fields.indexOf('Temperature_logger') > -1) {
							CSV = CSV + row.doc.Temperature_logger + ";"
						};
						if (array_selected_fields.indexOf('Humidite_logger') > -1) {
							CSV = CSV + row.doc.Humidite_logger + ";"
						};
						if (array_selected_fields.indexOf('Username') > -1) {
							CSV = CSV + row.doc.Username + ";"
						};
		    			CSV = CSV + "\r\n";
		    				
		    			count--
    					console.log(count);
    					
    					if (count == 0) {
    		    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    			
    			    		
    			    		//saveAs(blob, "testfile1.csv");
    			    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    		}
		    		} else {
						if (array_selected_fields.indexOf('Date') > -1) {
							CSV = CSV + row.doc.Date + ";"
						};
						if (array_selected_fields.indexOf('Equipe') > -1) {
							CSV = CSV + row.doc.Equipe + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_preleve_debut') > -1) {
							CSV = CSV + row.doc.ID_CS_preleve_debut + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_preleve_fin') > -1) {
							CSV = CSV + row.doc.ID_CS_preleve_fin + ";"
						};
						if (array_selected_fields.indexOf('N_site') > -1) {
							CSV = CSV + row.doc.N_site + ";"
						};
						if (array_selected_fields.indexOf('Pays') > -1) {
							CSV = CSV + row.doc.Pays + ";"
						};
						if (array_selected_fields.indexOf('Region_capture') > -1) {
							CSV = CSV + row.doc.Region_capture + ";"
						};
						if (array_selected_fields.indexOf('Site_capture') > -1) {
							CSV = CSV + row.doc.Site_capture + ";"
						};
						if (array_selected_fields.indexOf('Environnement') > -1) {
							CSV = CSV + row.doc.Environnement + ";"
						};
						if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
							CSV = CSV + row.doc.Proximite_village_km + ";"
						};
						if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
							CSV = CSV + row.doc.Lat_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Latitude') > -1) {
							CSV = CSV + row.doc.Latitude + ";"
						};
						if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
							CSV = CSV + row.doc.Long_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Longitude') > -1) {
							CSV = CSV + row.doc.Longitude + ";"
						};
						if (array_selected_fields.indexOf('Roost_diurne') > -1) {
							CSV = CSV + row.doc.Roost_diurne + ";"
						};
						if (array_selected_fields.indexOf('Presence_diurne') > -1) {
							CSV = CSV + row.doc.Presence_diurne + ";"
						};
						if (array_selected_fields.indexOf('Famille_diurne1') > -1) {
							if (typeof row.doc.TaxonomieDiurne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[0].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne1') > -1) {
							if (typeof row.doc.TaxonomieDiurne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[0].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne1') > -1) {
							if (typeof row.doc.TaxonomieDiurne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[0].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne2') > -1) {
							if (typeof row.doc.TaxonomieDiurne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[1].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne2') > -1) {
							if (typeof row.doc.TaxonomieDiurne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[1].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne2') > -1) {
							if (typeof row.doc.TaxonomieDiurne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[1].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne3') > -1) {
							if (typeof row.doc.TaxonomieDiurne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[2].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne3') > -1) {
							if (typeof row.doc.TaxonomieDiurne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[2].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne3') > -1) {
							if (typeof row.doc.TaxonomieDiurne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[2].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne4') > -1) {
							if (typeof row.doc.TaxonomieDiurne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[3].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne4') > -1) {
							if (typeof row.doc.TaxonomieDiurne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[3].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne4') > -1) {
							if (typeof row.doc.TaxonomieDiurne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[3].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne5') > -1) {
							if (typeof row.doc.TaxonomieDiurne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[4].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne5') > -1) {
							if (typeof row.doc.TaxonomieDiurne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[4].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne5') > -1) {
							if (typeof row.doc.TaxonomieDiurne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[4].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne6') > -1) {
							if (typeof row.doc.TaxonomieDiurne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[5].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne6') > -1) {
							if (typeof row.doc.TaxonomieDiurne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[5].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne6') > -1) {
							if (typeof row.doc.TaxonomieDiurne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[5].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_diurne7') > -1) {
							if (typeof row.doc.TaxonomieDiurne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[6].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_diurne7') > -1) {
							if (typeof row.doc.TaxonomieDiurne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[6].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_diurne7') > -1) {
							if (typeof row.doc.TaxonomieDiurne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieDiurne[6].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Methode_comptage_diurne') > -1) {
							CSV = CSV + row.doc.Methode_comptage_diurne + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_diurne_1') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_diurne_1 + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_diurne_2') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_diurne_2 + ";"
						};
						if (array_selected_fields.indexOf('Utilisation_site_nocturne') > -1) {
							CSV = CSV + row.doc.Utilisation_site_nocturne + ";"
						};
						if (array_selected_fields.indexOf('Aliment_consomme') > -1) {
							CSV = CSV + row.doc.Aliment_consomme + ";"
						};
						if (array_selected_fields.indexOf('Presence_nocturne') > -1) {
							CSV = CSV + row.doc.Presence_nocturne + ";"
						};
						if (array_selected_fields.indexOf('Famille_nocturne1') > -1) {
							if (typeof row.doc.TaxonomieNocturne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[0].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne1') > -1) {
							if (typeof row.doc.TaxonomieNocturne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[0].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne1') > -1) {
							if (typeof row.doc.TaxonomieNocturne[0] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[0].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne2') > -1) {
							if (typeof row.doc.TaxonomieNocturne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[1].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne2') > -1) {
							if (typeof row.doc.TaxonomieNocturne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[1].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne2') > -1) {
							if (typeof row.doc.TaxonomieNocturne[1] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[1].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne3') > -1) {
							if (typeof row.doc.TaxonomieNocturne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[2].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne3') > -1) {
							if (typeof row.doc.TaxonomieNocturne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[2].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne3') > -1) {
							if (typeof row.doc.TaxonomieNocturne[2] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[2].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne4') > -1) {
							if (typeof row.doc.TaxonomieNocturne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[3].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne4') > -1) {
							if (typeof row.doc.TaxonomieNocturne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[3].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne4') > -1) {
							if (typeof row.doc.TaxonomieNocturne[3] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[3].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne5') > -1) {
							if (typeof row.doc.TaxonomieNocturne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[4].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne5') > -1) {
							if (typeof row.doc.TaxonomieNocturne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[4].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne5') > -1) {
							if (typeof row.doc.TaxonomieNocturne[4] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[4].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne6') > -1) {
							if (typeof row.doc.TaxonomieNocturne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[5].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne6') > -1) {
							if (typeof row.doc.TaxonomieNocturne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[5].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne6') > -1) {
							if (typeof row.doc.TaxonomieNocturne[5] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[5].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille_nocturne7') > -1) {
							if (typeof row.doc.TaxonomieNocturne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[6].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre_nocturne7') > -1) {
							if (typeof row.doc.TaxonomieNocturne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[6].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece_nocturne7') > -1) {
							if (typeof row.doc.TaxonomieNocturne[6] !== 'undefined') {
								CSV = CSV + row.doc.TaxonomieNocturne[6].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Methode_comptage_nocturne') > -1) {
							CSV = CSV + row.doc.Methode_comptage_nocturne + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_nocturne_1') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_nocturne_1 + ";"
						};
						if (array_selected_fields.indexOf('Resultat_comptage_nocturne_2') > -1) {
							CSV = CSV + row.doc.Resultat_comptage_nocturne_2 + ";"
						};
						if (array_selected_fields.indexOf('Vocalisations') > -1) {
							CSV = CSV + row.doc.Vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Parade_sexuelle') > -1) {
							CSV = CSV + row.doc.Parade_sexuelle + ";"
						};
						if (array_selected_fields.indexOf('Famille_vocalisations') > -1) {
							CSV = CSV + row.doc.Famille_vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Genre_vocalisations') > -1) {
							CSV = CSV + row.doc.Genre_vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Espece_vocalisations') > -1) {
							CSV = CSV + row.doc.Espece_vocalisations + ";"
						};
						if (array_selected_fields.indexOf('Copulations') > -1) {
							CSV = CSV + row.doc.Copulations + ";"
						};
						if (array_selected_fields.indexOf('Famille_copulations') > -1) {
							CSV = CSV + row.doc.Famille_copulations + ";"
						};
						if (array_selected_fields.indexOf('Genre_copulations') > -1) {
							CSV = CSV + row.doc.Genre_copulations + ";"
						};
						if (array_selected_fields.indexOf('Espece_copulations') > -1) {
							CSV = CSV + row.doc.Espece_copulations + ";"
						};
						if (array_selected_fields.indexOf('Suitee') > -1) {
							CSV = CSV + row.doc.Suitee + ";"
						};
						if (array_selected_fields.indexOf('Famille_suitee') > -1) {
							CSV = CSV + row.doc.Famille_suitee + ";"
						};
						if (array_selected_fields.indexOf('Genre_suitee') > -1) {
							CSV = CSV + row.doc.Genre_suitee + ";"
						};
						if (array_selected_fields.indexOf('Espece_suitee') > -1) {
							CSV = CSV + row.doc.Espece_suitee + ";"
						};
						if (array_selected_fields.indexOf('Agressions') > -1) {
							CSV = CSV + row.doc.Agressions + ";"
						};
						if (array_selected_fields.indexOf('Famille_agressions') > -1) {
							CSV = CSV + row.doc.Famille_agressions + ";"
						};
						if (array_selected_fields.indexOf('Genre_agressions') > -1) {
							CSV = CSV + row.doc.Genre_agressions + ";"
						};
						if (array_selected_fields.indexOf('Espece_agressions') > -1) {
							CSV = CSV + row.doc.Espece_agressions + ";"
						};
						if (array_selected_fields.indexOf('Filet_canopee_nb_7') > -1) {
							CSV = CSV + row.doc.Filet_canopee_nb_7 + ";"
						};
						if (array_selected_fields.indexOf('Filet_canopee_m2_7') > -1) {
							CSV = CSV + row.doc.Filet_canopee_m2_7 + ";"
						};
						if (array_selected_fields.indexOf('NumFilet7_1') > -1) {
							if (typeof row.doc.FiletCanopee_7[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[0].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_1') > -1) {
							if (typeof row.doc.FiletCanopee_7[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[0].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_1') > -1) {
							if (typeof row.doc.FiletCanopee_7[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[0].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_2') > -1) {
							if (typeof row.doc.FiletCanopee_7[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[1].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_2') > -1) {
							if (typeof row.doc.FiletCanopee_7[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[1].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_2') > -1) {
							if (typeof row.doc.FiletCanopee_7[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[1].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_3') > -1) {
							if (typeof row.doc.FiletCanopee_7[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[2].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_3') > -1) {
							if (typeof row.doc.FiletCanopee_7[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[2].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_3') > -1) {
							if (typeof row.doc.FiletCanopee_7[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[2].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_4') > -1) {
							if (typeof row.doc.FiletCanopee_7[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[3].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_4') > -1) {
							if (typeof row.doc.FiletCanopee_7[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[3].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_4') > -1) {
							if (typeof row.doc.FiletCanopee_7[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[3].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_5') > -1) {
							if (typeof row.doc.FiletCanopee_7[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[4].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_5') > -1) {
							if (typeof row.doc.FiletCanopee_7[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[4].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_5') > -1) {
							if (typeof row.doc.FiletCanopee_7[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[4].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_6') > -1) {
							if (typeof row.doc.FiletCanopee_7[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[5].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_6') > -1) {
							if (typeof row.doc.FiletCanopee_7[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[5].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_6') > -1) {
							if (typeof row.doc.FiletCanopee_7[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[5].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet7_7') > -1) {
							if (typeof row.doc.FiletCanopee_7[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[6].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet7_7') > -1) {
							if (typeof row.doc.FiletCanopee_7[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[6].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet7_7') > -1) {
							if (typeof row.doc.FiletCanopee_7[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_7[6].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Filet_canopee_nb_20') > -1) {
							CSV = CSV + row.doc.Filet_canopee_nb_20 + ";"
						};
						if (array_selected_fields.indexOf('Filet_canopee_m2_20') > -1) {
							CSV = CSV + row.doc.Filet_canopee_m2_20 + ";"
						};
						if (array_selected_fields.indexOf('NumFilet20_1') > -1) {
							if (typeof row.doc.FiletCanopee_20[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[0].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_1') > -1) {
							if (typeof row.doc.FiletCanopee_20[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[0].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_1') > -1) {
							if (typeof row.doc.FiletCanopee_20[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[0].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_2') > -1) {
							if (typeof row.doc.FiletCanopee_20[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[1].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_2') > -1) {
							if (typeof row.doc.FiletCanopee_20[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[1].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_2') > -1) {
							if (typeof row.doc.FiletCanopee_20[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[1].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_3') > -1) {
							if (typeof row.doc.FiletCanopee_20[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[2].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_3') > -1) {
							if (typeof row.doc.FiletCanopee_20[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[2].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_3') > -1) {
							if (typeof row.doc.FiletCanopee_20[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[2].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_4') > -1) {
							if (typeof row.doc.FiletCanopee_20[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[3].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_4') > -1) {
							if (typeof row.doc.FiletCanopee_20[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[3].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_4') > -1) {
							if (typeof row.doc.FiletCanopee_20[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[3].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_5') > -1) {
							if (typeof row.doc.FiletCanopee_20[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[4].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_5') > -1) {
							if (typeof row.doc.FiletCanopee_20[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[4].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_5') > -1) {
							if (typeof row.doc.FiletCanopee_20[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[4].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_6') > -1) {
							if (typeof row.doc.FiletCanopee_20[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[5].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_6') > -1) {
							if (typeof row.doc.FiletCanopee_20[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[5].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_6') > -1) {
							if (typeof row.doc.FiletCanopee_20[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[5].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFilet20_7') > -1) {
							if (typeof row.doc.FiletCanopee_20[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[6].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFilet20_7') > -1) {
							if (typeof row.doc.FiletCanopee_20[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[6].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFilet20_7') > -1) {
							if (typeof row.doc.FiletCanopee_20[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletCanopee_20[6].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Filet_sol_nb') > -1) {
							CSV = CSV + row.doc.Filet_sol_nb + ";"
						};
						if (array_selected_fields.indexOf('Filet_sol_m2') > -1) {
							CSV = CSV + row.doc.Filet_sol_m2 + ";"
						};
						if (array_selected_fields.indexOf('NumFiletSol_1') > -1) {
							if (typeof row.doc.FiletSol[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[0].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_1') > -1) {
							if (typeof row.doc.FiletSol[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[0].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_1') > -1) {
							if (typeof row.doc.FiletSol[0] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[0].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_2') > -1) {
							if (typeof row.doc.FiletSol[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[1].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_2') > -1) {
							if (typeof row.doc.FiletSol[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[1].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_2') > -1) {
							if (typeof row.doc.FiletSol[1] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[1].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_3') > -1) {
							if (typeof row.doc.FiletSol[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[2].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_3') > -1) {
							if (typeof row.doc.FiletSol[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[2].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_3') > -1) {
							if (typeof row.doc.FiletSol[2] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[2].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_4') > -1) {
							if (typeof row.doc.FiletSol[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[3].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_4') > -1) {
							if (typeof row.doc.FiletSol[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[3].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_4') > -1) {
							if (typeof row.doc.FiletSol[3] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[3].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_5') > -1) {
							if (typeof row.doc.FiletSol[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[4].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_5') > -1) {
							if (typeof row.doc.FiletSol[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[4].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_5') > -1) {
							if (typeof row.doc.FiletSol[4] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[4].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_6') > -1) {
							if (typeof row.doc.FiletSol[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[5].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_6') > -1) {
							if (typeof row.doc.FiletSol[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[5].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_6') > -1) {
							if (typeof row.doc.FiletSol[5] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[5].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('NumFiletSol_7') > -1) {
							if (typeof row.doc.FiletSol[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[6].NumFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('LongueurFiletSol_7') > -1) {
							if (typeof row.doc.FiletSol[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[6].LongueurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('HauteurFiletSol_7') > -1) {
							if (typeof row.doc.FiletSol[6] !== 'undefined') {
								CSV = CSV + row.doc.FiletSol[6].HauteurFilet + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Filet_debut') > -1) {
							CSV = CSV + row.doc.Filet_debut + ";"
						};
						if (array_selected_fields.indexOf('Filet_fin') > -1) {
							CSV = CSV + row.doc.Filet_fin + ";"
						};
						if (array_selected_fields.indexOf('Filet_temps') > -1) {
							CSV = CSV + row.doc.Filet_temps + ";"
						};
						if (array_selected_fields.indexOf('Filet_capture_nb') > -1) {
							CSV = CSV + row.doc.Filet_capture_nb + ";"
						};
						if (array_selected_fields.indexOf('Harp_debut') > -1) {
							CSV = CSV + row.doc.Harp_debut + ";"
						};
						if (array_selected_fields.indexOf('Harp_fin') > -1) {
							CSV = CSV + row.doc.Harp_fin + ";"
						};
						if (array_selected_fields.indexOf('Harp_temps') > -1) {
							CSV = CSV + row.doc.Harp_temps + ";"
						};
						if (array_selected_fields.indexOf('Harpe_nb') > -1) {
							CSV = CSV + row.doc.Harpe_nb + ";"
						};
						if (array_selected_fields.indexOf('Saison') > -1) {
							CSV = CSV + row.doc.Saison + ";"
						};
						if (array_selected_fields.indexOf('Climat') > -1) {
							CSV = CSV + row.doc.Climat + ";"
						};
						if (array_selected_fields.indexOf('Autre_climat') > -1) {
							CSV = CSV + row.doc.Autre_climat + ";"
						};
						if (array_selected_fields.indexOf('Precipitation') > -1) {
							CSV = CSV + row.doc.Precipitation + ";"
						};
						if (array_selected_fields.indexOf('Vent') > -1) {
							CSV = CSV + row.doc.Vent + ";"
						};
						if (array_selected_fields.indexOf('Lune') > -1) {
							CSV = CSV + row.doc.Lune + ";"
						};
						if (array_selected_fields.indexOf('Temperature_logger') > -1) {
							CSV = CSV + row.doc.Temperature_logger + ";"
						};
						if (array_selected_fields.indexOf('Humidite_logger') > -1) {
							CSV = CSV + row.doc.Humidite_logger + ";"
						};
						if (array_selected_fields.indexOf('Username') > -1) {
							CSV = CSV + row.doc.Username + ";"
						};
		    			CSV = CSV + "\r\n";
		    				
		    			count--
    					console.log(count);
    					
    					if (count == 0) {
    		    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    			
    			    		
    			    		//saveAs(blob, "testfile1.csv");
    			    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    		}
					}
					
				}	
	    		/*}).catch(function (err) {
	    		     console.log(err);
	    		});*/
			}
    		
    	};
    	    	
		function addDonnees_missions(row) {
    		
    		if (count > 0) {  
    			
    			/*var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};
    			
    			if (localStorage.getItem('web') === 'oui') {
    				var remote_couchdb = localStorage.getItem('remote_couchdb');
    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
    			} else {
    				var DB_Site = new PouchDB('site' + nom_table + debug);
    			};
    			
    			var N_site = row.doc.N_site;
    			
    			DB_Site.find({
    		       	selector: {N_site: N_site}
    			}).then(function (result) {
    				if (result.docs.length > 0) {*/
    			
    			if (row.doc.N_site != null) {
    		    	var N_site = row.doc.N_site;
    		    			
    		    	var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
    		    			
    		    	var site = JSON.stringify(res);
    		    			
    		    	var obj_site = JSON.parse(site);
    		    			
    		    	obj_site.forEach(function(row){
    		    		Pays = row.Pays;
    		    		Region_capture = row.Region_capture;
    		    		Site_capture = row.Site_capture;
    		    		Environnement = row.Environnement;
    	    			Latitude = row.Latitude;
    	    			Lat_degre_dec = row.Lat_degre_dec;
    	    			Longitude = row.Longitude;
    	    			Long_degre_dec = row.Long_degre_dec;
    	    			Proximite_village_km = row.Proximite_village_km;
    	    			NbSite = row.NbSite;
    		    	});
    		    			
    		    	if (NbSite > 0) {
    			
		    			CSV = CSV +
		
							row.doc.Date_debut + ';' + 
							row.doc.Date_fin + ';' + 
							row.doc.Equipe + ';' + 
							row.doc.ID_CS_debut + ';' + 
							row.doc.ID_CS_fin + ';' + 
							row.doc.ID_non_invasif_debut + ';' + 
							row.doc.ID_non_invasif_fin + ';' + 
							row.doc.N_site + ';' + 
							Pays + ';' + 
							Region_capture + ';' + 
							Site_capture + ';' + 
							Environnement + ';' + 
							Proximite_village_km + ';' + 
							Lat_degre_dec + ';' + 
							Latitude + ';' + 
							row.doc.Long_degre_dec + ';' + 
							row.doc.Longitude + ';' + 
							row.doc.Type + ';' + 
							row.doc.Type_Roost + ';' + 
							row.doc.Proximite_eau + ';' + 
							row.doc.Hauteur_canope + ';' + 
							row.doc.Description_site + ';' + 
							row.doc.ID_genet_espece + ';';
		
						for (var i=0;i<7;i++) {
							try {
								console.log(row.doc.Phenologie[i].Famille);
								if (typeof row.doc.Phenologie[i] !== 'undefined') {
											 
										CSV = CSV + row.doc.Phenologie[i].Famille + ';'
											+ row.doc.Phenologie[i].Genre + ';'
											+ row.doc.Phenologie[i].Espece + ';'
											+ row.doc.Phenologie[i].Pheno_espece + ';'
											+ row.doc.Phenologie[i].Statut_espece + ';'
								} else {
									CSV = CSV + ';;;;;';
								}
							} catch (err) {
								CSV = CSV + ';;;;;';
							}
						}
		
						CSV = CSV + 
							row.doc.Espece_animale_sauvage + ';' + 
							row.doc.Espece_animale_domestique + ';' + 
							row.doc.Interaction + ';' + 
							row.doc.Description_interaction_animaux + ';' + 
							row.doc.Activite_humaine + ';' + 
							row.doc.Description_interaction_homme + ';' + 
							row.doc.Camera_trap + ';' + 
							row.doc.Heure_debut_camera + ';' + 
							row.doc.Heure_fin_camera + ';' + 
							row.doc.Username + ";\r\n";
							
						count--
			    		console.log(count);
			    					
			    		if (count == 0) {
			    		   	var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
			    		   	//saveAs(blob, "testfile1.csv");
			    			saveAs(blob, "ebo-sursy" + clock.now + ".csv");
			    		}
    				} else {
    					CSV = CSV +
    					
							row.doc.Date_debut + ';' + 
							row.doc.Date_fin + ';' + 
							row.doc.Equipe + ';' + 
							row.doc.ID_CS_debut + ';' + 
							row.doc.ID_CS_fin + ';' + 
							row.doc.ID_non_invasif_debut + ';' + 
							row.doc.ID_non_invasif_fin + ';' + 
							row.doc.N_site + ';' + 
							row.doc.Pays + ';' + 
							row.doc.Region_capture + ';' + 
							row.doc.Site_capture + ';' + 
							row.doc.Environnement + ';' + 
							row.doc.Proximite_village_km + ';' + 
							row.doc.Lat_degre_dec + ';' + 
							row.doc.Latitude + ';' + 
							row.doc.Long_degre_dec + ';' + 
							row.doc.Longitude + ';' + 
							row.doc.Type + ';' + 
							row.doc.Type_Roost + ';' + 
							row.doc.Proximite_eau + ';' + 
							row.doc.Hauteur_canope + ';' + 
							row.doc.Description_site + ';' + 
							row.doc.ID_genet_espece + ';';
		
						for (var i=0;i<7;i++) {
							try {
								console.log(row.doc.Phenologie[i].Famille);
								if (typeof row.doc.Phenologie[i] !== 'undefined') {
											 
										CSV = CSV + row.doc.Phenologie[i].Famille + ';'
											+ row.doc.Phenologie[i].Genre + ';'
											+ row.doc.Phenologie[i].Espece + ';'
											+ row.doc.Phenologie[i].Pheno_espece + ';'
											+ row.doc.Phenologie[i].Statut_espece + ';'
								} else {
									CSV = CSV + ';;;;;';
								}
							} catch (err) {
								CSV = CSV + ';;;;;';
							}
						}
		
						CSV = CSV + 
							row.doc.Espece_animale_sauvage + ';' + 
							row.doc.Espece_animale_domestique + ';' + 
							row.doc.Interaction + ';' + 
							row.doc.Description_interaction_animaux + ';' + 
							row.doc.Activite_humaine + ';' + 
							row.doc.Description_interaction_homme + ';' + 
							row.doc.Camera_trap + ';' + 
							row.doc.Heure_debut_camera + ';' + 
							row.doc.Heure_fin_camera + ';' + 
							row.doc.Username + ";\r\n";
							
						count--
		    			console.log(count);
		    					
		    			if (count == 0) {
		    		    	var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
		    		    	//saveAs(blob, "testfile1.csv");
		    				saveAs(blob, "ebo-sursy" + clock.now + ".csv");
		    		    }
					}	
				
    			}
	    		/*}).catch(function (err) {
	    		     console.log(err);
	    		});*/
		
    		}
		}
		
		function addMissions_selected_heading() {
    		CSV = '';
			if (array_selected_fields.indexOf('Date_debut') > -1) {
				CSV = CSV + 'Date_debut;'
			};
			if (array_selected_fields.indexOf('Date_fin') > -1) {
				CSV = CSV + 'Date_fin;'
			};
			if (array_selected_fields.indexOf('Equipe') > -1) {
				CSV = CSV + 'Equipe;'
			};
			if (array_selected_fields.indexOf('ID_CS_debut') > -1) {
				CSV = CSV + 'ID_CS_debut;'
			};
			if (array_selected_fields.indexOf('ID_CS_fin') > -1) {
				CSV = CSV + 'ID_CS_fin;'
			};
			if (array_selected_fields.indexOf('ID_non_invasif_debut') > -1) {
				CSV = CSV + 'ID_non_invasif_debut;'
			};
			if (array_selected_fields.indexOf('ID_non_invasif_fin') > -1) {
				CSV = CSV + 'ID_non_invasif_fin;'
			};
			if (array_selected_fields.indexOf('N_site') > -1) {
				CSV = CSV + 'N_site;'
			};
			if (array_selected_fields.indexOf('Pays') > -1) {
				CSV = CSV + 'Pays;'
			};
			if (array_selected_fields.indexOf('Region_capture') > -1) {
				CSV = CSV + 'Region_capture;'
			};
			if (array_selected_fields.indexOf('Site_capture') > -1) {
				CSV = CSV + 'Site_capture;'
			};
			if (array_selected_fields.indexOf('Environnement') > -1) {
				CSV = CSV + 'Environnement;'
			};
			if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
				CSV = CSV + 'Proximite_village_km;'
			};
			if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
				CSV = CSV + 'Lat_degre_dec;'
			};
			if (array_selected_fields.indexOf('Latitude') > -1) {
				CSV = CSV + 'Latitude;'
			};
			if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
				CSV = CSV + 'Long_degre_dec;'
			};
			if (array_selected_fields.indexOf('Longitude') > -1) {
				CSV = CSV + 'Longitude;'
			};
			if (array_selected_fields.indexOf('Type') > -1) {
				CSV = CSV + 'Type;'
			};
			if (array_selected_fields.indexOf('Type_Roost') > -1) {
				CSV = CSV + 'Type_Roost;'
			};
			if (array_selected_fields.indexOf('Proximite_eau') > -1) {
				CSV = CSV + 'Proximite_eau;'
			};
			if (array_selected_fields.indexOf('Hauteur_canope') > -1) {
				CSV = CSV + 'Hauteur_canope;'
			};
			if (array_selected_fields.indexOf('Description_site') > -1) {
				CSV = CSV + 'Description_site;'
			};
			if (array_selected_fields.indexOf('ID_genet_espece') > -1) {
				CSV = CSV + 'ID_genet_espece;'
			};

			if (array_selected_fields.indexOf('Famille1') > -1) {
	    		CSV = CSV + 'Famille1;'
			};
			if (array_selected_fields.indexOf('Genre1') > -1) {
	    		CSV = CSV + 'Genre1;'
			};
			if (array_selected_fields.indexOf('Espece1') > -1) {
	    		CSV = CSV + 'Espece1;'
			};
			if (array_selected_fields.indexOf('Pheno_espece1') > -1) {
	    		CSV = CSV + 'Pheno_espece1;'
			};
			if (array_selected_fields.indexOf('Statut_espece1') > -1) {
				CSV = CSV + 'Statut_espece1;'
			};
			if (array_selected_fields.indexOf('Famille2') > -1) {
	    		CSV = CSV + 'Famille2;'
			};
			if (array_selected_fields.indexOf('Genre2') > -1) {
	    		CSV = CSV + 'Genre2;'
			};
			if (array_selected_fields.indexOf('Espece2') > -1) {
	    		CSV = CSV + 'Espece2;'
			};
			if (array_selected_fields.indexOf('Pheno_espece2') > -1) {
	    		CSV = CSV + 'Pheno_espece2;'
			};
			if (array_selected_fields.indexOf('Statut_espece2') > -1) {
				CSV = CSV + 'Statut_espece2;'
			};
			if (array_selected_fields.indexOf('Famille3') > -1) {
	    		CSV = CSV + 'Famille3;'
			};
			if (array_selected_fields.indexOf('Genre3') > -1) {
	    		CSV = CSV + 'Genre3;'
			};
			if (array_selected_fields.indexOf('Espece3') > -1) {
	    		CSV = CSV + 'Espece3;'
			};
			if (array_selected_fields.indexOf('Pheno_espece3') > -1) {
	    		CSV = CSV + 'Pheno_espece3;'
			};
			if (array_selected_fields.indexOf('Statut_espece3') > -1) {
				CSV = CSV + 'Statut_espece3;'
			};
			if (array_selected_fields.indexOf('Famille4') > -1) {
	    		CSV = CSV + 'Famille4;'
			};
			if (array_selected_fields.indexOf('Genre4') > -1) {
	    		CSV = CSV + 'Genre4;'
			};
			if (array_selected_fields.indexOf('Espece4') > -1) {
	    		CSV = CSV + 'Espece4;'
			};
			if (array_selected_fields.indexOf('Pheno_espece4') > -1) {
	    		CSV = CSV + 'Pheno_espece4;'
			};
			if (array_selected_fields.indexOf('Statut_espece4') > -1) {
				CSV = CSV + 'Statut_espece4;'
			};
			if (array_selected_fields.indexOf('Famille5') > -1) {
	    		CSV = CSV + 'Famille5;'
			};
			if (array_selected_fields.indexOf('Genre5') > -1) {
	    		CSV = CSV + 'Genre5;'
			};
			if (array_selected_fields.indexOf('Espece5') > -1) {
	    		CSV = CSV + 'Espece5;'
			};
			if (array_selected_fields.indexOf('Pheno_espece5') > -1) {
	    		CSV = CSV + 'Pheno_espece5;'
			};
			if (array_selected_fields.indexOf('Statut_espece5') > -1) {
				CSV = CSV + 'Statut_espece5;'
			};
			if (array_selected_fields.indexOf('Famille6') > -1) {
	    		CSV = CSV + 'Famille6;'
			};
			if (array_selected_fields.indexOf('Genre6') > -1) {
				CSV = CSV + 'Genre6;'
			};
			if (array_selected_fields.indexOf('Espece6') > -1) {
	    		CSV = CSV + 'Espece6;'
			};
			if (array_selected_fields.indexOf('Pheno_espece6') > -1) {
	    		CSV = CSV + 'Pheno_espece6;'
			};
			if (array_selected_fields.indexOf('Statut_espece6') > -1) {
				CSV = CSV + 'Statut_espece6;'
			};
			if (array_selected_fields.indexOf('Famille7') > -1) {
	    		CSV = CSV + 'Famille7;'
			};
			if (array_selected_fields.indexOf('Genre7') > -1) {
				CSV = CSV + 'Genre7;'
			};
			if (array_selected_fields.indexOf('Espece7') > -1) {
	    		CSV = CSV + 'Espece7;'
			};
			if (array_selected_fields.indexOf('Pheno_espece7') > -1) {
	    		CSV = CSV + 'Pheno_espece7;'
			};
			if (array_selected_fields.indexOf('Statut_espece7') > -1) {
				CSV = CSV + 'Statut_espece7;'
			};			

			if (array_selected_fields.indexOf('Espece_animale_sauvage') > -1) {
				CSV = CSV + 'Espece_animale_sauvage;'
			};
			if (array_selected_fields.indexOf('Espece_animale_domestique') > -1) {
				CSV = CSV + 'Espece_animale_domestique;'
			};
			if (array_selected_fields.indexOf('Interaction') > -1) {
				CSV = CSV + 'Interaction;'
			};
			if (array_selected_fields.indexOf('Description_interaction_animaux') > -1) {
				CSV = CSV + 'Description_interaction_animaux;'
			};
			if (array_selected_fields.indexOf('Activite_humaine') > -1) {
				CSV = CSV + 'Activite_humaine;'
			};
			if (array_selected_fields.indexOf('Description_interaction_homme') > -1) {
				CSV = CSV + 'Description_interaction_homme;'
			};
			if (array_selected_fields.indexOf('Camera_trap') > -1) {
				CSV = CSV + 'Camera_trap;'
			};
			if (array_selected_fields.indexOf('Heure_debut_camera') > -1) {
				CSV = CSV + 'Heure_debut_camera;'
			};
			if (array_selected_fields.indexOf('Heure_fin_camera') > -1) {
				CSV = CSV + 'Heure_fin_camera;'
			};
			if (array_selected_fields.indexOf('Username') > -1) {
				CSV = CSV + 'Username;'
			};

			CSV = CSV + "\r\n";
		}
		
		function addMissions_selected(row) {
			if (count > 0) {
				
				/*var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};
    			
    			if (localStorage.getItem('web') === 'oui') {
    				var remote_couchdb = localStorage.getItem('remote_couchdb');
    				var DB_Site = new PouchDB(remote_couchdb + 'site' + nom_table + debug);
    			} else {
    				var DB_Site = new PouchDB('site' + nom_table + debug);
    			};
    			
    			var N_site = row.doc.N_site;
    			
    			DB_Site.find({
    		       	selector: {N_site: N_site}
    			}).then(function (result) {
    				if (result.docs.length > 0) {*/
    					
    			if (row.doc.N_site != null) {
    		    	var N_site = row.doc.N_site;
    		    			
    		    	var res = alasql('SELECT N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km, COUNT(*) AS NbSite FROM ?  WHERE N_site == "' + N_site + '" GROUP BY N_site, Pays, Region_capture, Site_capture, Environnement, Latitude, Lat_degre_dec, Longitude, Long_degre_dec, Proximite_village_km', [tab] );
    		    			
    		    	var site = JSON.stringify(res);
    		    			
    		    	var obj_site = JSON.parse(site);
    		    			
    		    	obj_site.forEach(function(row){
    		    		Pays = row.Pays;
    		    		Region_capture = row.Region_capture;
    		    		Site_capture = row.Site_capture;
    		    		Environnement = row.Environnement;
    	    			Latitude = row.Latitude;
    	    			Lat_degre_dec = row.Lat_degre_dec;
    	    			Longitude = row.Longitude;
    	    			Long_degre_dec = row.Long_degre_dec;
    	    			Proximite_village_km = row.Proximite_village_km;
    	    			NbSite = row.NbSite;
    		    	});
    		    			
    		    	if (NbSite > 0) {
			
						if (array_selected_fields.indexOf('Date_debut') > -1) {
							CSV = CSV + row.doc.Date_debut + ";"
						};
						if (array_selected_fields.indexOf('Date_fin') > -1) {
							CSV = CSV + row.doc.Date_fin + ";"
						};
						if (array_selected_fields.indexOf('Equipe') > -1) {
							CSV = CSV + row.doc.Equipe + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_debut') > -1) {
							CSV = CSV + row.doc.ID_CS_debut + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_fin') > -1) {
							CSV = CSV + row.doc.ID_CS_fin + ";"
						};
						if (array_selected_fields.indexOf('ID_non_invasif_debut') > -1) {
							CSV = CSV + row.doc.ID_non_invasif_debut + ";"
						};
						if (array_selected_fields.indexOf('ID_non_invasif_fin') > -1) {
							CSV = CSV + row.doc.ID_non_invasif_fin + ";"
						};
						if (array_selected_fields.indexOf('N_site') > -1) {
							CSV = CSV + row.doc.N_site + ";"
						};
						if (array_selected_fields.indexOf('Pays') > -1) {
							CSV = CSV + Pays + ";"
						};
						if (array_selected_fields.indexOf('Region_capture') > -1) {
							CSV = CSV + Region_capture + ";"
						};
						if (array_selected_fields.indexOf('Site_capture') > -1) {
							CSV = CSV + Site_capture + ";"
						};
						if (array_selected_fields.indexOf('Environnement') > -1) {
							CSV = CSV + Environnement + ";"
						};
						if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
							CSV = CSV + Proximite_village_km + ";"
						};
						if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
							CSV = CSV + Lat_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Latitude') > -1) {
							CSV = CSV + Latitude + ";"
						};
						if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
							CSV = CSV + Long_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Longitude') > -1) {
							CSV = CSV + Longitude + ";"
						};
						if (array_selected_fields.indexOf('Type') > -1) {
							CSV = CSV + row.doc.Type + ";"
						};
						if (array_selected_fields.indexOf('Type_Roost') > -1) {
							CSV = CSV + row.doc.Type_Roost + ";"
						};
						if (array_selected_fields.indexOf('Proximite_eau') > -1) {
							CSV = CSV + row.doc.Proximite_eau + ";"
						};
						if (array_selected_fields.indexOf('Hauteur_canope') > -1) {
							CSV = CSV + row.doc.Hauteur_canope + ";"
						};
						if (array_selected_fields.indexOf('Description_site') > -1) {
							CSV = CSV + row.doc.Description_site + ";"
						};
						if (array_selected_fields.indexOf('ID_genet_espece') > -1) {
							CSV = CSV + row.doc.ID_genet_espece + ";"
						};
			
						if (array_selected_fields.indexOf('Famille1') > -1) {
				    		if (typeof row.doc.Phenologie[0] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[0].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre1') > -1) {
				    		if (typeof row.doc.Phenologie[0] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[0].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece1') > -1) {
							if (typeof row.doc.Phenologie[0] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[0].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece1') > -1) {
							if (typeof row.doc.Phenologie[0] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[0].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece1') > -1) {
							if (typeof row.doc.Phenologie[0] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[0].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille2') > -1) {
				    		if (typeof row.doc.Phenologie[1] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[1].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre2') > -1) {
				    		if (typeof row.doc.Phenologie[1] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[1].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece2') > -1) {
							if (typeof row.doc.Phenologie[1] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[1].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece2') > -1) {
							if (typeof row.doc.Phenologie[1] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[1].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece2') > -1) {
							if (typeof row.doc.Phenologie[1] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[1].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille3') > -1) {
				    		if (typeof row.doc.Phenologie[2] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[2].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre3') > -1) {
				    		if (typeof row.doc.Phenologie[2] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[2].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece3') > -1) {
							if (typeof row.doc.Phenologie[2] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[2].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece3') > -1) {
							if (typeof row.doc.Phenologie[2] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[2].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece3') > -1) {
							if (typeof row.doc.Phenologie[2] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[2].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille4') > -1) {
				    		if (typeof row.doc.Phenologie[3] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[3].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre4') > -1) {
				    		if (typeof row.doc.Phenologie[3] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[3].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece4') > -1) {
							if (typeof row.doc.Phenologie[3] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[3].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece4') > -1) {
							if (typeof row.doc.Phenologie[3] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[3].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece4') > -1) {
							if (typeof row.doc.Phenologie[3] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[3].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille5') > -1) {
				    		if (typeof row.doc.Phenologie[4] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[4].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre5') > -1) {
				    		if (typeof row.doc.Phenologie[4] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[4].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece5') > -1) {
							if (typeof row.doc.Phenologie[4] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[4].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece5') > -1) {
							if (typeof row.doc.Phenologie[4] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[4].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece5') > -1) {
							if (typeof row.doc.Phenologie[4] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[4].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille6') > -1) {
				    		if (typeof row.doc.Phenologie[5] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[5].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[5].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[5].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[5].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[5].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille7') > -1) {
				    		if (typeof row.doc.Phenologie[6] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[6].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[6].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[6].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[6].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[6].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};			
			
						if (array_selected_fields.indexOf('Espece_animale_sauvage') > -1) {
							CSV = CSV + row.doc.Espece_animale_sauvage + ";"
						};
						if (array_selected_fields.indexOf('Espece_animale_domestique') > -1) {
							CSV = CSV + row.doc.Espece_animale_domestique + ";"
						};
						if (array_selected_fields.indexOf('Interaction') > -1) {
							CSV = CSV + row.doc.Interaction + ";"
						};
						if (array_selected_fields.indexOf('Description_interaction_animaux') > -1) {
							CSV = CSV + row.doc.Description_interaction_animaux + ";"
						};
						if (array_selected_fields.indexOf('Activite_humaine') > -1) {
							CSV = CSV + row.doc.Activite_humaine + ";"
						};
						if (array_selected_fields.indexOf('Description_interaction_homme') > -1) {
							CSV = CSV + row.doc.Description_interaction_homme + ";"
						};
						if (array_selected_fields.indexOf('Camera_trap') > -1) {
							CSV = CSV + row.doc.Camera_trap + ";"
						};
						if (array_selected_fields.indexOf('Heure_debut_camera') > -1) {
							CSV = CSV + row.doc.Heure_debut_camera + ";"
						};
						if (array_selected_fields.indexOf('Heure_fin_camera') > -1) {
							CSV = CSV + row.doc.Heure_fin_camera + ";"
						};
						if (array_selected_fields.indexOf('Username') > -1) {
							CSV = CSV + row.doc.Username + ";"
						};
						CSV = CSV + "\r\n";
						count--
    					console.log(count);
    					
    					if (count == 0) {
    		    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    			
    			    		
    			    		//saveAs(blob, "testfile1.csv");
    			    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    		}
    				} else {
    					if (array_selected_fields.indexOf('Date_debut') > -1) {
							CSV = CSV + row.doc.Date_debut + ";"
						};
						if (array_selected_fields.indexOf('Date_fin') > -1) {
							CSV = CSV + row.doc.Date_fin + ";"
						};
						if (array_selected_fields.indexOf('Equipe') > -1) {
							CSV = CSV + row.doc.Equipe + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_debut') > -1) {
							CSV = CSV + row.doc.ID_CS_debut + ";"
						};
						if (array_selected_fields.indexOf('ID_CS_fin') > -1) {
							CSV = CSV + row.doc.ID_CS_fin + ";"
						};
						if (array_selected_fields.indexOf('ID_non_invasif_debut') > -1) {
							CSV = CSV + row.doc.ID_non_invasif_debut + ";"
						};
						if (array_selected_fields.indexOf('ID_non_invasif_fin') > -1) {
							CSV = CSV + row.doc.ID_non_invasif_fin + ";"
						};
						if (array_selected_fields.indexOf('N_site') > -1) {
							CSV = CSV + row.doc.N_site + ";"
						};
						if (array_selected_fields.indexOf('Pays') > -1) {
							CSV = CSV + row.doc.Pays + ";"
						};
						if (array_selected_fields.indexOf('Region_capture') > -1) {
							CSV = CSV + row.doc.Region_capture + ";"
						};
						if (array_selected_fields.indexOf('Site_capture') > -1) {
							CSV = CSV + row.doc.Site_capture + ";"
						};
						if (array_selected_fields.indexOf('Environnement') > -1) {
							CSV = CSV + row.doc.Environnement + ";"
						};
						if (array_selected_fields.indexOf('Proximite_village_km') > -1) {
							CSV = CSV + row.doc.Proximite_village_km + ";"
						};
						if (array_selected_fields.indexOf('Lat_degre_dec') > -1) {
							CSV = CSV + row.doc.Lat_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Latitude') > -1) {
							CSV = CSV + row.doc.Latitude + ";"
						};
						if (array_selected_fields.indexOf('Long_degre_dec') > -1) {
							CSV = CSV + row.doc.Long_degre_dec + ";"
						};
						if (array_selected_fields.indexOf('Longitude') > -1) {
							CSV = CSV + row.doc.Longitude + ";"
						};
						if (array_selected_fields.indexOf('Type') > -1) {
							CSV = CSV + row.doc.Type + ";"
						};
						if (array_selected_fields.indexOf('Type_Roost') > -1) {
							CSV = CSV + row.doc.Type_Roost + ";"
						};
						if (array_selected_fields.indexOf('Proximite_eau') > -1) {
							CSV = CSV + row.doc.Proximite_eau + ";"
						};
						if (array_selected_fields.indexOf('Hauteur_canope') > -1) {
							CSV = CSV + row.doc.Hauteur_canope + ";"
						};
						if (array_selected_fields.indexOf('Description_site') > -1) {
							CSV = CSV + row.doc.Description_site + ";"
						};
						if (array_selected_fields.indexOf('ID_genet_espece') > -1) {
							CSV = CSV + row.doc.ID_genet_espece + ";"
						};
			
						if (array_selected_fields.indexOf('Famille1') > -1) {
				    		if (typeof row.doc.Phenologie[0] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[0].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre1') > -1) {
				    		if (typeof row.doc.Phenologie[0] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[0].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece1') > -1) {
							if (typeof row.doc.Phenologie[0] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[0].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece1') > -1) {
							if (typeof row.doc.Phenologie[0] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[0].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece1') > -1) {
							if (typeof row.doc.Phenologie[0] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[0].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille2') > -1) {
				    		if (typeof row.doc.Phenologie[1] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[1].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre2') > -1) {
				    		if (typeof row.doc.Phenologie[1] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[1].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece2') > -1) {
							if (typeof row.doc.Phenologie[1] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[1].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece2') > -1) {
							if (typeof row.doc.Phenologie[1] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[1].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece2') > -1) {
							if (typeof row.doc.Phenologie[1] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[1].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille3') > -1) {
				    		if (typeof row.doc.Phenologie[2] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[2].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre3') > -1) {
				    		if (typeof row.doc.Phenologie[2] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[2].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece3') > -1) {
							if (typeof row.doc.Phenologie[2] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[2].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece3') > -1) {
							if (typeof row.doc.Phenologie[2] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[2].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece3') > -1) {
							if (typeof row.doc.Phenologie[2] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[2].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille4') > -1) {
				    		if (typeof row.doc.Phenologie[3] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[3].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre4') > -1) {
				    		if (typeof row.doc.Phenologie[3] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[3].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece4') > -1) {
							if (typeof row.doc.Phenologie[3] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[3].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece4') > -1) {
							if (typeof row.doc.Phenologie[3] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[3].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece4') > -1) {
							if (typeof row.doc.Phenologie[3] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[3].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille5') > -1) {
				    		if (typeof row.doc.Phenologie[4] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[4].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre5') > -1) {
				    		if (typeof row.doc.Phenologie[4] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[4].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece5') > -1) {
							if (typeof row.doc.Phenologie[4] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[4].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece5') > -1) {
							if (typeof row.doc.Phenologie[4] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[4].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece5') > -1) {
							if (typeof row.doc.Phenologie[4] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[4].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille6') > -1) {
				    		if (typeof row.doc.Phenologie[5] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[5].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[5].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[5].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[5].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece6') > -1) {
							if (typeof row.doc.Phenologie[5] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[5].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Famille7') > -1) {
				    		if (typeof row.doc.Phenologie[6] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[6].Famille + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Genre7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[6].Genre + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Espece7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[6].Espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Pheno_espece7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
				    			CSV = CSV + row.doc.Phenologie[6].Pheno_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};
						if (array_selected_fields.indexOf('Statut_espece7') > -1) {
							if (typeof row.doc.Phenologie[6] !== 'undefined') {
								CSV = CSV + row.doc.Phenologie[6].Statut_espece + ";"
							} else {
								CSV = CSV + ";"
							}
						};			
			
						if (array_selected_fields.indexOf('Espece_animale_sauvage') > -1) {
							CSV = CSV + row.doc.Espece_animale_sauvage + ";"
						};
						if (array_selected_fields.indexOf('Espece_animale_domestique') > -1) {
							CSV = CSV + row.doc.Espece_animale_domestique + ";"
						};
						if (array_selected_fields.indexOf('Interaction') > -1) {
							CSV = CSV + row.doc.Interaction + ";"
						};
						if (array_selected_fields.indexOf('Description_interaction_animaux') > -1) {
							CSV = CSV + row.doc.Description_interaction_animaux + ";"
						};
						if (array_selected_fields.indexOf('Activite_humaine') > -1) {
							CSV = CSV + row.doc.Activite_humaine + ";"
						};
						if (array_selected_fields.indexOf('Description_interaction_homme') > -1) {
							CSV = CSV + row.doc.Description_interaction_homme + ";"
						};
						if (array_selected_fields.indexOf('Camera_trap') > -1) {
							CSV = CSV + row.doc.Camera_trap + ";"
						};
						if (array_selected_fields.indexOf('Heure_debut_camera') > -1) {
							CSV = CSV + row.doc.Heure_debut_camera + ";"
						};
						if (array_selected_fields.indexOf('Heure_fin_camera') > -1) {
							CSV = CSV + row.doc.Heure_fin_camera + ";"
						};
						if (array_selected_fields.indexOf('Username') > -1) {
							CSV = CSV + row.doc.Username + ";"
						};
						CSV = CSV + "\r\n";
						count--
    					console.log(count);
    					
    					if (count == 0) {
    		    			var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    			
    			    		
    			    		//saveAs(blob, "testfile1.csv");
    			    		saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    		}
					}
					
    			}	
	    		/*}).catch(function (err) {
	    		     console.log(err);
	    		});*/
			}
		}
		
		function addAnimals(row) {
    		
    		if (count > 0) {   	
    			
    			var debug;
    			if (localStorage.getItem('debug') === null) {
    				debug = '';
    			} else {
    				debug = localStorage.getItem('debug');
    			};
    			
    			CSV = CSV +
    			
    			    row.doc.ID_animal + ';' +
				    row.doc.pays + ';' +
				    row.doc.mission + ';' +
				    row.doc.date + ';' +
				    row.doc.village + ';' +
				    row.doc.type_chasse_capture + ';' +
				    row.doc.Point_GPS_LAT + ';' +
				    row.doc.Point_GPS_LONG + ';' +
				    row.doc.animal + ';' +
				    row.doc.especes + ';' +
				    row.doc.sexes + ';' +
				    row.doc.age + ';' +
				    row.doc.poids + ';' +
				    row.doc.plasma + ';' +
				    row.doc.serum + ';' +
				    row.doc['etat-physioloque'] + ';' +
				    row.doc.blood_spot + ';' +
				    row.doc.coeur + ';' +
				    row.doc.cerveau + ';' +
				    row.doc.foie_rate + ';' +
				    row.doc.glandes_salivaires + ';' +
				    row.doc.poumons + ';' +
				    row.doc.reins + ';' +
				    row.doc.intestins + ';' +
				    row.doc.urine + ';' +
				    row.doc.ecouvillon_salivaire + ';' +
				    row.doc.ecouvillon_rectal + ';' +
				    row.doc.ecouvillon_nasal  + ';' +
				    row.doc.ectoparasites + ';' +
				    row.doc.village + ';' +
				    row.doc.liquide_amniotique + ';' +
				    row.doc.testicules + ';' +
				    row.doc.lesions_ou_nodules + ';' +
				    row.doc.lait + ';' +
				    row.doc.foetus + ';' +
				    row.doc.observation + ';' +
				    row.doc.guano + ';' +
				    row.doc.longueur_bras + ';' +
				    row.doc.longueur_avant_bras + ';' +
				    row.doc.longueur_corporelle + ';' +
				    row.doc.Username + ";\r\n";
							
				count--
				console.log(count);
					    					
				if (count == 0) {
				   	var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
				    	//saveAs(blob, "testfile1.csv");
				   	saveAs(blob, "ebo-sursy" + clock.now + ".csv");
				}
		    }	
		};
    	
    	function addAnimals_selected_heading() {
    		CSV = '';
    		    		
	    		if (array_selected_fields.indexOf('ID_animal') > -1) {
	    			CSV = CSV + 'ID_animal;'
	    		};
	    		if (array_selected_fields.indexOf('pays') > -1) {
	    			CSV = CSV + 'pays;'
	    		};
	    		if (array_selected_fields.indexOf('mission') > -1) {
	    			CSV = CSV + 'mission;'
	    		};
	    		if (array_selected_fields.indexOf('date') > -1) {
	    			CSV = CSV + 'date;'
	    		};
	    		if (array_selected_fields.indexOf('village') > -1) {
	    			CSV = CSV + 'village;'
	    		};
	    		if (array_selected_fields.indexOf('type_chasse_capture') > -1) {
	    			CSV = CSV + 'type_chasse_capture;'
	    		};
	    		if (array_selected_fields.indexOf('Point_GPS_LAT') > -1) {
	    			CSV = CSV + 'Point_GPS_LAT;'
	    		};
	    		if (array_selected_fields.indexOf('Point_GPS_LONG') > -1) {
	    			CSV = CSV + 'Point_GPS_LONG;'
	    		};
	    		if (array_selected_fields.indexOf('animal') > -1) {
	    			CSV = CSV + 'animal;'
	    		};
	    		if (array_selected_fields.indexOf('especes') > -1) {
	    			CSV = CSV + 'especes;'
	    		};
	    		if (array_selected_fields.indexOf('sexes') > -1) {
	    			CSV = CSV + 'sexes;'
	    		};
	    		if (array_selected_fields.indexOf('age') > -1) {
	    			CSV = CSV + 'age;'
	    		};
	    		if (array_selected_fields.indexOf('etat-physioloque') > -1) {
	    			CSV = CSV + 'etat-physioloque;'
	    		};
	    		if (array_selected_fields.indexOf('plasma') > -1) {
	    			CSV = CSV + 'plasma;'
	    		};
	    		if (array_selected_fields.indexOf('poids') > -1) {
	    			CSV = CSV + 'poids;'
	    		};
	    		if (array_selected_fields.indexOf('serum') > -1) {
	    			CSV = CSV + 'serum;'
	    		};
	    		if (array_selected_fields.indexOf('blood_spot') > -1) {
	    			CSV = CSV + 'blood_spot;'
	    		};
	    		if (array_selected_fields.indexOf('coeur') > -1) {
	    			CSV = CSV + 'coeur;'
	    		};
	    		if (array_selected_fields.indexOf('cerveau') > -1) {
	    			CSV = CSV + 'cerveau;'
	    		};
	    		if (array_selected_fields.indexOf('foie_rate') > -1) {
	    			CSV = CSV + 'foie_rate;'
	    		};
	    		if (array_selected_fields.indexOf('glandes_salivaires') > -1) {
	    			CSV = CSV + 'glandes_salivaires;'
	    		};
	    		if (array_selected_fields.indexOf('poumons') > -1) {
	    			CSV = CSV + 'poumons;'
	    		};
	    		if (array_selected_fields.indexOf('reins') > -1) {
	    			CSV = CSV + 'reins;'
	    		};
	    		if (array_selected_fields.indexOf('intestins') > -1) {
	    			CSV = CSV + 'intestins;'
	    		};
	    		if (array_selected_fields.indexOf('urine') > -1) {
	    			CSV = CSV + 'urine;'
	    		};
	    		if (array_selected_fields.indexOf('ecouvillon_salivaire') > -1) {
	    			CSV = CSV + 'ecouvillon_salivaire;'
	    		};
	    		if (array_selected_fields.indexOf('ecouvillon_rectal') > -1) {
	    			CSV = CSV + 'ecouvillon_rectal;'
	    		};
	    		if (array_selected_fields.indexOf('ecouvillon_nasal') > -1) {
	    			CSV = CSV + 'ecouvillon_nasal;'
	    		};
	    		if (array_selected_fields.indexOf('ectoparasites') > -1) {
	    			CSV = CSV + 'ectoparasites;'
	    		};
	    		if (array_selected_fields.indexOf('placenta') > -1) {
	    			CSV = CSV + 'placenta;'
	    		};
	    		if (array_selected_fields.indexOf('liquide_amniotique') > -1) {
	    			CSV = CSV + 'liquide_amniotique;'
	    		};
	    		if (array_selected_fields.indexOf('testicules') > -1) {
	    			CSV = CSV + 'testicules;'
	    		};
	    		if (array_selected_fields.indexOf('lesions_ou_nodules') > -1) {
	    			CSV = CSV + 'lesions_ou_nodules;'
	    		};
	    		if (array_selected_fields.indexOf('lait') > -1) {
	    			CSV = CSV + 'lait;'
	    		};
	    		if (array_selected_fields.indexOf('foetus') > -1) {
	    			CSV = CSV + 'foetus;'
	    		};
	    		if (array_selected_fields.indexOf('observation') > -1) {
	    			CSV = CSV + 'observation;'
	    		};
	    		if (array_selected_fields.indexOf('guano') > -1) {
	    			CSV = CSV + 'guano;'
	    		};
	    		if (array_selected_fields.indexOf('longueur_bras') > -1) {
	    			CSV = CSV + 'longueur_bras;'
	    		};
	    		if (array_selected_fields.indexOf('longueur_avant_bras') > -1) {
	    			CSV = CSV + 'longueur_avant_bras;'
	    		};
	    		if (array_selected_fields.indexOf('longueur_corporelle') > -1) {
	    			CSV = CSV + 'longueur_corporelle;'
	    		};
	    		if (array_selected_fields.indexOf('Username') > -1) {
	    			CSV = CSV + 'Username;'
	    		};
			CSV = CSV + "\r\n";
    	}
    	
    	function addAnimals_selected(row) {
			
    		if (count > 0) {
	    		
    			
    			if (array_selected_fields.indexOf('ID_animal') > -1) {
					CSV = CSV + row.doc.ID_animal + ";"
				};
				if (array_selected_fields.indexOf('pays') > -1) {
					CSV = CSV + row.doc.pays + ";"
				};
				if (array_selected_fields.indexOf('mission') > -1) {
					CSV = CSV + row.doc.mission + ";"
				};
				if (array_selected_fields.indexOf('date') > -1) {
					CSV = CSV + row.doc.date + ";"
				};
				if (array_selected_fields.indexOf('village') > -1) {
					CSV = CSV + row.doc.village + ";"
				};
				if (array_selected_fields.indexOf('type_chasse_capture') > -1) {
					CSV = CSV + row.doc.type_chasse_capture + ";"
				};
				if (array_selected_fields.indexOf('Point_GPS_LAT') > -1) {
					CSV = CSV + row.doc.Point_GPS_LAT + ";"
				};
				if (array_selected_fields.indexOf('Point_GPS_LONG') > -1) {
					CSV = CSV + row.doc.Point_GPS_LONG + ";"
				};
				if (array_selected_fields.indexOf('animal') > -1) {
					CSV = CSV + row.doc.animal + ";"
				};
				if (array_selected_fields.indexOf('especes') > -1) {
					CSV = CSV + row.doc.especes + ";"
				};
				if (array_selected_fields.indexOf('sexes') > -1) {
					CSV = CSV + row.doc.sexes + ";"
				};
				if (array_selected_fields.indexOf('age') > -1) {
					CSV = CSV + row.doc.age + ";"
				};
				if (array_selected_fields.indexOf('poids') > -1) {
					CSV = CSV + row.doc.poids + ";"
				};
				if (array_selected_fields.indexOf('etat-physioloque') > -1) {
					CSV = CSV + row.doc['etat-physioloque'] + ";"
				};
				if (array_selected_fields.indexOf('plasma') > -1) {
					CSV = CSV + row.doc.plasma + ";"
				};
				if (array_selected_fields.indexOf('serum') > -1) {
					CSV = CSV + row.doc.serum + ";"
				};
				if (array_selected_fields.indexOf('blood_spot') > -1) {
					CSV = CSV + row.doc.blood_spot + ";"
				};
				if (array_selected_fields.indexOf('coeur') > -1) {
					CSV = CSV + row.doc.coeur + ";"
				};
				if (array_selected_fields.indexOf('cerveau') > -1) {
					CSV = CSV + row.doc.cerveau + ";"
				};
				if (array_selected_fields.indexOf('foie_rate') > -1) {
					CSV = CSV + row.doc.foie_rate + ";"
				};
				if (array_selected_fields.indexOf('glandes_salivaires') > -1) {
					CSV = CSV + row.doc.glandes_salivaires + ";"
				};
				if (array_selected_fields.indexOf('poumons') > -1) {
					CSV = CSV + row.doc.poumons + ";"
				};
				if (array_selected_fields.indexOf('reins') > -1) {
					CSV = CSV + row.doc.reins + ";"
				};
				if (array_selected_fields.indexOf('intestins') > -1) {
					CSV = CSV + row.doc.intestins + ";"
				};
				if (array_selected_fields.indexOf('urine') > -1) {
					CSV = CSV + row.doc.urine + ";"
				};
				if (array_selected_fields.indexOf('ecouvillon_salivaire') > -1) {
					CSV = CSV + row.doc.ecouvillon_salivaire + ";"
				};
				if (array_selected_fields.indexOf('ecouvillon_rectal') > -1) {
					CSV = CSV + row.doc.ecouvillon_rectal + ";"
				};
				if (array_selected_fields.indexOf('ecouvillon_nasal') > -1) {
					CSV = CSV + row.doc.ecouvillon_nasal + ";"
				};
				if (array_selected_fields.indexOf('ectoparasites') > -1) {
					CSV = CSV + row.doc.ectoparasites + ";"
				};
				if (array_selected_fields.indexOf('placenta') > -1) {
					CSV = CSV + row.doc.placenta + ";"
				};
				if (array_selected_fields.indexOf('liquide_amniotique') > -1) {
					CSV = CSV + row.doc.liquide_amniotique + ";"
				};
				if (array_selected_fields.indexOf('testicules') > -1) {
					CSV = CSV + row.doc.testicules + ";"
				};
				if (array_selected_fields.indexOf('lesions_ou_nodules') > -1) {
					CSV = CSV + row.doc.lesions_ou_nodules + ";"
				};
				if (array_selected_fields.indexOf('lait') > -1) {
					CSV = CSV + row.doc.lait + ";"
				};
				if (array_selected_fields.indexOf('foetus') > -1) {
					CSV = CSV + row.doc.foetus + ";"
				};
				if (array_selected_fields.indexOf('observation') > -1) {
					CSV = CSV + row.doc.observation + ";"
				};
				if (array_selected_fields.indexOf('guano') > -1) {
					CSV = CSV + row.doc.guano + ";"
				};
				if (array_selected_fields.indexOf('longueur_bras') > -1) {
					CSV = CSV + row.doc.longueur_bras + ";"
				};
				if (array_selected_fields.indexOf('longueur_avant_bras') > -1) {
					CSV = CSV + row.doc.longueur_avant_bras + ";"
				};
				if (array_selected_fields.indexOf('longueur_corporelle') > -1) {
					CSV = CSV + row.doc.longueur_corporelle + ";"
				};
				if (array_selected_fields.indexOf('Username') > -1) {
					CSV = CSV + row.doc.Username + ";"
				};
		    	CSV = CSV + "\r\n";
		    				
		    	count--
    			console.log(count);
    					
    			if (count == 0) {
    		    	var blob = new Blob(['\ufeff' + CSV], {type: "text/csv;charset=ISO-8859-1"});
    		    		
    			    		
    				//saveAs(blob, "testfile1.csv");
    			    saveAs(blob, "ebo-sursy" + clock.now + ".csv");
    		    }
				
			}
    		
    	};
    		
    	function extraireNombre(str) { 
    		return str.match(/[0-9]+/g)
    	};
    	
        
    </script> 
       	
	<script type="text/javascript">  
    	var multiselect1 = document.getElementById("multiselect1");		
	
    	/*if (type_table == 'chauves_souris_capturees') {
			var fields = 
				['N_identification_CS', 'N_identification_mere', 'N_site', 'Date',
				 'Equipe', 'Pays', 'Region_capture', 'Site_capture', 'Lieu_capture',
			     'Environnement', 'Latitude', 'Lat_degre_dec', 'Longitude', 'Long_degre_dec',
			     'Proximite_village_km', 'Methode_capture', 'Type_chauve_souris',
			     'Espece_identifiee', 'Famille_terrain', 'Genre_terrain', 'Espece_terrain',
			     'Famille_labo', 'Genre_labo', 'Espece_labo', 'Famille_consensus', 'Genre_consensus', 
			     'Espece_consensus', 'Sexe', 'Age', 'Gestante', 'Lactation', 'Suitee', 'Sexe_enfant',
			     'Poids_enfant', 'Identifiant_enfant', 'Vivante', 'Cause_deces', 'Poids_gr',
			     'L_avant_bras_mm', 'L_totale_corps_mm', 'Taille_yeux', 'L_queue_mm',
			     'L_metacarpe_3ieme_doigt_mm', 'Couleur_pelage_dorsal',
			     'Couleur_pelage_ventral', 'Remarques_anomalies', 'Sang_DBS_nb_cercles', 
			     'Sang_tube_EDTA', 'Feces_RNAl', 'Urine', 'Urine_DUS_nombre_cercles',
			     'Feces_urine_RNAl', 'Ecouvillon_gorge_RNAl', 'Ecouvillon_rectal_RNAl',
			     'Ectoparasites_ethanol', 'Poils_ethanol', 'Wing_punch_ethanol',
			     'Feces_culture_glycerol', 'Sperme', 'Autres_echantillons_remarques',
			     'Specimen_entier', 'Specimen_preserve_dans', 'Prelevement_organe',
			     'Foie_formol', 'Foie_RNAl', 'Rate_formol', 'Rate_RNAl', 'Reins_formol',
			     'Reins_RNAl', 'Intestins_formol', 'Intestins_RNAl', 'Poumons_formol',
			     'Poumons_RNAl', 'Coeur_formol','Coeur_RNAl', 'Ggl_lymph_formol',
			     'Ggl_lymph_RNAl', 'Testicules_formol', 'Testicules_RNAl', 'Peau_formol',
			     'Peau_RNAl', 'Muscles_formol', 'Muscles_RNAl', 'Cerveau_formol',
			     'Cerveau_RNAl', 'Autre', 'Autre_formol', 'Autre_RNAl', 'Remarques_echantillons'];
			
		} else if (type_table == 'chauves_souris_non_invasives') {
			var fields = 
				['Date', 'Heure_debut', 'Heure_fin', 'N_site', 'Equipe', 'Pays', 'Region_collecte', 'Site_collecte', 'Environnement', 
				 'Lieu_collecte', 'Lat_degre_dec', 'Latitude', 'Long_degre_dec', 'Longitude', 'Type_site', 'Proximite_village_km',
				 'Type_chauves_souris', 'Famille_1', 'Genre_1', 'Espece_1', 'Famille_2', 'Genre_2', 'Espece_2', 'Famille_3', 
				 'Genre_3', 'Espece_3', 'Remarques', 'N_identification_echantillon', 'Type_echantillon', 'Nbre_feces_par_tube',
				 'Urine_methode', 'Urine_papier_buvard_nbre_cercles'];
		}*/
			
		console.log('ok');
		console.log(fields);
		
		for (var i = 0; i < fields.length; i++) {
			multiselect1.options[i] = new Option(fields[i], fields[i]);
		};
	</script> 
	
	<script type="text/javascript">
		document.addEventListener("keydown", function(event) {
		  if (event.keyCode == 13) {
		    event.preventDefault();
		    return false;
		  }
		}, true); // "true" => phase de capture
		
		var institut;
		if ((nom_table == '_transvihmi_guinee') || (nom_table == '_transvihmi_cameroun')
			|| (nom_table == '_transvihmi_rdc')) {
			institut = 'transvihmi';			
		} else if ((nom_table == '_mivegec_congo') || (nom_table == '_mivegec_gabon')) {
			institut = 'mivegec';
		} else if ((nom_table == '_astre_guinee') || (nom_table == '_astre_congo')
				|| (nom_table == '_astre_gabon')) {				
			institut = 'astre';
		};
		
		expanded(nom_table);
				
		function expanded(nom_table) {
			var component_li = document.getElementById('li_' + institut + 'Dropdown');
			component_li.classList.add('active');
			var component_a = document.getElementById('a_' + institut + 'Dropdown');
			component_a.setAttribute('aria-expanded', 'true');
			var component_ul =  document.getElementById('ul_' + institut + 'Dropdown');
			component_ul.classList.add('show');
				 
			try {
				var component_li = document.getElementById('li' + nom_table + 'Dropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a' + nom_table + 'Dropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul' + nom_table + 'Dropdown');
				component_ul.classList.add('show');
			}
		   	catch(error) {
		   	};
		   	
			if ((type_table == 'chauves_souris_capturees') 
				|| (type_table == 'chauves_souris_non_invasives')
				|| (type_table == 'donnees_mission')
				|| (type_table == 'donnees_journalieres')) { 
				var component_li = document.getElementById('li_bat' + nom_table + 'Dropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a_bat' + nom_table + 'Dropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul_bat' + nom_table + 'Dropdown');
				component_ul.classList.add('show');
			};
			
			if (type_table == 'chauves_souris_capturees') {
				var component_li = document.getElementById('li_bat' + nom_table + 'CaptureesDropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a_bat' + nom_table + 'CaptureesDropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul_bat' + nom_table + 'CaptureesDropdown');
				component_ul.classList.add('show');
				
			} else if (type_table == 'chauves_souris_non_invasives') {
				var component_li = document.getElementById('li_bat' + nom_table + 'NonInvasivesDropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a_bat' + nom_table + 'NonInvasivesDropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul_bat' + nom_table + 'NonInvasivesDropdown');
				component_ul.classList.add('show');
				
			}  else if (type_table == 'donnees_mission') {
				var component_li = document.getElementById('li_suivi_longitudinal_donnees_missions' + nom_table + 'Dropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a_suivi_longitudinal_donnees_missions' + nom_table + 'Dropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul_suivi_longitudinal_donnees_missions' + nom_table + 'Dropdown');
				component_ul.classList.add('show');
			
			}  else if (type_table == 'donnees_journalieres') {
				var component_li = document.getElementById('li_suivi_longitudinal_donnees_journalieres' + nom_table + 'Dropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a_suivi_longitudinal_donnees_journalieres' + nom_table + 'Dropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul_suivi_longitudinal_donnees_journalieres' + nom_table + 'Dropdown');
				component_ul.classList.add('show');
			
			} else if (type_table == 'viande_de_brousse') { 
				var component_li = document.getElementById('li_viande_de_brousse' + nom_table + 'Dropdown');
				component_li.classList.add('active');
				var component_a = document.getElementById('a_viande_de_brousse' + nom_table + 'Dropdown');
				component_a.setAttribute('aria-expanded', 'true');
				var component_ul =  document.getElementById('ul_viande_de_brousse' + nom_table + 'Dropdown');
				component_ul.classList.add('show');
				
			};
			
			if (type_table == 'chauves_souris_capturees') {
				var component_li = document.getElementById('li_importation_bat_capturees' + nom_table);
			} else if (type_table == 'chauves_souris_non_invasives') {
				var component_li = document.getElementById('li_importation_bat_non_invasives' + nom_table);
			} else if (type_table == 'donnees_mission') {
				var component_li = document.getElementById('li_importation_suivi_longitudinal_donnees_missions' + nom_table);
			}  else if (type_table == 'donnees_journalieres') {
				var component_li = document.getElementById('li_importation_suivi_longitudinal_donnees_journalieres' + nom_table);
			} else if (type_table == 'viande_de_brousse') {
				var component_li = document.getElementById('li_importation_viande_de_brousse' + nom_table);
			} else if (type_table == 'animals') {
				var component_li = document.getElementById('li_importation_animals' + nom_table);
			} 
			component_li.classList.add('active');
		};
     </script>  
  </body>
</html>
	 